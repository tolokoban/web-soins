(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{70:function(t,e){t.exports={fr:{"err-1":"Une ligne non vide et non comment\xe9e doit toujours commencer par au moins une ast\xe9risque pour indiquer le niveau hi\xe9rarchique.","err-2":"<html>Vous avez saut\xe9 au moins un niveau hi\xe9rarchique:<br/><code>$1</code> !<br/><br/>Vous \xe9tiez au niveau <b>$2</b> et vous d\xe9finissez maintenant le niveau <b>$3</b>.","err-3":"<html>Vous avez d\xe9j\xe0 d\xe9clar\xe9 cet identifiant : <b>$1</b> !"}}},71:function(t,e){t.exports={en:{cancel:"Cancel",close:"Close",code:"Code:",consultations:"Consultations","consultations-count":"Consultations:","create-stat":"Create Statistics","create-stat-consultation":"Consult. Statistics","create-stat-patient":"Patients Statistics","date-min":"Start Date","date-max":"End Date","genereting-report":"Generating report...",logout:"Logout",patients:"Patients","patients-count":"Patients:",report:"To add an annual report, clic on the left pane's button bearing the following icon:","stat-type":"Statistic Type",struct:"Structure:",welcome:"To add new statistics, clic on the left pane's button bearing the following icon:"},fr:{cancel:"Annuler",close:"Fermer",code:"Code :",consultations:"Consultations","consultations-count":"Consultations :","create-stat":"Cr\xe9er des statistiques","create-stat-consultation":"Stats consultations","create-stat-patient":"Stats patients","date-min":"Date de d\xe9but","date-max":"Date de fin","genereting-report":"Rapport en cours de r\xe9alisation...",logout:"D\xe9connexion",patients:"Patients","patients-count":"Patients :",report:"Pour \xe9diter un rapport annuel, cliquez sur le bouton avec l'ic\xf4ne suivante dans le panneau de gauche :","stat-type":"Type de statistique",struct:"Structure :",welcome:"Pour ajouter des statistiques, cliquez sur le bouton avec l'ic\xf4ne suivante dans le panneau de gauche : "}}},72:function(t,e,n){t.exports=n.p+"static/media/report.60e5f273.fods"},73:function(t,e,n){},74:function(t,e,n){},75:function(t,e){t.exports={en:{invalid:"Invalid date!","month-0":"Jan","month-1":"Feb","month-2":"Mar","month-3":"Apr","month-4":"May","month-5":"Jun","month-6":"Jul","month-7":"Aug","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"Dec"},fr:{invalid:"Date invalide !","month-0":"Jan","month-1":"F\xe9v","month-2":"Mar","month-3":"Avr","month-4":"Mai","month-5":"Jun","month-6":"Jul","month-7":"Aou","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"D\xe9c"}}},76:function(t,e,n){},77:function(t,e){t.exports={en:{close:"Close",export:"Export to Spreadsheet","no-data":"There is no data for this period!"},fr:{close:"Fermer",export:"Exporter vers un tableur","no-data":"Il n'y a aucune donn\xe9e sur cette p\xe9riode !"}}},78:function(t,e,n){},79:function(t,e,n){},80:function(t,e,n){},81:function(t,e,n){},82:function(t,e,n){"use strict";n.r(e);var a=n(3),r=n.n(a),c=n(9),i=n(0),o=n.n(i),s=n(23),u=n.n(s),l=n(58),d=n(10),f=n(60),p=n(18),h=new Set(["nickname","language"]),m={INITIAL_STATE:{email:"",nickname:"",language:"",roles:[]},reducer:function(t,e){if(!e.type.startsWith("user:"))return t;var n=e.type.substr("user:".length);if(!h.has(n))throw Error('Unknown attribute "'.concat(n,'"!'));var a=e.data;return Object.assign(t,Object(p.a)({},n,a))},setLanguage:function(t){return{type:"user:language",data:t}},setNickname:function(t){return{type:"user:nickname",data:t}}},v={INITIAL_STATE:[],reducer:function(t,e){var n=e.type;if(!n.startsWith("organization:"))return t;switch(e.type.substr("organization:".length)){case"set":return e.organizations.slice();case"add":return function(t,e){var n=t.slice();return n.push(e),n}(t,e.organization);case"update":return function(t,e){return t.map(function(t){return t.id===e.id?e:t})}(t,e.organization);default:throw Error('Unknown action "'.concat(n,'"!'))}},setOrganizations:function(t){return{type:"organization:set",organizations:t}},addOrganization:function(t){return{type:"organization:add",organization:t}},updateOrganization:function(t){return{type:"organization:update",organization:t}}};var g={INITIAL_STATE:[],reducer:function(t,e){var n=e.type;if(!n.startsWith("carecenter:"))return t;switch(e.type.substr("carecenter:".length)){case"set":return e.carecenters.slice();case"add":return function(t,e){var n=t.slice();return n.push(e),n}(t,e.carecenter);case"update":return function(t,e){return t.map(function(t){return t.id===e.id?Object.assign(t,e):t})}(t,e.carecenter);default:throw Error('Unknown action "'.concat(n,'"!'))}},setCarecenters:function(t){return{type:"carecenter:set",carecenters:t}},addCarecenter:function(t){return{type:"carecenter:add",carecenter:t}},updateCarecenter:function(t){return{type:"carecenter:update",carecenter:t}}};var b=n(12),y={createPatientsFieldsFromStructure:function(t){var e={};return t.patientFields.forEach(function(t){e[t.id]=!0}),e},createPatientsFieldsCaptionsFromStructure:function(t){var e={};return t.patientFields.forEach(function(t){e[t.id]=b.a.toText(t.caption)}),e},getFieldCaption:function(t,e){if("#"!==t.charAt(0))return t;var n=e.formFields[t];return n?b.a.toText(n.caption):t}},C={INITIAL_STATE:[],reducer:function(t,e){var n=e.type;if(!n.startsWith("structure:"))return t;switch(e.type.substr("structure:".length)){case"set":return e.structures.slice();case"add":return function(t,e){var n=t.slice();return n.push(e),n}(t,e.structure);case"update":return function(t,e){return t.map(function(t){return t.id===e.id?Object.assign(t,e):t})}(t,e.structure);default:throw Error('Unknown action "'.concat(n,'"!'))}},setStructures:function(t){return{type:"structure:set",structures:t}},addStructure:function(t){return{type:"structure:add",structure:t}},updateStructure:function(t){return{type:"structure:update",structure:t}}};var E=n(5),w=n(4),j={INITIAL_STATE:{statsType:"consultations",dateMin:function(){var t=new Date;if(1!==t.getDate()){var e=new Date(t.getFullYear(),t.getMonth(),1);return e.getTime()}var n=new Date(t.getFullYear(),t.getMonth()-1,t.getDate());return n.getTime()}(),dateMax:Date.now(),patientsFields:{birthday:!0,size:!1,nationality:!0},patientsFieldsCaptions:{birthday:"Date de naissance",size:"Taille",nationality:"Nationalit\xe9"},carecenter:{id:0,organizationId:0,structureId:0,patientsCount:0,consultationsCount:0,name:"",code:""}},reducer:function(t,e){var n=e.type;if(!n.startsWith("stats-config:"))return t;switch(e.type.substr("stats-config:".length)){case"setType":return function(t,e){return Object(d.a)({},t,{statsType:e.statsType||"consultations"})}(t,e);case"setDateMin":return function(t,e){return Object(d.a)({},t,{dateMin:e.date})}(t,e);case"setDateMax":return function(t,e){return Object(d.a)({},t,{dateMax:e.date})}(t,e);case"setPatientsFields":return function(t,e){return Object(d.a)({},t,{patientsFields:e.fields||{}})}(t,e);case"setPatientField":return function(t,e){if("string"!==typeof e.fieldName)throw Error('action must have an attribute "fieldName" of type "string" but we found "'.concat(typeof e.fieldName,'"'));var n=Object(E.a)(e.fieldName,""),a=Object(w.a)(e.fieldVisibility,!1);return Object(d.a)({},t,{patientsFields:Object(d.a)({},t.patientsFields,Object(p.a)({},n,a))})}(t,e);default:throw Error('Unknown action "'.concat(n,'"!'))}},setType:function(t){return{type:"stats-config:setType",statsType:t}},setDateMin:function(t){return{type:"stats-config:setDateMin",date:t}},setDateMax:function(t){return{type:"stats-config:setDateMax",date:t}},setPatientsFields:function(t){return{type:"stats-config:setPatientsFields",fields:t}},setPatientField:function(t,e){return{type:"stats-config:setPatientField",fieldName:t,fieldVisibility:e}}};var O={INITIAL_STATE:[],reducer:function(t,e){var n=e.type;if(!n.startsWith("stats:"))return t;switch(e.type.substr("stats:".length)){case"addStat":return function(t,e){var n=t.stats.slice();return n.push(e.stat),n}(t,e);default:throw Error('Unknown action "'.concat(n,'"!'))}},addStat:function(t){return{type:"stats:addStat",stat:t}}};var k={statsConfig:function(t){return"".concat(t.statsType,"/").concat(t.dateMin,"-").concat(t.dateMax)}};var x={user:m.INITIAL_STATE,organizations:v.INITIAL_STATE,carecenters:g.INITIAL_STATE,structures:C.INITIAL_STATE,statsConfig:j.INITIAL_STATE,stats:O.INITIAL_STATE};var S=Object(f.b)(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,e=arguments.length>1?arguments[1]:void 0;switch(console.log("state =",t),e.type){case"initStatsConfig":return function(t,e){var n=e.carecenterId,a=t.carecenters.find(function(t){return t.id===n});if(!a)throw Error("There is no Carecenter with id=".concat(n,"!"));var r=a.structureId;if("number"!==typeof r)throw Error('Missing attribute number "structureId"!');var c=t.structures.find(function(t){return t.id===r});if(!c)throw Error("There is no structure with id ".concat(r,"!"));return Object(d.a)({},t,{statsConfig:Object(d.a)({},t.statsConfig,{carecenter:a,patientsFields:y.createPatientsFieldsFromStructure(c),patientsFieldsCaptions:y.createPatientsFieldsCaptionsFromStructure(c)})})}(t,e);case"addStat":return function(t,e){var n=k.statsConfig(t.statsConfig),a=t.stats.filter(function(t){return k.statsConfig(t)!==n});return a.push(Object(d.a)({},t.statsConfig)),Object(d.a)({},t,{stats:a})}(t);case"removeStat":return function(t,e){var n=t.stats.filter(function(t){return k.statsConfig(t)!==e.key});return Object(d.a)({},t,{stats:n})}(t,e);default:return{user:m.reducer(t.user,e),stats:O.reducer(t.stats,e),organizations:v.reducer(t.organizations,e),carecenters:g.reducer(t.carecenters,e),structures:C.reducer(t.structures,e),statsConfig:j.reducer(t.statsConfig,e)}}});var T={store:S,dispatch:function(t){S.dispatch(t)},User:m,Organizations:v,Carecenters:g,Structures:C,StatsConfig:j,initStatsConfig:function(t){return{type:"initStatsConfig",carecenterId:t}},addStat:function(){return{type:"addStat"}},removeStat:function(t){return{type:"removeStat",key:t}}},M=n(16),D={list:function(){var t=Object(c.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.a.exec("orga.list");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()},I={list:function(){var t=Object(c.a)(r.a.mark(function t(e){var n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.a.exec("carecenter.list",e);case 2:return n=t.sent,t.abrupt("return",n.map(function(t){return{id:t.id,name:t.name,code:t.code,patientsCount:t.patientsCount,consultationsCount:t.consultationsCount,structureId:t.structure,organizationId:e}}));case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},N=b.a.make(n(70)),F=/^(#[A-Z0-9-]+)?([^\(@]*)(\([^\)]*\)\+?)?(@[A-Z0-9,-]+)?/;var A={parse:function(t){var e={},n=[e];return"string"!==typeof t&&(t="".concat(t)),t.split("\n").forEach(function(t,e){try{if(0===(t=t.trim()).length)return;if("//"===t.substr(0,2))return;if("*"!==t.charAt(0))throw N("err-1");var a=function(t){for(var e=0;"*"==t.charAt(0);)t=t.substr(1),e++;return e}(t);if(t=t.substr(a).trim(),a>n.length)throw N("err-2",t,n.length-1,a);for(;n.length>a;)n.pop();var r=function(t){var e={children:{}},n=F.exec(t.trim());return n[2]&&(e.caption=n[2].trim()),n[1]?e.id=n[1].trim():e.id=e.caption.toUpperCase(),n[3]&&(e.type=n[3].substr(1,n[3].length-2).trim()),n[4]&&(e.tags=n[4].trim().substr(1).split(",").map(function(t){return t.trim()})),e}(t);if("undefined"!==typeof n[n.length-1][r.id])throw N("err-3",r.id);n[n.length-1][r.id]=r,n.push(r.children||{})}catch(c){throw{lineNumber:e+1,message:c}}}),e},flattenFormsFields:function(t){var e=[];return function t(e,n,a){Object.keys(e).forEach(function(r){var c=e[r];"string"===typeof c.id&&"#"===c.id.charAt(0)?n.push({id:c.id,caption:c.caption,path:a.slice()}):c.children&&(a.push(c.caption),t(c.children,n,a),a.pop())})}(t,e,[]),e.sort(function(t,e){var n=t.caption,a=e.caption;return n<a?-1:n>a?1:0}),e}},z={list:function(){var t=Object(c.a)(r.a.mark(function t(e){var n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.a.exec("structure.list",e);case 2:return n=t.sent,t.abrupt("return",n.map(function(t){return{id:t.id,organizationId:e,name:t.name,patientFields:L(t.patient),formFields:U(t),exams:P(t.exams),vaccins:P(t.vaccins),forms:P(t.forms),types:P(t.types),sources:{exams:t.exams,vaccins:t.vaccins,patient:t.patient,forms:t.forms,types:t.types}}}));case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()};function P(t){try{return A.parse(t)}catch(e){console.error("[parsePatient] ",e),console.log(t)}return null}function L(t){try{var e=A.parse(t);return Object.keys(e).map(function(t){var n=e[t];return{id:t,type:n.type,caption:b.a.toIntl(n.caption)}})}catch(n){console.error("[parsePatient] ",n)}return[]}function U(t){for(var e={},n=[P(t.forms)];n.length>0;)for(var a=n.shift(),r=Object.keys(a),c=0;c<r.length;c++){var i=r[c],o=a[i];e[i]={caption:b.a.toIntl(o.caption)},o.type&&(e[i].type=o.type),o.children&&n.push(o.children)}return e}var R=n(2),_=n(1),q=n(7),J=n(6),V=n(8),W=n(15),Y=n(14),$={saveAs:function(t,e){var n=window.URL.createObjectURL(t),a=document.createElement("a");a.style.display="none",a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(n)},5e3)}},B=n(11),Z={padNumber:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",a="".concat(t);a.length<e;)a=n.charAt(0)+a;return a},clamp:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t<e?e:t>n?n:t},loadTextFromURL:function(t){return new Promise(function(e,n){fetch(t).then(function(t){return t.ok||n("Error ".concat(t.status,": ").concat(t.statusText,"!")),t.text()}).then(e).catch(n)})},loadJsonFromURL:function(t){return new Promise(function(e,n){fetch(t).then(function(t){return t.json()}).then(e).catch(n)})}},G=b.a.make(n(71)),H=n(72),K=n.n(H),Q={generate:function(){return X.apply(this,arguments)}};function X(){return(X=Object(c.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:B.a.wait(G("generating-report"),tt());case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}function tt(){return et.apply(this,arguments)}function et(){return(et=Object(c.a)(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Z.loadTextFromURL(K.a);case 2:return e=t.sent,t.next=5,$.saveAs(new Blob([e]),"report.ods");case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}n(73);var nt=function(t){function e(t){var n;return Object(R.a)(this,e),(n=Object(q.a)(this,Object(J.a)(e).call(this,t))).handleStatClick=function(){var t=n.props.onStatClick;"function"===typeof t&&t(n.props.carecenter)},n.handleStructClick=function(){var t=n.props.onStructClick;"function"===typeof t&&t(n.props.carecenter)},n.handleReportClick=function(){Q.generate()},n.handleStatClick=n.handleStatClick.bind(Object(W.a)(Object(W.a)(n))),n}return Object(V.a)(e,t),Object(_.a)(e,[{key:"render",value:function(){var t=this.props.carecenter,e=this.props.structures.find(function(e){return e.id===t.structureId});return i.createElement("div",{className:"presentational-carecenter-header"},i.createElement("div",null,i.createElement("div",{className:"name"},t.name),i.createElement("div",{className:"prop"},i.createElement("div",null,G("code")),i.createElement("div",null,t.id,"-",t.code)),i.createElement("div",{className:"prop"},i.createElement("div",null,G("patients-count")),i.createElement("div",null,t.patientsCount)),i.createElement("div",{className:"prop"},i.createElement("div",null,G("consultations-count")),i.createElement("div",null,t.consultationsCount)),i.createElement("div",{className:"prop"},i.createElement("div",null,G("struct")),i.createElement("div",null,e?e.name:"..."))),i.createElement("div",{className:"buttons"},i.createElement(Y.a,{icon:"stat",small:!0,onClick:this.handleStatClick}),i.createElement("br",null),i.createElement(Y.a,{icon:"report",small:!0,onClick:this.handleReportClick}),i.createElement("br",null)))}}]),e}(i.Component),at=n(22),rt=n(28),ct=n(30),it=(n(35),n(74),function(t,e){var n=0;return function(){for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];n&&window.clearTimeout(n),n=window.setTimeout(function(){n=0,t.apply(void 0,r)},e)}}),ot=b.a.make(n(75)),st=function(t){function e(t){var n;return Object(R.a)(this,e),(n=Object(q.a)(this,Object(J.a)(e).call(this,t))).inputDay=void 0,n.inputMonth=void 0,n.inputYear=void 0,n.state={},n.handleChange=it(n.handleChange.bind(Object(W.a)(Object(W.a)(n))),300),n.inputDay=i.createRef(),n.inputMonth=i.createRef(),n.inputYear=i.createRef(),n}return Object(V.a)(e,t),Object(_.a)(e,[{key:"handleChange",value:function(){try{var t=parseInt(this.inputDay.current.value);if(isNaN(t))throw"day is not a number!";var e=parseInt(this.inputMonth.current.value);if(isNaN(e))throw"month is not a number!";var n=parseInt(this.inputYear.current.value);if(isNaN(n))throw"year is not a number!";var a=new Date(n,e,t);if(a.getFullYear()!==n||a.getMonth()!==e||a.getDate()!==t)throw"Invalid date!";this.setState({error:""});var r=this.props.onChange;if("function"!==typeof r)return;r(a.getTime())}catch(c){this.setState({error:ot("invalid")})}}},{key:"render",value:function(){var t=this.props,e=Object(E.a)(t.label,""),n=Object(at.a)(t.value,0),a=Object(w.a)(t.wide,!1),r=Object(E.a)(this.state.error,""),c=new Date(n),o="tfw-view-input-".concat(ut++),s=["tfw-view-input-date","thm-ele-button"];a&&s.push("wide");var u=r.length>0?i.createElement("div",{className:"thm-bgSD error"},r):e?i.createElement("label",{htmlFor:o,className:"thm-bgPD"},e):null;return i.createElement("div",{className:s.join(" ")},u,i.createElement("div",{className:"inputs"},i.createElement("input",{ref:this.inputDay,className:"day",type:"number",maxLength:"2",min:"1",max:"31",id:o,size:"2",onChange:this.handleChange,defaultValue:c.getDate()}),i.createElement("select",{ref:this.inputMonth,onChange:this.handleChange,defaultValue:c.getMonth()},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(t){return i.createElement("option",{key:t,value:t},ot("month-".concat(t)))})),i.createElement("input",{ref:this.inputYear,className:"year",type:"number",maxLength:"4",size:"4",onChange:this.handleChange,defaultValue:c.getFullYear()})))}}]),e}(i.Component),ut=0;var lt=function(t){function e(t){var n;return Object(R.a)(this,e),(n=Object(q.a)(this,Object(J.a)(e).call(this,t))).handleTypeChange=n.handleTypeChange.bind(Object(W.a)(Object(W.a)(n))),n.handleDateMinChange=n.handleDateMinChange.bind(Object(W.a)(Object(W.a)(n))),n.handleDateMaxChange=n.handleDateMaxChange.bind(Object(W.a)(Object(W.a)(n))),n}return Object(V.a)(e,t),Object(_.a)(e,[{key:"handleTypeChange",value:function(t){var e=this.props.onTypeChange;"function"===typeof e&&e(0===t?"patients":"consultations")}},{key:"handleDateMinChange",value:function(t){var e=this.props.onDateMinChange;if("function"===typeof e)try{e(t)}catch(n){console.error("Error in handleDateMinChange(date): ",t),console.error(n)}}},{key:"handleDateMaxChange",value:function(t){var e=this.props.onDateMaxChange;if("function"===typeof e)try{e(t)}catch(n){console.error("Error in handleDateMaxChange(date): ",t),console.error(n)}}},{key:"render",value:function(){var t=this.props,e=Object(E.a)(t.statsType,"consultations"),n=Object(at.a)(t.dateMin,Date.now()),a=Object(at.a)(t.dateMax,Date.now()),r=["consultations","patients"];return o.a.createElement("div",null,o.a.createElement(ct.a,{wide:!0,label:G("stat-type"),keys:r,value:e},r.map(function(t){return o.a.createElement("div",{key:t},G(t))})),o.a.createElement(rt.a,null,o.a.createElement("div",null,o.a.createElement(st,{label:G("date-min"),onChange:this.handleDateMinChange,value:n})),o.a.createElement("div",null,o.a.createElement(st,{label:G("date-max"),onChange:this.handleDateMaxChange,value:a}))))}}]),e}(o.a.Component);var dt=Object(l.b)(function(t){return{statsType:t.statsConfig.statsType,dateMin:t.statsConfig.dateMin,dateMax:t.statsConfig.dateMax}},function(t){return{onTypeChange:function(e){t(j.setType(e))},onDateMinChange:function(e){console.info("[onDateMinChange] date=",e),t(j.setDateMin(e))},onDateMaxChange:function(e){t(j.setDateMax(e))}}})(lt),ft={show:function(){var t=B.a.show({closeOnEscape:!0,icon:"stat",title:G("create-stat"),content:i.createElement(l.a,{store:T.store},i.createElement(dt,null)),footer:[i.createElement(Y.a,{key:"cancel",label:G("cancel"),flat:!0,onClick:function(){return t.hide()}}),i.createElement(Y.a,{key:"ok",label:G("create-stat"),warning:!0,onClick:function(){t.hide(),T.dispatch(T.addStat())}})]})}};var pt=Object(l.b)(function(t){return{}},function(t){return{onStatClick:function(e){console.log("carecenter=",e),t(T.initStatsConfig(e.id)),ft.show()},onStructClick:function(t){console.log("carecenter=",t)}}})(nt),ht=n(20),mt=n(29),vt=(n(76),["#b37036","#cc7529","#e67717","#ff7700","#765"]),gt=function(t){function e(){var t,n;Object(R.a)(this,e);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(q.a)(this,(t=Object(J.a)(e)).call.apply(t,[this].concat(r)))).canvas=i.createRef(),n}return Object(V.a)(e,t),Object(_.a)(e,[{key:"componentDidMount",value:function(){this.paint()}},{key:"componentDidUpdate",value:function(){this.paint()}},{key:"paint",value:function(){if(this.canvas.current){var t=this.canvas.current,e=this.props.values,n=Object(mt.a)(this.props.colors,vt).slice(),a=t.width,r=Math.floor(a/2)-3,c=2*Math.PI,i=c/a,o=this.props.values.reduce(function(t,e){return e+t}),s=t.getContext("2d");if(s){var u=0,l=0,d=function(t){return s.lineTo(r*Math.sin(t),-r*Math.cos(t))};if(s.save(),s.clearRect(0,0,a,a),o>0){s.translate(a/2,a/2),s.fillStyle="#000",s.globalAlpha=.5,s.ellipse(0,0,a/2,a/2,0,0,2*Math.PI),s.fill(),s.strokeStyle="#000",s.lineWidth=1;for(var f=0;f<n.length;f++){var p=n[f%n.length];s.fillStyle=p,s.beginPath(),s.moveTo(0,0),l=u+c*e[f]/o;do{d(u),u+=i}while(u<l);d(l),u=l,s.closePath(),s.globalAlpha=1,s.fill(),s.globalAlpha=.2,s.stroke()}}s.restore()}}}},{key:"render",value:function(){var t=this.props,e=(Object(mt.a)(t.colors,vt),Object(at.a)(t.size,200));return i.createElement("canvas",{ref:this.canvas,width:e,height:e,className:"presentation-pie"})}}]),e}(i.Component),bt=n(13),yt={extract:function(){var t=Object(c.a)(r.a.mark(function t(e){var n,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.a.exec("extract",{carecenter:e.carecenter.id,begin:Ct(e.dateMin),end:Ct(e.dateMax)});case 2:return n=t.sent,a={},Object.values(n.data).forEach(function(t){Object.keys(t).filter(function(t){return"#"===t.charAt(0)}).forEach(function(e){var n=t[e];"undefined"===typeof a[e]&&(a[e]={});var r=a[e];"undefined"===typeof r[n]?r[n]=1:r[n]++})}),t.abrupt("return",Et(a));case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()};function Ct(t){return Math.floor(.5+.001*t)}function Et(t){var e={};return Object.keys(t).forEach(function(n){var a={sum:0,occ:[]};e[n]=a;var r=t[n];Object.keys(r).forEach(function(t){var e=r[t];a.sum+=e,a.occ.push([t,e])}),a.occ.sort(wt)}),e}function wt(t,e){var n=t[1];return e[1]-n}n(78);var jt=b.a.make(n(77)),Ot=["#b37036","#cc7529","#e67717","#ff7700","#765"],kt=function(t){function e(t){var n;return Object(R.a)(this,e),(n=Object(q.a)(this,Object(J.a)(e).call(this,t))).state={selectedField:""},n.handleClose=n.handleClose.bind(Object(W.a)(Object(W.a)(n))),n}return Object(V.a)(e,t),Object(_.a)(e,[{key:"handleClose",value:function(){var t=this.props.onClose;if("function"===typeof t)try{t()}catch(e){console.error("Error in handleClose(): "),console.error(e)}}},{key:"componentDidUpdate",value:function(){this.state.dataFromService||(console.log("componentDidUpdate"),this.refresh())}},{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.refresh()}},{key:"refresh",value:function(){var t=Object(c.a)(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,yt.extract(this.props.stat);case 2:e=t.sent,console.info("data=",e),this.setState({dataFromService:e});case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"export",value:function(){var t=this.state.dataFromService;if(t){var e=xt(t,this.props.structure),n=e.keys,a=e.values,r=["Code du champ\tNom du champ\tValeur\tOccurences"];n.forEach(function(e,n){var c=a[n];t[e].occ.forEach(function(t){var n=Object(ht.a)(t,2),a=n[0],i=n[1];r.push("".concat(e,"\t").concat(c,"\t").concat(a,"\t").concat(i))})});$.saveAs(new Blob([r.join("\n")],{type:"text/csv"}),"statistics.xls")}}},{key:"render",value:function(){var t=this,e=this.state.dataFromService,n=null;if(e){var a=xt(e,this.props.structure),r=a.keys,c=a.values,o=this.state.selectedField;-1===r.indexOf(o)&&(o=r[0]);var s=e[o];n=s?i.createElement("div",null,i.createElement(ct.a,{keys:r,onChange:function(e){console.info("[onChange] selectedField=",e),t.setState({selectedField:e})},value:o},c.map(function(t,e){var n=r[e];return i.createElement("div",{key:n},i.createElement("b",null,"".concat(t," ")),i.createElement("small",{className:"grey"},n))})),i.createElement("br",null),i.createElement("center",null,i.createElement(gt,{colors:Ot,values:Tt(s)})),i.createElement("div",null,s.occ.map(function(t,e){var n=Object(ht.a)(t,2),a=n[0],r=n[1],c=Math.min(Ot.length-1,e),o=Ot[c];return i.createElement(rt.a,{key:e,justifyContent:"space-between",alignItems:"center",dir:"row",classes:e%2?"thm-bg1":"thm-bg2"},i.createElement(rt.a,{justifyContent:"space-between",wide:!1,dir:"row",alignItems:"center"},i.createElement("div",{className:"bullet",style:{background:o}}),i.createElement("span",null,a)),i.createElement("div",null,i.createElement("b",null,r)))})),i.createElement(Y.a,{wide:!0,icon:"export",label:jt("export"),onClick:function(){return t.export()}})):i.createElement("div",null,jt("no-data"))}else n=i.createElement(rt.a,null,i.createElement(bt.a,{content:"wait",animate:!0}),i.createElement("div",null,"Chargement en cours..."));var u=this.props.stat;return i.createElement("div",{className:"presentational-stat thm-ele-card thm-bg1"},i.createElement("div",{className:"thm-bgPD"},"".concat(u.carecenter.name,", du ").concat(St(u.dateMin)," au ").concat(St(u.dateMax))),i.createElement("div",null,n),i.createElement("hr",null),i.createElement(rt.a,{dir:"row",justifyContent:"flex-end"},i.createElement(Y.a,{onClick:this.handleClose,icon:"close",label:jt("close"),flat:!0})))}}]),e}(i.Component);function xt(t,e){var n=Object.keys(t),a=n.map(function(t){return y.getFieldCaption(t,e)}),r=n.map(function(t,e){return[t,a[e]]});return r.sort(function(t,e){var n=t[1],a=e[1];return n<a?-1:n>a?1:0}),{keys:r.map(function(t){return t[0]}),values:r.map(function(t){return t[1]})}}function St(t){var e=new Date(t);return"".concat(e.getDate(),"-").concat(1+e.getMonth(),"-").concat(e.getFullYear())}function Tt(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=t.sum,a=t.occ,r=[],c=0,i=0;i<Math.min(e,a.length);i++){var o=Object(ht.a)(a[i],2)[1];r.push(o),c+=o}return n>c&&r.push(n-c),r}var Mt=n(19),Dt=(n(79),function(t){function e(t){var n;return Object(R.a)(this,e),(n=Object(q.a)(this,Object(J.a)(e).call(this,t))).refMenu=o.a.createRef(),n.handleShowChange=n.handleShowChange.bind(Object(W.a)(Object(W.a)(n))),n}return Object(V.a)(e,t),Object(_.a)(e,[{key:"componentDidMount",value:function(){var t=this,e=this.refMenu.current;e&&Object(Mt.a)(e).on({swipeleft:function(){var e=t.props.onShowChange;"function"===typeof e&&e(!1)}})}},{key:"handleShowChange",value:function(){var t=this.props.onShowChange;"function"===typeof t&&t(!Object(w.a)(this.props.show,window.innerWidth>480))}},{key:"render",value:function(){var t=Object(w.a)(this.props.show,window.innerWidth>480),e=Object(E.a)(this.props.head,""),n=["tfw-layout-sidemenu thm-bg0"].concat(Object(mt.a)(this.props.classes));return t&&n.push("show"),o.a.createElement("div",{className:n.join(" ")},o.a.createElement("div",{className:"body thm-bg0"},this.props.body),o.a.createElement("div",{className:"menu thm-ele-nav thm-bg1",ref:this.refMenu},o.a.createElement("header",{className:"thm-ele-nav thm-bgPD"},e),o.a.createElement("menu",null," ",this.props.menu," ")),o.a.createElement("div",{className:"icon thm-bgPD"},o.a.createElement(Y.a,{icon:"menu",flat:!0,onClick:this.handleShowChange})))}}]),e}(o.a.Component));n(80);var It=Object(l.b)(function(t){var e=t.stats.map(function(e){var n=e.carecenter,a=n.id,r=t.structures.find(function(t){return t.id===a});if(!r)return console.error("There is no Structure with id=".concat(a,' in carecenter "').concat(n.name,'"!')),null;var c=k.statsConfig(e);return i.createElement(kt,{key:c,stat:e,onClose:function(){return T.dispatch(T.removeStat(c))},structure:r})});return{head:t.user.nickname,menu:i.createElement("div",null,i.createElement("ul",null,t.organizations.map(function(e){return i.createElement("li",{key:e.id},e.name,i.createElement("ul",null,t.carecenters.filter(function(t){return t.organizationId===e.id}).map(function(e){return i.createElement(pt,{key:e.id,carecenter:e,structures:t.structures})})))})),i.createElement("br",null),i.createElement("hr",null),i.createElement("br",null),i.createElement(Y.a,{label:G("logout"),icon:"logout",wide:!0,onClick:function(){return window.location.reload()}})),body:e.length>0?e:i.createElement(rt.a,{dir:"column",alignItems:"center",classes:["container-sidemenu","welcome"]},i.createElement("div",null,G("welcome")),i.createElement(bt.a,{content:"stat"}),i.createElement("div",null,G("report")),i.createElement(bt.a,{content:"report"}))}},function(t){return{onLanguageClick:function(){t(m.setLanguage("jp"))},onLogoutClick:function(){window.location.reload()}}})(Dt),Nt=(n(81),function(t){function e(){return Object(R.a)(this,e),Object(q.a)(this,Object(J.a)(e).apply(this,arguments))}return Object(V.a)(e,t),Object(_.a)(e,[{key:"render",value:function(){return i.createElement(It,{classes:"App"})}}]),e}(i.Component));e.default={start:function(){var t=Object(c.a)(r.a.mark(function t(e){var n,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=document.getElementById("root"),u.a.render(o.a.createElement(l.a,{store:T.store},o.a.createElement(Nt,{user:e})),n),T.dispatch(T.User.setLanguage(b.a.lang)),T.dispatch(T.User.setNickname(e.nickname)),t.next=6,D.list();case 6:a=t.sent,T.dispatch(T.Organizations.setOrganizations(a)),T.dispatch(T.Carecenters.setCarecenters([])),a.forEach(function(){var t=Object(c.a)(r.a.mark(function t(e){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z.list(e.id);case 2:return t.sent.forEach(function(t){T.dispatch(T.Structures.addStructure(t))}),t.next=6,I.list(e.id);case 6:t.sent.forEach(function(t){T.dispatch(T.Carecenters.addCarecenter(t))});case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}}}]);
//# sourceMappingURL=3.ee521a0c.chunk.js.map