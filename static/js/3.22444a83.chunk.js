(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{71:function(e,t){e.exports={fr:{"err-1":"Une ligne non vide et non comment\xe9e doit toujours commencer par au moins une ast\xe9risque pour indiquer le niveau hi\xe9rarchique.","err-2":"<html>Vous avez saut\xe9 au moins un niveau hi\xe9rarchique:<br/><code>$1</code> !<br/><br/>Vous \xe9tiez au niveau <b>$2</b> et vous d\xe9finissez maintenant le niveau <b>$3</b>.","err-3":"<html>Vous avez d\xe9j\xe0 d\xe9clar\xe9 cet identifiant : <b>$1</b> !"}}},72:function(e,t){e.exports={en:{cancel:"Cancel",close:"Close",code:"Code:",consultations:"Consultations","consultations-count":"Consultations:","create-stat":"Create Statistics","create-stat-consultation":"Consult. Statistics","create-stat-patient":"Patients Statistics","date-min":"Start Date","date-max":"End Date","genereting-report":"Generating report...",logout:"Logout",patients:"Patients","patients-count":"Patients:",report:"To add an annual report, clic on the left pane's button bearing the following icon:","stat-type":"Statistic Type",struct:"Structure:",welcome:"To add new statistics, clic on the left pane's button bearing the following icon:"},fr:{cancel:"Annuler",close:"Fermer",code:"Code :",consultations:"Consultations","consultations-count":"Consultations :","create-stat":"Cr\xe9er des statistiques","create-stat-consultation":"Stats consultations","create-stat-patient":"Stats patients","date-min":"Date de d\xe9but","date-max":"Date de fin","genereting-report":"Rapport en cours de r\xe9alisation...",logout:"D\xe9connexion",patients:"Patients","patients-count":"Patients :",report:"Pour \xe9diter un rapport annuel, cliquez sur le bouton avec l'ic\xf4ne suivante dans le panneau de gauche :","stat-type":"Type de statistique",struct:"Structure :",welcome:"Pour ajouter des statistiques, cliquez sur le bouton avec l'ic\xf4ne suivante dans le panneau de gauche : "}}},73:function(e,t,n){e.exports=n.p+"static/media/report.bdaf0634.fods"},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t){e.exports={en:{invalid:"Invalid date!","month-0":"Jan","month-1":"Feb","month-2":"Mar","month-3":"Apr","month-4":"May","month-5":"Jun","month-6":"Jul","month-7":"Aug","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"Dec"},fr:{invalid:"Date invalide !","month-0":"Jan","month-1":"F\xe9v","month-2":"Mar","month-3":"Avr","month-4":"Mai","month-5":"Jun","month-6":"Jul","month-7":"Aou","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"D\xe9c"}}},77:function(e,t,n){},78:function(e,t){e.exports={en:{close:"Close",export:"Export to Spreadsheet","no-data":"There is no data for this period!"},fr:{close:"Fermer",export:"Exporter vers un tableur","no-data":"Il n'y a aucune donn\xe9e sur cette p\xe9riode !"}}},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n.n(a),i=n(9),c=n(0),o=n.n(c),s=n(24),u=n.n(s),l=n(58),d=n(10),h=n(60),f=n(18),p=new Set(["nickname","language"]),m={INITIAL_STATE:{email:"",nickname:"",language:"",roles:[]},reducer:function(e,t){if(!t.type.startsWith("user:"))return e;var n=t.type.substr("user:".length);if(!p.has(n))throw Error('Unknown attribute "'.concat(n,'"!'));var a=t.data;return Object.assign(e,Object(f.a)({},n,a))},setLanguage:function(e){return{type:"user:language",data:e}},setNickname:function(e){return{type:"user:nickname",data:e}}},v={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("organization:"))return e;switch(t.type.substr("organization:".length)){case"set":return t.organizations.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.organization);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?t:e})}(e,t.organization);default:throw Error('Unknown action "'.concat(n,'"!'))}},setOrganizations:function(e){return{type:"organization:set",organizations:e}},addOrganization:function(e){return{type:"organization:add",organization:e}},updateOrganization:function(e){return{type:"organization:update",organization:e}}};var b={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("carecenter:"))return e;switch(t.type.substr("carecenter:".length)){case"set":return t.carecenters.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.carecenter);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?Object.assign(e,t):e})}(e,t.carecenter);default:throw Error('Unknown action "'.concat(n,'"!'))}},setCarecenters:function(e){return{type:"carecenter:set",carecenters:e}},addCarecenter:function(e){return{type:"carecenter:add",carecenter:e}},updateCarecenter:function(e){return{type:"carecenter:update",carecenter:e}}};var g=n(13),y={createPatientsFieldsFromStructure:function(e){var t={};return e.patientFields.forEach(function(e){t[e.id]=!0}),t},createPatientsFieldsCaptionsFromStructure:function(e){var t={};return e.patientFields.forEach(function(e){t[e.id]=g.a.toText(e.caption)}),t},getFieldCaption:function(e,t){if("#"!==e.charAt(0))return e;var n=t.formFields[e];return n?g.a.toText(n.caption):e}},E={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("structure:"))return e;switch(t.type.substr("structure:".length)){case"set":return t.structures.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.structure);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?Object.assign(e,t):e})}(e,t.structure);default:throw Error('Unknown action "'.concat(n,'"!'))}},setStructures:function(e){return{type:"structure:set",structures:e}},addStructure:function(e){return{type:"structure:add",structure:e}},updateStructure:function(e){return{type:"structure:update",structure:e}}};var O=n(5),C=n(3),k={INITIAL_STATE:{statsType:"consultations",dateMin:function(){var e=new Date;if(1!==e.getDate()){var t=new Date(e.getFullYear(),e.getMonth(),1);return t.getTime()}var n=new Date(e.getFullYear(),e.getMonth()-1,e.getDate());return n.getTime()}(),dateMax:Date.now(),patientsFields:{birthday:!0,size:!1,nationality:!0},patientsFieldsCaptions:{birthday:"Date de naissance",size:"Taille",nationality:"Nationalit\xe9"},carecenter:{id:0,organizationId:0,structureId:0,patientsCount:0,consultationsCount:0,name:"",code:""}},reducer:function(e,t){var n=t.type;if(!n.startsWith("stats-config:"))return e;switch(t.type.substr("stats-config:".length)){case"setType":return function(e,t){return Object(d.a)({},e,{statsType:t.statsType||"consultations"})}(e,t);case"setDateMin":return function(e,t){return Object(d.a)({},e,{dateMin:t.date})}(e,t);case"setDateMax":return function(e,t){return Object(d.a)({},e,{dateMax:t.date})}(e,t);case"setPatientsFields":return function(e,t){return Object(d.a)({},e,{patientsFields:t.fields||{}})}(e,t);case"setPatientField":return function(e,t){if("string"!==typeof t.fieldName)throw Error('action must have an attribute "fieldName" of type "string" but we found "'.concat(typeof t.fieldName,'"'));var n=Object(O.a)(t.fieldName,""),a=Object(C.a)(t.fieldVisibility,!1);return Object(d.a)({},e,{patientsFields:Object(d.a)({},e.patientsFields,Object(f.a)({},n,a))})}(e,t);default:throw Error('Unknown action "'.concat(n,'"!'))}},setType:function(e){return{type:"stats-config:setType",statsType:e}},setDateMin:function(e){return{type:"stats-config:setDateMin",date:e}},setDateMax:function(e){return{type:"stats-config:setDateMax",date:e}},setPatientsFields:function(e){return{type:"stats-config:setPatientsFields",fields:e}},setPatientField:function(e,t){return{type:"stats-config:setPatientField",fieldName:e,fieldVisibility:t}}};var x={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("stats:"))return e;switch(t.type.substr("stats:".length)){case"addStat":return function(e,t){var n=e.stats.slice();return n.push(t.stat),n}(e,t);default:throw Error('Unknown action "'.concat(n,'"!'))}},addStat:function(e){return{type:"stats:addStat",stat:e}}};var w={statsConfig:function(e){return"".concat(e.statsType,"/").concat(e.dateMin,"-").concat(e.dateMax)}};var j={user:m.INITIAL_STATE,organizations:v.INITIAL_STATE,carecenters:b.INITIAL_STATE,structures:E.INITIAL_STATE,statsConfig:k.INITIAL_STATE,stats:x.INITIAL_STATE};var S=Object(h.b)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(console.log("state =",e),t.type){case"initStatsConfig":return function(e,t){var n=t.carecenterId,a=e.carecenters.find(function(e){return e.id===n});if(!a)throw Error("There is no Carecenter with id=".concat(n,"!"));var r=a.structureId;if("number"!==typeof r)throw Error('Missing attribute number "structureId"!');var i=e.structures.find(function(e){return e.id===r});if(!i)throw Error("There is no structure with id ".concat(r,"!"));return Object(d.a)({},e,{statsConfig:Object(d.a)({},e.statsConfig,{carecenter:a,patientsFields:y.createPatientsFieldsFromStructure(i),patientsFieldsCaptions:y.createPatientsFieldsCaptionsFromStructure(i)})})}(e,t);case"addStat":return function(e,t){var n=w.statsConfig(e.statsConfig),a=e.stats.filter(function(e){return w.statsConfig(e)!==n});return a.push(Object(d.a)({},e.statsConfig)),Object(d.a)({},e,{stats:a})}(e);case"removeStat":return function(e,t){var n=e.stats.filter(function(e){return w.statsConfig(e)!==t.key});return Object(d.a)({},e,{stats:n})}(e,t);default:return{user:m.reducer(e.user,t),stats:x.reducer(e.stats,t),organizations:v.reducer(e.organizations,t),carecenters:b.reducer(e.carecenters,t),structures:E.reducer(e.structures,t),statsConfig:k.reducer(e.statsConfig,t)}}});var T={store:S,dispatch:function(e){S.dispatch(e)},User:m,Organizations:v,Carecenters:b,Structures:E,StatsConfig:k,initStatsConfig:function(e){return{type:"initStatsConfig",carecenterId:e}},addStat:function(){return{type:"addStat"}},removeStat:function(e){return{type:"removeStat",key:e}}},N=n(16),M={list:function(){var e=Object(i.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("orga.list");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},I={list:function(){var e=Object(i.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("carecenter.list",t);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return{id:e.id,name:e.name,code:e.code,patientsCount:e.patientsCount,consultationsCount:e.consultationsCount,structureId:e.structure,organizationId:t}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},D=g.a.make(n(71)),A=/^(#[A-Z0-9-]+)?([^\(@]*)(\([^\)]*\)\+?)?(@[A-Z0-9,-]+)?/;var F={parse:function(e){var t={},n=[t];return"string"!==typeof e&&(e="".concat(e)),e.split("\n").forEach(function(e,t){try{if(0===(e=e.trim()).length)return;if("//"===e.substr(0,2))return;if("*"!==e.charAt(0))throw D("err-1");var a=function(e){for(var t=0;"*"==e.charAt(0);)e=e.substr(1),t++;return t}(e);if(e=e.substr(a).trim(),a>n.length)throw D("err-2",e,n.length-1,a);for(;n.length>a;)n.pop();var r=function(e){var t={children:{}},n=A.exec(e.trim());return n[2]&&(t.caption=n[2].trim()),n[1]?t.id=n[1].trim():t.id=t.caption.toUpperCase(),n[3]&&(t.type=n[3].substr(1,n[3].length-2).trim()),n[4]&&(t.tags=n[4].trim().substr(1).split(",").map(function(e){return e.trim()})),t}(e);if("undefined"!==typeof n[n.length-1][r.id])throw D("err-3",r.id);n[n.length-1][r.id]=r,n.push(r.children||{})}catch(i){throw{lineNumber:t+1,message:i}}}),t},flattenFormsFields:function(e){var t=[];return function e(t,n,a){Object.keys(t).forEach(function(r){var i=t[r];"string"===typeof i.id&&"#"===i.id.charAt(0)?n.push({id:i.id,caption:i.caption,path:a.slice()}):i.children&&(a.push(i.caption),e(i.children,n,a),a.pop())})}(e,t,[]),t.sort(function(e,t){var n=e.caption,a=t.caption;return n<a?-1:n>a?1:0}),t}},z={list:function(){var e=Object(i.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("structure.list",t);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return{id:e.id,organizationId:t,name:e.name,patientFields:P(e.patient),formFields:R(e),exams:L(e.exams),vaccins:L(e.vaccins),forms:L(e.forms),types:L(e.types),sources:{exams:e.exams,vaccins:e.vaccins,patient:e.patient,forms:e.forms,types:e.types}}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function L(e){try{return F.parse(e)}catch(t){console.error("[parsePatient] ",t),console.log(e)}return null}function P(e){try{var t=F.parse(e);return Object.keys(t).map(function(e){var n=t[e];return{id:e,type:n.type,caption:g.a.toIntl(n.caption)}})}catch(n){console.error("[parsePatient] ",n)}return[]}function R(e){for(var t={},n=[L(e.forms)];n.length>0;)for(var a=n.shift(),r=0,i=Object.keys(a);r<i.length;r++){var c=i[r],o=a[c];t[c]={caption:g.a.toIntl(o.caption)},o.type&&(t[c].type=o.type),o.children&&n.push(o.children)}return t}var _=n(2),U=n(1),J=n(7),B=n(6),W=n(8),q=n(11),V=n(15),Y=1,$=2,G=3,X=4,Z=5,H=6,K=7,Q=8,ee=["???","OBJ_OPEN","OBJ_CLOSE","ARR_OPEN","ARR_CLOSE","STRING","NUMBER","SPECIAL","COLON"],te={OBJ_OPEN:Y,OBJ_CLOSE:$,ARR_OPEN:G,ARR_CLOSE:X,STRING:Z,NUMBER:H,SPECIAL:K,COLON:Q,tokenize:function(e){return(new ce).tokenize(e)},getTypeName:function(e){return ee[e]}},ne=/^-?(\.[0-9]+|[0-9]+(\.[0-9]+)?)([eE]-?[0-9]+)?$/,ae=/^-?0x[0-9a-f]+$/i,re=/^-?0o[0-7]+$/i,ie=/^-?0b[01]+$/i,ce=function(){function e(){var t=this;Object(_.a)(this,e),this.eaters=void 0,this.source="",this.index=0,this.end=0,this.tokens=[],this.eatBlanks=function(){for(;-1!==" \t\n\r".indexOf(t.peek()||"?");)t.index++},this.eatSymbol=function(){var e=null;switch(t.peek()){case"{":e=Y;break;case"}":e=$;break;case"[":e=G;break;case"]":e=X;break;case":":e=Q;break;case",":return void t.index++}e&&(t.addToken(e),t.index++)},this.eatComment=function(){if("/"===t.peek()){t.index++;var e=t.next();if("/"==e){var n=t.source.indexOf("\n",t.index);t.index=-1===n?t.end:n+1}else if("*"==e){var a=t.source.indexOf("*/",t.index);t.index=-1===a?t.end:a+1}else t.fail("'/' looks like a comment, but it is not!")}},this.eatString=function(){var e=t.index,n=t.peek();if('"'===n||"'"===n){t.index++;for(var a=!1,r="";!t.eos();){var i=t.next();if(a)a=!1,"n"===i?i="\n":"r"===i?i="\r":"t"===i&&(i="\t"),r+=i;else if("\\"===i)a=!0;else{if(i===n)return void t.addToken(Z,e,r);r+=i}}t.index=e,t.fail("Missing en of string")}},this.eatIdentifier=function(){var e=t.index,n=t.peek()||"?";if(-1===" \t\n\r,:[]{}/".indexOf(n)){t.index++;for(var a=n;!t.eos()&&(n=t.peek()||"?",-1===" \t\n\r,:[]{}/".indexOf(n));)a+=n,t.index++;if(ne.test(a))t.addToken(H,e,parseFloat(a));else if(ae.test(a))t.addToken(H,e,parseInt(a,16));else if(re.test(a))a="-"==a.charAt(0)?"-"+a.substr(3):a.substr(2),t.addToken(H,e,parseInt(a,8));else if(ie.test(a))a="-"==a.charAt(0)?"-"+a.substr(3):a.substr(2),t.addToken(H,e,parseInt(a,2));else{var r=K;"null"===a?a=null:"undefined"===a?a=void 0:"true"===a?a=!0:"false"===a?a=!1:r=Z,t.addToken(r,e,a)}}},this.eaters=[this.eatBlanks,this.eatSymbol,this.eatComment,this.eatString,this.eatIdentifier]}return Object(U.a)(e,[{key:"tokenize",value:function(e){for(this.source=e,this.end=e.length,this.index=0,this.tokens=[];this.index<this.end;){for(var t=this.index,n=0;n<this.eaters.length;n++){if((0,this.eaters[n])(),this.index!==t)break}this.index===t&&this.fail("Unexpected token at pos ".concat(this.index,":\n").concat(e.substr(this.index,80)))}return this.tokens}},{key:"fail",value:function(e){throw"undefined"===typeof e&&(e="Invalid char at "+this.index+"!"),{index:this.index,source:this.source,message:e}}},{key:"eos",value:function(){return this.index>=this.end}},{key:"peek",value:function(){return this.eos()?null:this.source[this.index]}},{key:"next",value:function(){return this.eos()?null:this.source[this.index++]}},{key:"back",value:function(){this.index>0&&this.index--}},{key:"addToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";-1===t&&(t=this.index),this.tokens.push({type:e,index:t,value:n})}}]),e}(),oe={parse:function(e){try{var t=te.tokenize(e),n=new se(t),a=n.parse();return a}catch(r){throw r.type,r}}};var se=function e(t){Object(_.a)(this,e),this.tokens=t,this.index=0};se.prototype.peek=function(){return this.tokens[this.index]},se.prototype.next=function(){return this.tokens[this.index++]},se.prototype.back=function(){this.index=Math.max(0,this.index-1)},se.prototype.parse=function(){var e=this.next();switch(e.type){case te.OBJ_OPEN:return this.parseObject();case te.ARR_OPEN:return this.parseArray();case te.STRING:case te.NUMBER:case te.SPECIAL:return e.value}this.back(),this.fail(e)},se.prototype.parseArray=function(){for(var e,t=this.index,n=[];void 0!==(e=this.peek());){if(e.type===te.ARR_CLOSE)return this.next(),n;n.push(this.parse())}this.fail("Opening braket at position "+t+" has no corresponding closing one!",t)},se.prototype.parseObject=function(){for(var e,t,n,a=this.index,r={},i=0;void 0!==(e=this.peek());){if(e.type===te.OBJ_CLOSE)return this.next(),r;if(t=this.parse(),(e=this.peek()).type===te.OBJ_CLOSE)return r[i++]=t,this.next(),r;e.type===te.COLON?(this.next(),n=this.parse(),r[t]=n):r[i++]=t}this.fail("Opening brace at position "+a+" has no corresponding closing one!",a)},se.prototype.fail=function(e,t){if("string"===typeof e)throw{message:e,index:t};throw{index:e.index,message:"Unexpected token "+te.getTypeName(e.type)+" at position "+e.index+"!"}};var ue={saveAs:function(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");a.style.display="none",a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(n)},5e3)}},le=n(12),de={padNumber:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",a="".concat(e);a.length<t;)a=n.charAt(0)+a;return a},clamp:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e<t?t:e>n?n:e},loadTextFromURL:function(e){return new Promise(function(t,n){fetch(e).then(function(e){return e.ok||n("Error ".concat(e.status,": ").concat(e.statusText,"!")),e.text()}).then(t).catch(n)})},loadJsonFromURL:function(e){return new Promise(function(t,n){fetch(e).then(function(e){return e.json()}).then(t).catch(n)})}},he=g.a.make(n(72)),fe=n(73),pe=n.n(fe),me={generate:function(e){return ve.apply(this,arguments)}};function ve(){return(ve=Object(i.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:le.a.wait(he("generating-report"),be(t));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function be(e){return ge.apply(this,arguments)}function ge(){return(ge=Object(i.a)(r.a.mark(function e(t){var n,a,i,c,o,s,u;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de.loadTextFromURL(pe.a);case 2:return n=e.sent,a=new DOMParser,i=a.parseFromString(n,"application/xml"),c=[],ye(i.documentElement,c),e.next=9,N.a.exec("report",c.map(function(e){var n=(e.textContent||"{}").trim().substr(1);try{return Object(d.a)({},oe.parse(n.substr(0,n.length-1)),t)}catch(r){var a;return console.error(r),console.info("elem=",e),a={},Object(f.a)(a,0,"echo"),Object(f.a)(a,1,n),a}}));case 9:return o=e.sent,console.info("data=",o),o.forEach(function(e,t){var n=c[t],a=parseFloat(e);if(n.textContent=e,!Number.isNaN(a)){var r=n.parentElement;if(!r)return;var i=r.parentElement;if(!i)return;i.setAttribute("office:value-type","float"),i.setAttribute("calcext:value-type","float"),i.setAttribute("office:value",e)}}),s=new XMLSerializer,u=s.serializeToString(i),e.next=16,ue.saveAs(new Blob([u]),"report.ods");case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ye(e,t){switch(e.nodeType){case Node.ELEMENT_NODE:var n=!0,a=!1,r=void 0;try{for(var i,c=e.childNodes[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){ye(i.value,t)}}catch(s){a=!0,r=s}finally{try{n||null==c.return||c.return()}finally{if(a)throw r}}break;case Node.TEXT_NODE:var o=(e.textContent||"").trim();o.startsWith("{{")&&o.endsWith("}}")&&t.push(e)}}n(74);var Ee=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(B.a)(t).call(this,e))).handleStatClick=function(){var e=n.props.onStatClick;"function"===typeof e&&e(n.props.carecenter)},n.handleStructClick=function(){var e=n.props.onStructClick;"function"===typeof e&&e(n.props.carecenter)},n.handleReportClick=function(){var e=n.props.carecenter;me.generate({carecenter:e.id})},n.handleStatClick=n.handleStatClick.bind(Object(q.a)(Object(q.a)(n))),n}return Object(W.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){var e=this.props.carecenter,t=this.props.structures.find(function(t){return t.id===e.structureId});return c.createElement("div",{className:"presentational-carecenter-header"},c.createElement("div",null,c.createElement("div",{className:"name"},e.name),c.createElement("div",{className:"prop"},c.createElement("div",null,he("code")),c.createElement("div",null,e.id,"-",e.code)),c.createElement("div",{className:"prop"},c.createElement("div",null,he("patients-count")),c.createElement("div",null,e.patientsCount)),c.createElement("div",{className:"prop"},c.createElement("div",null,he("consultations-count")),c.createElement("div",null,e.consultationsCount)),c.createElement("div",{className:"prop"},c.createElement("div",null,he("struct")),c.createElement("div",null,t?t.name:"..."))),c.createElement("div",{className:"buttons"},c.createElement(V.a,{icon:"stat",small:!0,onClick:this.handleStatClick}),c.createElement("br",null),c.createElement(V.a,{icon:"report",small:!0,onClick:this.handleReportClick}),c.createElement("br",null)))}}]),t}(c.Component),Oe=n(23),Ce=n(28),ke=n(30),xe=(n(34),n(75),function(e,t){var n=0;return function(){for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];n&&window.clearTimeout(n),n=window.setTimeout(function(){n=0,e.apply(void 0,r)},t)}}),we=g.a.make(n(76)),je=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(B.a)(t).call(this,e))).inputDay=void 0,n.inputMonth=void 0,n.inputYear=void 0,n.state={},n.handleChange=xe(n.handleChange.bind(Object(q.a)(Object(q.a)(n))),300),n.inputDay=c.createRef(),n.inputMonth=c.createRef(),n.inputYear=c.createRef(),n}return Object(W.a)(t,e),Object(U.a)(t,[{key:"handleChange",value:function(){try{var e=parseInt(this.inputDay.current.value);if(isNaN(e))throw"day is not a number!";var t=parseInt(this.inputMonth.current.value);if(isNaN(t))throw"month is not a number!";var n=parseInt(this.inputYear.current.value);if(isNaN(n))throw"year is not a number!";var a=new Date(n,t,e);if(a.getFullYear()!==n||a.getMonth()!==t||a.getDate()!==e)throw"Invalid date!";this.setState({error:""});var r=this.props.onChange;if("function"!==typeof r)return;r(a.getTime())}catch(i){this.setState({error:we("invalid")})}}},{key:"render",value:function(){var e=this.props,t=Object(O.a)(e.label,""),n=Object(Oe.a)(e.value,0),a=Object(C.a)(e.wide,!1),r=Object(O.a)(this.state.error,""),i=new Date(n),o="tfw-view-input-".concat(Se++),s=["tfw-view-input-date","thm-ele-button"];a&&s.push("wide");var u=r.length>0?c.createElement("div",{className:"thm-bgSD error"},r):t?c.createElement("label",{htmlFor:o,className:"thm-bgPD"},t):null;return c.createElement("div",{className:s.join(" ")},u,c.createElement("div",{className:"inputs"},c.createElement("input",{ref:this.inputDay,className:"day",type:"number",maxLength:"2",min:"1",max:"31",id:o,size:"2",onChange:this.handleChange,defaultValue:i.getDate()}),c.createElement("select",{ref:this.inputMonth,onChange:this.handleChange,defaultValue:i.getMonth()},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(e){return c.createElement("option",{key:e,value:e},we("month-".concat(e)))})),c.createElement("input",{ref:this.inputYear,className:"year",type:"number",maxLength:"4",size:"4",onChange:this.handleChange,defaultValue:i.getFullYear()})))}}]),t}(c.Component),Se=0;var Te=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(B.a)(t).call(this,e))).handleTypeChange=n.handleTypeChange.bind(Object(q.a)(Object(q.a)(n))),n.handleDateMinChange=n.handleDateMinChange.bind(Object(q.a)(Object(q.a)(n))),n.handleDateMaxChange=n.handleDateMaxChange.bind(Object(q.a)(Object(q.a)(n))),n}return Object(W.a)(t,e),Object(U.a)(t,[{key:"handleTypeChange",value:function(e){var t=this.props.onTypeChange;"function"===typeof t&&t(0===e?"patients":"consultations")}},{key:"handleDateMinChange",value:function(e){var t=this.props.onDateMinChange;if("function"===typeof t)try{t(e)}catch(n){console.error("Error in handleDateMinChange(date): ",e),console.error(n)}}},{key:"handleDateMaxChange",value:function(e){var t=this.props.onDateMaxChange;if("function"===typeof t)try{t(e)}catch(n){console.error("Error in handleDateMaxChange(date): ",e),console.error(n)}}},{key:"render",value:function(){var e=this.props,t=Object(O.a)(e.statsType,"consultations"),n=Object(Oe.a)(e.dateMin,Date.now()),a=Object(Oe.a)(e.dateMax,Date.now()),r=["consultations","patients"];return o.a.createElement("div",null,o.a.createElement(ke.a,{wide:!0,label:he("stat-type"),keys:r,value:t},r.map(function(e){return o.a.createElement("div",{key:e},he(e))})),o.a.createElement(Ce.a,null,o.a.createElement("div",null,o.a.createElement(je,{label:he("date-min"),onChange:this.handleDateMinChange,value:n})),o.a.createElement("div",null,o.a.createElement(je,{label:he("date-max"),onChange:this.handleDateMaxChange,value:a}))))}}]),t}(o.a.Component);var Ne=Object(l.b)(function(e){return{statsType:e.statsConfig.statsType,dateMin:e.statsConfig.dateMin,dateMax:e.statsConfig.dateMax}},function(e){return{onTypeChange:function(t){e(k.setType(t))},onDateMinChange:function(t){console.info("[onDateMinChange] date=",t),e(k.setDateMin(t))},onDateMaxChange:function(t){e(k.setDateMax(t))}}})(Te),Me={show:function(){var e=le.a.show({closeOnEscape:!0,icon:"stat",title:he("create-stat"),content:c.createElement(l.a,{store:T.store},c.createElement(Ne,null)),footer:[c.createElement(V.a,{key:"cancel",label:he("cancel"),flat:!0,onClick:function(){return e.hide()}}),c.createElement(V.a,{key:"ok",label:he("create-stat"),warning:!0,onClick:function(){e.hide(),T.dispatch(T.addStat())}})]})}};var Ie=Object(l.b)(function(e){return{}},function(e){return{onStatClick:function(t){console.log("carecenter=",t),e(T.initStatsConfig(t.id)),Me.show()},onStructClick:function(e){console.log("carecenter=",e)}}})(Ee),De=n(21),Ae=n(29),Fe=(n(77),["#b37036","#cc7529","#e67717","#ff7700","#765"]),ze=function(e){function t(){var e,n;Object(_.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(J.a)(this,(e=Object(B.a)(t)).call.apply(e,[this].concat(r)))).canvas=c.createRef(),n}return Object(W.a)(t,e),Object(U.a)(t,[{key:"componentDidMount",value:function(){this.paint()}},{key:"componentDidUpdate",value:function(){this.paint()}},{key:"paint",value:function(){if(this.canvas.current){var e=this.canvas.current,t=this.props.values,n=Object(Ae.a)(this.props.colors,Fe).slice(),a=e.width,r=Math.floor(a/2)-3,i=2*Math.PI,c=i/a,o=this.props.values.reduce(function(e,t){return t+e}),s=e.getContext("2d");if(s){var u=0,l=0,d=function(e){return s.lineTo(r*Math.sin(e),-r*Math.cos(e))};if(s.save(),s.clearRect(0,0,a,a),o>0){s.translate(a/2,a/2),s.fillStyle="#000",s.globalAlpha=.5,s.ellipse(0,0,a/2,a/2,0,0,2*Math.PI),s.fill(),s.strokeStyle="#000",s.lineWidth=1;for(var h=0;h<n.length;h++){var f=n[h%n.length];s.fillStyle=f,s.beginPath(),s.moveTo(0,0),l=u+i*t[h]/o;do{d(u),u+=c}while(u<l);d(l),u=l,s.closePath(),s.globalAlpha=1,s.fill(),s.globalAlpha=.2,s.stroke()}}s.restore()}}}},{key:"render",value:function(){var e=this.props,t=(Object(Ae.a)(e.colors,Fe),Object(Oe.a)(e.size,200));return c.createElement("canvas",{ref:this.canvas,width:t,height:t,className:"presentation-pie"})}}]),t}(c.Component),Le=n(14),Pe={extract:function(){var e=Object(i.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("extract",{carecenter:t.carecenter.id,begin:Re(t.dateMin),end:Re(t.dateMax)});case 2:return n=e.sent,a={},Object.values(n.data).forEach(function(e){Object.keys(e).filter(function(e){return"#"===e.charAt(0)}).forEach(function(t){var n=e[t];"undefined"===typeof a[t]&&(a[t]={});var r=a[t];"undefined"===typeof r[n]?r[n]=1:r[n]++})}),e.abrupt("return",_e(a));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function Re(e){return Math.floor(.5+.001*e)}function _e(e){var t={};return Object.keys(e).forEach(function(n){var a={sum:0,occ:[]};t[n]=a;var r=e[n];Object.keys(r).forEach(function(e){var t=r[e];a.sum+=t,a.occ.push([e,t])}),a.occ.sort(Ue)}),t}function Ue(e,t){var n=e[1];return t[1]-n}n(79);var Je=g.a.make(n(78)),Be=["#b37036","#cc7529","#e67717","#ff7700","#765"],We=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(B.a)(t).call(this,e))).state={selectedField:""},n.handleClose=n.handleClose.bind(Object(q.a)(Object(q.a)(n))),n}return Object(W.a)(t,e),Object(U.a)(t,[{key:"handleClose",value:function(){var e=this.props.onClose;if("function"===typeof e)try{e()}catch(t){console.error("Error in handleClose(): "),console.error(t)}}},{key:"componentDidUpdate",value:function(){this.state.dataFromService||(console.log("componentDidUpdate"),this.refresh())}},{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.refresh()}},{key:"refresh",value:function(){var e=Object(i.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pe.extract(this.props.stat);case 2:t=e.sent,console.info("data=",t),this.setState({dataFromService:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=this.state.dataFromService;if(e){var t=qe(e,this.props.structure),n=t.keys,a=t.values,r=["Code du champ\tNom du champ\tValeur\tOccurences"];n.forEach(function(t,n){var i=a[n];e[t].occ.forEach(function(e){var n=Object(De.a)(e,2),a=n[0],c=n[1];r.push("".concat(t,"\t").concat(i,"\t").concat(a,"\t").concat(c))})});ue.saveAs(new Blob([r.join("\n")],{type:"text/csv"}),"statistics.xls")}}},{key:"render",value:function(){var e=this,t=this.state.dataFromService,n=null;if(t){var a=qe(t,this.props.structure),r=a.keys,i=a.values,o=this.state.selectedField;-1===r.indexOf(o)&&(o=r[0]);var s=t[o];n=s?c.createElement("div",null,c.createElement(ke.a,{keys:r,onChange:function(t){console.info("[onChange] selectedField=",t),e.setState({selectedField:t})},value:o},i.map(function(e,t){var n=r[t];return c.createElement("div",{key:n},c.createElement("b",null,"".concat(e," ")),c.createElement("small",{className:"grey"},n))})),c.createElement("br",null),c.createElement("center",null,c.createElement(ze,{colors:Be,values:Ye(s)})),c.createElement("div",null,s.occ.map(function(e,t){var n=Object(De.a)(e,2),a=n[0],r=n[1],i=Math.min(Be.length-1,t),o=Be[i];return c.createElement(Ce.a,{key:t,justifyContent:"space-between",alignItems:"center",dir:"row",classes:t%2?"thm-bg1":"thm-bg2"},c.createElement(Ce.a,{justifyContent:"space-between",wide:!1,dir:"row",alignItems:"center"},c.createElement("div",{className:"bullet",style:{background:o}}),c.createElement("span",null,a)),c.createElement("div",null,c.createElement("b",null,r)))})),c.createElement(V.a,{wide:!0,icon:"export",label:Je("export"),onClick:function(){return e.export()}})):c.createElement("div",null,Je("no-data"))}else n=c.createElement(Ce.a,null,c.createElement(Le.a,{content:"wait",animate:!0}),c.createElement("div",null,"Chargement en cours..."));var u=this.props.stat;return c.createElement("div",{className:"presentational-stat thm-ele-card thm-bg1"},c.createElement("div",{className:"thm-bgPD"},"".concat(u.carecenter.name,", du ").concat(Ve(u.dateMin)," au ").concat(Ve(u.dateMax))),c.createElement("div",null,n),c.createElement("hr",null),c.createElement(Ce.a,{dir:"row",justifyContent:"flex-end"},c.createElement(V.a,{onClick:this.handleClose,icon:"close",label:Je("close"),flat:!0})))}}]),t}(c.Component);function qe(e,t){var n=Object.keys(e),a=n.map(function(e){return y.getFieldCaption(e,t)}),r=n.map(function(e,t){return[e,a[t]]});return r.sort(function(e,t){var n=e[1],a=t[1];return n<a?-1:n>a?1:0}),{keys:r.map(function(e){return e[0]}),values:r.map(function(e){return e[1]})}}function Ve(e){var t=new Date(e);return"".concat(t.getDate(),"-").concat(1+t.getMonth(),"-").concat(t.getFullYear())}function Ye(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.sum,a=e.occ,r=[],i=0,c=0;c<Math.min(t,a.length);c++){var o=Object(De.a)(a[c],2)[1];r.push(o),i+=o}return n>i&&r.push(n-i),r}var $e=n(20),Ge=(n(80),function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(B.a)(t).call(this,e))).refMenu=o.a.createRef(),n.handleShowChange=n.handleShowChange.bind(Object(q.a)(Object(q.a)(n))),n}return Object(W.a)(t,e),Object(U.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.refMenu.current;t&&Object($e.a)(t).on({swipeleft:function(){var t=e.props.onShowChange;"function"===typeof t&&t(!1)}})}},{key:"handleShowChange",value:function(){var e=this.props.onShowChange;"function"===typeof e&&e(!Object(C.a)(this.props.show,window.innerWidth>480))}},{key:"render",value:function(){var e=Object(C.a)(this.props.show,window.innerWidth>480),t=Object(O.a)(this.props.head,""),n=["tfw-layout-sidemenu thm-bg0"].concat(Object(Ae.a)(this.props.classes));return e&&n.push("show"),o.a.createElement("div",{className:n.join(" ")},o.a.createElement("div",{className:"body thm-bg0"},this.props.body),o.a.createElement("div",{className:"menu thm-ele-nav thm-bg1",ref:this.refMenu},o.a.createElement("header",{className:"thm-ele-nav thm-bgPD"},t),o.a.createElement("menu",null," ",this.props.menu," ")),o.a.createElement("div",{className:"icon thm-bgPD"},o.a.createElement(V.a,{icon:"menu",flat:!0,onClick:this.handleShowChange})))}}]),t}(o.a.Component));n(81);var Xe=Object(l.b)(function(e){var t=e.stats.map(function(t){var n=t.carecenter,a=n.id,r=e.structures.find(function(e){return e.id===a});if(!r)return console.error("There is no Structure with id=".concat(a,' in carecenter "').concat(n.name,'"!')),null;var i=w.statsConfig(t);return c.createElement(We,{key:i,stat:t,onClose:function(){return T.dispatch(T.removeStat(i))},structure:r})});return{head:e.user.nickname,menu:c.createElement("div",null,c.createElement("ul",null,e.organizations.map(function(t){return c.createElement("li",{key:t.id},t.name,c.createElement("ul",null,e.carecenters.filter(function(e){return e.organizationId===t.id}).map(function(t){return c.createElement(Ie,{key:t.id,carecenter:t,structures:e.structures})})))})),c.createElement("br",null),c.createElement("hr",null),c.createElement("br",null),c.createElement(V.a,{label:he("logout"),icon:"logout",wide:!0,onClick:function(){return window.location.reload()}})),body:t.length>0?t:c.createElement(Ce.a,{dir:"column",alignItems:"center",classes:["container-sidemenu","welcome"]},c.createElement("div",null,he("welcome")),c.createElement(Le.a,{content:"stat"}),c.createElement("div",null,he("report")),c.createElement(Le.a,{content:"report"}))}},function(e){return{onLanguageClick:function(){e(m.setLanguage("jp"))},onLogoutClick:function(){window.location.reload()}}})(Ge),Ze=(n(82),function(e){function t(){return Object(_.a)(this,t),Object(J.a)(this,Object(B.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return c.createElement(Xe,{classes:"App"})}}]),t}(c.Component));t.default={start:function(){var e=Object(i.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById("root"),u.a.render(o.a.createElement(l.a,{store:T.store},o.a.createElement(Ze,{user:t})),n),T.dispatch(T.User.setLanguage(g.a.lang)),T.dispatch(T.User.setNickname(t.nickname)),e.next=6,M.list();case 6:a=e.sent,T.dispatch(T.Organizations.setOrganizations(a)),T.dispatch(T.Carecenters.setCarecenters([])),a.forEach(function(){var e=Object(i.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.list(t.id);case 2:return e.sent.forEach(function(e){T.dispatch(T.Structures.addStructure(e))}),e.next=6,I.list(t.id);case 6:e.sent.forEach(function(e){T.dispatch(T.Carecenters.addCarecenter(e))});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}}}]);
//# sourceMappingURL=3.22444a83.chunk.js.map