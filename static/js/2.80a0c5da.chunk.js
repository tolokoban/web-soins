(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{65:function(e,t){e.exports={fr:{"err-1":"Une ligne non vide et non comment\xe9e doit toujours commencer par au moins une ast\xe9risque pour indiquer le niveau hi\xe9rarchique.","err-2":"<html>Vous avez saut\xe9 au moins un niveau hi\xe9rarchique:<br/><code>$1</code> !<br/><br/>Vous \xe9tiez au niveau <b>$2</b> et vous d\xe9finissez maintenant le niveau <b>$3</b>.","err-3":"<html>Vous avez d\xe9j\xe0 d\xe9clar\xe9 cet identifiant : <b>$1</b> !"}}},66:function(e,t,n){},67:function(e,t){e.exports={en:{cancel:"Cancel",code:"Code:",consultations:"Consultations","consultations-count":"Consultations:","create-stat":"Create Statistics","create-stat-consultation":"Consult. Statistics","create-stat-patient":"Patients Statistics","date-min":"Start Date","date-max":"End Date",logout:"Logout",patients:"Patients","patients-count":"Patients:",struct:"Structure:"},fr:{cancel:"Annuler",code:"Code :",consultations:"Consultations","consultations-count":"Consultations :","create-stat":"Cr\xe9er des statistiques","create-stat-consultation":"Stats consultations","create-stat-patient":"Stats patients","date-min":"Date de d\xe9but","date-max":"Date de fin",logout:"D\xe9connexion",patients:"Patients","patients-count":"Patients :",struct:"Structure :"}}},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t){e.exports={en:{invalid:"Invalid date!","month-0":"Jan","month-1":"Feb","month-2":"Mar","month-3":"Apr","month-4":"May","month-5":"Jun","month-6":"Jul","month-7":"Aug","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"Dec"},fr:{invalid:"Date invalide !","month-0":"Jan","month-1":"F\xe9v","month-2":"Mar","month-3":"Avr","month-4":"Mai","month-5":"Jun","month-6":"Jul","month-7":"Aou","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"D\xe9c"}}},72:function(e,t,n){},73:function(e,t,n){},74:function(e,t){e.exports={en:{export:"Export to Spreadsheet"},fr:{export:"Exporter vers un tableur"}}},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(9),r=n.n(a),c=n(13),i=n(0),o=n.n(i),s=n(19),u=n.n(s),l=n(51),h=n(54),d=n(53),p=n(21),f=new Set(["nickname","language"]),m={INITIAL_STATE:{email:"",nickname:"",language:"",roles:[]},reducer:function(e,t){if(!t.type.startsWith("user:"))return e;var n=t.type.substr("user:".length);if(!f.has(n))throw Error('Unknown attribute "'.concat(n,'"!'));var a=t.data;return Object.assign(e,Object(p.a)({},n,a))},setLanguage:function(e){return{type:"user:language",data:e}},setNickname:function(e){return{type:"user:nickname",data:e}}},v={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("organization:"))return e;switch(t.type.substr("organization:".length)){case"set":return t.organizations.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.organization);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?t:e})}(e,t.organization);default:throw Error('Unknown action "'.concat(n,'"!'))}},setOrganizations:function(e){return{type:"organization:set",organizations:e}},addOrganization:function(e){return{type:"organization:add",organization:e}},updateOrganization:function(e){return{type:"organization:update",organization:e}}};var b={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("carecenter:"))return e;switch(t.type.substr("carecenter:".length)){case"set":return t.carecenters.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.carecenter);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?Object.assign(e,t):e})}(e,t.carecenter);default:throw Error('Unknown action "'.concat(n,'"!'))}},setCarecenters:function(e){return{type:"carecenter:set",carecenters:e}},addCarecenter:function(e){return{type:"carecenter:add",carecenter:e}},updateCarecenter:function(e){return{type:"carecenter:update",carecenter:e}}};var g=n(11),y={createPatientsFieldsFromStructure:function(e){var t={};return e.patientFields.forEach(function(e){t[e.id]=!0}),t},createPatientsFieldsCaptionsFromStructure:function(e){var t={};return e.patientFields.forEach(function(e){t[e.id]=g.a.toText(e.caption)}),t},getFieldCaption:function(e,t){if("#"!==e.charAt(0))return e;var n=t.formFields[e];return n?g.a.toText(n.caption):e}},j={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("structure:"))return e;switch(t.type.substr("structure:".length)){case"set":return t.structures.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.structure);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?Object.assign(e,t):e})}(e,t.structure);default:throw Error('Unknown action "'.concat(n,'"!'))}},setStructures:function(e){return{type:"structure:set",structures:e}},addStructure:function(e){return{type:"structure:add",structure:e}},updateStructure:function(e){return{type:"structure:update",structure:e}}};var O=n(5),C=n(4),E={INITIAL_STATE:{statsType:"patients",dateMin:function(){var e=new Date;return new Date(e.getFullYear(),e.getMonth()-1,e.getDate()).getTime()}(),dateMax:Date.now(),patientsFields:{birthday:!0,size:!1,nationality:!0},patientsFieldsCaptions:{birthday:"Date de naissance",size:"Taille",nationality:"Nationalit\xe9"},carecenter:{}},reducer:function(e,t){var n=t.type;if(!n.startsWith("stats-config:"))return e;switch(t.type.substr("stats-config:".length)){case"setType":return function(e,t){return Object(h.a)({},e,{statsType:t.statsType||"patients"})}(e,t);case"setDateMin":return function(e,t){return Object(h.a)({},e,{dateMin:t.date})}(e,t);case"setDateMax":return function(e,t){return Object(h.a)({},e,{dateMax:t.date})}(e,t);case"setPatientsFields":return function(e,t){return Object(h.a)({},e,{patientsFields:t.fields||{}})}(e,t);case"setPatientField":return function(e,t){if("string"!==typeof t.fieldName)throw Error('action must have an attribute "fieldName" of type "string" but we found "'.concat(typeof t.fieldName,'"'));var n=Object(O.a)(t.fieldName,""),a=Object(C.a)(t.fieldVisibility,!1);return Object(h.a)({},e,{patientsFields:Object(h.a)({},e.patientsFields,Object(p.a)({},n,a))})}(e,t);default:throw Error('Unknown action "'.concat(n,'"!'))}},setType:function(e){return{type:"stats-config:setType",statsType:e}},setDateMin:function(e){return{type:"stats-config:setDateMin",date:e}},setDateMax:function(e){return{type:"stats-config:setDateMax",date:e}},setPatientsFields:function(e){return{type:"stats-config:setPatientsFields",fields:e}},setPatientField:function(e,t){return{type:"stats-config:setPatientField",fieldName:e,fieldVisibility:t}}};var w={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("stats:"))return e;switch(t.type.substr("stats:".length)){case"addStat":return function(e,t){var n=e.stats.slice();return n.push(t.stat),n}(e,t);default:throw Error('Unknown action "'.concat(n,'"!'))}},addStat:function(e){return{type:"stats:addStat",stat:e}}};var k={user:m.INITIAL_STATE,organizations:v.INITIAL_STATE,carecenters:b.INITIAL_STATE,structures:j.INITIAL_STATE,statsConfig:E.INITIAL_STATE,stats:w.INITIAL_STATE};var x=Object(d.b)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(console.log("state =",e),t.type){case"initStatsConfig":return function(e,t){var n=t.carecenterId,a=e.carecenters.find(function(e){return e.id===n});if(!a)throw Error("There is no Carecenter with id=".concat(n,"!"));var r=a.structureId;if("number"!==typeof r)throw Error('Missing attribute number "structureId"!');var c=e.structures.find(function(e){return e.id===r});if(!c)throw Error("There is no structure with id ".concat(r,"!"));return Object(h.a)({},e,{statsConfig:Object(h.a)({},e.statsConfig,{carecenter:a,patientsFields:y.createPatientsFieldsFromStructure(c),patientsFieldsCaptions:y.createPatientsFieldsCaptionsFromStructure(c)})})}(e,t);case"addStat":return function(e,t){var n=S(e.statsConfig);console.info("hash=",S,e.stats.map(function(e){return JSON.stringify(e)}));var a=e.stats.filter(function(e){return S(e)!==n});return a.push(Object(h.a)({},e.statsConfig)),Object(h.a)({},e,{stats:a})}(e);default:return{user:m.reducer(e.user,t),stats:w.reducer(e.stats,t),organizations:v.reducer(e.organizations,t),carecenters:b.reducer(e.carecenters,t),structures:j.reducer(e.structures,t),statsConfig:E.reducer(e.statsConfig,t)}}});function S(e){return"".concat(e.statsType,"/").concat(e.dateMin,"-").concat(e.dateMax)}var M={store:x,dispatch:function(e){x.dispatch(e)},User:m,Organizations:v,Carecenters:b,Structures:j,StatsConfig:E,initStatsConfig:function(e){return{type:"initStatsConfig",carecenterId:e}},addStat:function(){return{type:"addStat"}}},D=n(18),T={list:function(){var e=Object(c.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.a.exec("orga.list");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},N={list:function(){var e=Object(c.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.a.exec("carecenter.list",t);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return{id:e.id,name:e.name,code:e.code,patientsCount:e.patientsCount,consultationsCount:e.consultationsCount,structureId:e.structure,organizationId:t}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},I=g.a.make(n(65)),F=/^(#[A-Z0-9-]+)?([^\(@]*)(\([^\)]*\)\+?)?(@[A-Z0-9,-]+)?/;var A={parse:function(e){var t={},n=[t];return"string"!==typeof e&&(e="".concat(e)),e.split("\n").forEach(function(e,t){try{if(0===(e=e.trim()).length)return;if("//"===e.substr(0,2))return;if("*"!==e.charAt(0))throw I("err-1");var a=function(e){for(var t=0;"*"==e.charAt(0);)e=e.substr(1),t++;return t}(e);if(e=e.substr(a).trim(),a>n.length)throw I("err-2",e,n.length-1,a);for(;n.length>a;)n.pop();var r=function(e){var t={children:{}},n=F.exec(e.trim());return n[2]&&(t.caption=n[2].trim()),n[1]?t.id=n[1].trim():t.id=t.caption.toUpperCase(),n[3]&&(t.type=n[3].substr(1,n[3].length-2).trim()),n[4]&&(t.tags=n[4].trim().substr(1).split(",").map(function(e){return e.trim()})),t}(e);if("undefined"!==typeof n[n.length-1][r.id])throw I("err-3",r.id);n[n.length-1][r.id]=r,n.push(r.children||{})}catch(c){throw{lineNumber:t+1,message:c}}}),t},flattenFormsFields:function(e){var t=[];return function e(t,n,a){Object.keys(t).forEach(function(r){var c=t[r];"string"===typeof c.id&&"#"===c.id.charAt(0)?n.push({id:c.id,caption:c.caption,path:a.slice()}):c.children&&(a.push(c.caption),e(c.children,n,a),a.pop())})}(e,t,[]),t.sort(function(e,t){var n=e.caption,a=t.caption;return n<a?-1:n>a?1:0}),t}},z={list:function(){var e=Object(c.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.a.exec("structure.list",t);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return{id:e.id,organizationId:t,name:e.name,patientFields:L(e.patient),formFields:U(e),exams:P(e.exams),vaccins:P(e.vaccins),forms:P(e.forms),types:P(e.types),sources:{exams:e.exams,vaccins:e.vaccins,patient:e.patient,forms:e.forms,types:e.types}}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function P(e){try{return A.parse(e)}catch(t){console.error("[parsePatient] ",t),console.log(e)}return null}function L(e){try{var t=A.parse(e);return Object.keys(t).map(function(e){var n=t[e];return{id:e,type:n.type,caption:g.a.toIntl(n.caption)}})}catch(n){console.error("[parsePatient] ",n)}return[]}function U(e){for(var t={},n=[P(e.forms)];n.length>0;)for(var a=n.shift(),r=Object.keys(a),c=0;c<r.length;c++){var i=r[c],o=a[i];t[i]={caption:g.a.toIntl(o.caption)},o.type&&(t[i].type=o.type),o.children&&n.push(o.children)}return t}var _=n(2),R=n(1),J=n(8),W=n(6),V=n(7),Y=n(3),q=n(15),$=(n(66),g.a.make(n(67))),B=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).handleStatClick=n.handleStatClick.bind(Object(Y.a)(Object(Y.a)(n))),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"handleStatClick",value:function(){var e=this.props.onStatClick;"function"===typeof e&&e(this.props.carecenter)}},{key:"handleStructClick",value:function(){var e=this.props.onStructClick;"function"===typeof e&&e(this.props.carecenter)}},{key:"render",value:function(){var e=this.props.carecenter,t=this.props.structures.find(function(t){return t.id===e.structureId});return i.createElement("div",{className:"presentational-carecenter-header"},i.createElement("div",null,i.createElement("div",{className:"name"},e.name),i.createElement("div",{className:"prop"},i.createElement("div",null,$("code")),i.createElement("div",null,e.id,"-",e.code)),i.createElement("div",{className:"prop"},i.createElement("div",null,$("patients-count")),i.createElement("div",null,e.patientsCount)),i.createElement("div",{className:"prop"},i.createElement("div",null,$("consultations-count")),i.createElement("div",null,e.consultationsCount)),i.createElement("div",{className:"prop"},i.createElement("div",null,$("struct")),i.createElement("div",null,t?t.name:"..."))),i.createElement("div",{className:"buttons"},i.createElement(q.a,{icon:"stat",small:!0,onClick:this.handleStatClick}),i.createElement("br",null),i.createElement(q.a,{icon:"sitemap",small:!0,enabled:!!t,onClick:this.handleStructClick})))}}]),t}(i.Component),Z=n(14),G=n(55),H=n(22),K=n(24),Q=(n(68),function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).handleChange=n.handleChange.bind(Object(Y.a)(Object(Y.a)(n))),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"handleChange",value:function(e){var t=this.props.onChange;"function"===typeof t&&(console.info("value=",e),t(e))}},{key:"render",value:function(){var e=Object(H.a)(this.props.children),t=Object(Z.a)(this.props.value,0),n=Object(K.a)(this.props.headers),a=e[t],r=this.handleChange,c=["tfw-layout-tabstrip"];return c.push.apply(c,Object(G.a)(Object(K.a)(this.props.classes))),o.a.createElement("div",{className:c.join(" ")},o.a.createElement("header",null,n.map(function(e,n){return o.a.createElement("button",{key:n,onClick:function(){return r(n)},className:t===n?"selected thm-bg2":""},e)}),o.a.createElement("div",{className:"void"})),o.a.createElement("div",{className:"thm-bg2"},a))}}]),t}(o.a.Component)),X=n(20),ee=(n(69),function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).touchable=void 0,n.ref=void 0,n.handleChange=n.handleChange.bind(Object(Y.a)(Object(Y.a)(n))),n.touchable=new X.a({onTap:n.handleChange}),n.ref=i.createRef(),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this.ref.current;e&&(this.touchable.element=e)}},{key:"handleChange",value:function(){var e=this.props.onChange;"function"===typeof e&&e(!Object(C.a)(this.props.value,!1))}},{key:"render",value:function(){var e=Object(O.a)(this.props.label,""),t=Object(C.a)(this.props.value,!1),n=Object(C.a)(this.props.wide,!1),a=Object(C.a)(this.props.reverse,!1),r=["tfw-view-checkbox"];return t&&r.push("ok"),n&&r.push("wide"),a&&r.push("reverse"),i.createElement("button",{ref:this.ref,className:r.join(" ")},i.createElement("div",{className:"pin"},i.createElement("div",{className:"thm-ele-button bar ".concat(t?"thm-bgSL":"thm-bg1")}," "),i.createElement("div",{className:"thm-ele-button btn ".concat(t?"thm-bgS":"thm-bg0")}," ")),i.createElement("label",null,e))}}]),t}(i.Component)),te=(n(23),n(70),n(26)),ne=g.a.make(n(71)),ae=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).inputDay=void 0,n.inputMonth=void 0,n.inputYear=void 0,n.state={},n.handleChange=Object(te.a)(n.handleChange.bind(Object(Y.a)(Object(Y.a)(n))),300),n.inputDay=i.createRef(),n.inputMonth=i.createRef(),n.inputYear=i.createRef(),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"handleChange",value:function(){try{var e=parseInt(this.inputDay.current.value);if(isNaN(e))throw"day is not a number!";var t=parseInt(this.inputMonth.current.value);if(isNaN(t))throw"month is not a number!";var n=parseInt(this.inputYear.current.value);if(isNaN(n))throw"year is not a number!";var a=new Date(n,t,e);if(a.getFullYear()!==n||a.getMonth()!==t||a.getDate()!==e)throw"Invalid date!";this.setState({error:""});var r=this.props.onChange;if("function"!==typeof r)return;r(a.getTime())}catch(c){this.setState({error:ne("invalid")})}}},{key:"render",value:function(){var e=this.props,t=Object(O.a)(e.label,""),n=Object(Z.a)(e.value,0),a=Object(C.a)(e.wide,!1),r=Object(O.a)(this.state.error,""),c=new Date(n),o="tfw-view-input-".concat(re++),s=["tfw-view-input-date","thm-ele-button"];a&&s.push("wide");var u=r.length>0?i.createElement("div",{className:"thm-bgSD error"},r):t?i.createElement("label",{htmlFor:o,className:"thm-bgPD"},t):null;return i.createElement("div",{className:s.join(" ")},u,i.createElement("div",{className:"inputs"},i.createElement("input",{ref:this.inputDay,className:"day",type:"number",maxLength:"2",min:"1",max:"31",id:o,size:"2",onChange:this.handleChange,defaultValue:c.getDate()}),i.createElement("select",{ref:this.inputMonth,onChange:this.handleChange,defaultValue:c.getMonth()},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(e){return i.createElement("option",{key:e,value:e},ne("month-".concat(e)))})),i.createElement("input",{ref:this.inputYear,className:"year",type:"number",maxLength:"4",size:"4",onChange:this.handleChange,defaultValue:c.getFullYear()})))}}]),t}(i.Component),re=0;var ce=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).handleFieldChange=n.handleFieldChange.bind(Object(Y.a)(Object(Y.a)(n))),n.handleDateMinChange=n.handleDateMinChange.bind(Object(Y.a)(Object(Y.a)(n))),n.handleDateMaxChange=n.handleDateMaxChange.bind(Object(Y.a)(Object(Y.a)(n))),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"handleFieldChange",value:function(e,t){var n=this.props.onFieldChange;if("function"===typeof n)try{n(e,t)}catch(a){console.error("Error in handleFieldChange(fieldName, isSelected): ",e,t),console.error(a)}}},{key:"handleDateMinChange",value:function(e){var t=this.props.onDateMinChange;if("function"===typeof t)try{t(e)}catch(n){console.error("Error in handleDateMinChange(date): ",e),console.error(n)}}},{key:"handleDateMaxChange",value:function(e){var t=this.props.onDateMaxChange;if("function"===typeof t)try{t(e)}catch(n){console.error("Error in handleDateMaxChange(date): ",e),console.error(n)}}},{key:"render",value:function(){var e=this.props,t=e.fields,n=e.fieldsCaptions,a=this.handleFieldChange,r=Object(Z.a)(e.dateMin,Date.now()),c=Object(Z.a)(e.dateMax,Date.now());return o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement(ae,{label:$("date-min"),onChange:this.handleDateMinChange,value:r})),o.a.createElement("div",null,o.a.createElement(ae,{label:$("date-max"),onChange:this.handleDateMaxChange,value:c})),o.a.createElement("div",null,Object.keys(t).map(function(e){var r=n[e];if("string"!==typeof r)return null;var c=t[e];return o.a.createElement(ee,{wide:!0,key:e,value:c,label:r,onChange:function(t){return a(e,t)}})})))}}]),t}(o.a.Component);var ie=Object(l.b)(function(e){return{fields:e.statsConfig.patientsFields,fieldsCaptions:e.statsConfig.patientsFieldsCaptions}},function(e){return{onFieldChange:function(t,n){e(E.setPatientField(t,n))}}})(ce),oe=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).handleTypeChange=n.handleTypeChange.bind(Object(Y.a)(Object(Y.a)(n))),n.handleDateMinChange=n.handleDateMinChange.bind(Object(Y.a)(Object(Y.a)(n))),n.handleDateMaxChange=n.handleDateMaxChange.bind(Object(Y.a)(Object(Y.a)(n))),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"handleTypeChange",value:function(e){var t=this.props.onTypeChange;"function"===typeof t&&t(0===e?"patients":"consultations")}},{key:"handleDateMinChange",value:function(e){var t=this.props.onDateMinChange;"function"===typeof t&&t(e)}},{key:"handleDateMaxChange",value:function(e){var t=this.props.onDateMaxChange;"function"===typeof t&&t(e)}},{key:"render",value:function(){var e=this.props,t="patients"===Object(O.a)(e.statsType,"patients")?0:1,n=Object(Z.a)(e.dateMin,Date.now()),a=Object(Z.a)(e.dateMax,Date.now());return o.a.createElement(Q,{value:t,headers:[$("patients"),$("consultations")],onChange:this.handleTypeChange},o.a.createElement(ie,{dateMin:n,dateMax:a}),o.a.createElement("div",null,"Not implemented yet!"))}}]),t}(o.a.Component);var se=Object(l.b)(function(e){return{statsType:e.statsConfig.statsType,dateMin:e.statsConfig.dateMin,dateMax:e.statsConfig.dateMax}},function(e){return{onTypeChange:function(t){e(E.setType(t))},onDateMinChange:function(t){e(E.setDateMin(t))},onDateMaxChange:function(t){e(E.setDateMax(t))}}})(oe),ue=n(27),le={show:function(){var e=ue.a.show({closeOnEscape:!0,icon:"stat",title:$("create-stat"),content:i.createElement(l.a,{store:M.store},i.createElement(se,null)),footer:[i.createElement(q.a,{key:"cancel",label:$("cancel"),flat:!0,onClick:function(){return e.hide()}}),i.createElement(q.a,{key:"ok",label:$("create-stat"),warning:!0,onClick:function(){e.hide(),M.dispatch(M.addStat())}})]})}};var he=Object(l.b)(function(e){return{}},function(e){return{onStatClick:function(t){console.log("carecenter=",t),e(M.initStatsConfig(t.id)),le.show()},onStructClick:function(e){console.log("carecenter=",e)}}})(B),de=n(29),pe=(n(72),["#b37036","#cc7529","#e67717","#ff7700","#765"]),fe=function(e){function t(){var e,n;Object(_.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(J.a)(this,(e=Object(W.a)(t)).call.apply(e,[this].concat(r)))).canvas=i.createRef(),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){this.paint()}},{key:"componentDidUpdate",value:function(){this.paint()}},{key:"paint",value:function(){if(this.canvas.current){var e=this.canvas.current,t=this.props.values,n=Object(H.a)(this.props.colors,pe).slice(),a=e.width,r=Math.floor(a/2)-3,c=2*Math.PI,i=c/a,o=this.props.values.reduce(function(e,t){return t+e}),s=e.getContext("2d");if(s){var u=0,l=0,h=function(e){return s.lineTo(r*Math.sin(e),-r*Math.cos(e))};if(s.save(),s.clearRect(0,0,a,a),o>0){s.translate(a/2,a/2),s.fillStyle="#000",s.globalAlpha=.5,s.ellipse(0,0,a/2,a/2,0,0,2*Math.PI),s.fill(),s.strokeStyle="#000",s.lineWidth=1;for(var d=0;d<n.length;d++){var p=n[d%n.length];s.fillStyle=p,s.beginPath(),s.moveTo(0,0),l=u+c*t[d]/o;do{h(u),u+=i}while(u<l);h(l),u=l,s.closePath(),s.globalAlpha=1,s.fill(),s.globalAlpha=.2,s.stroke()}}s.restore()}}}},{key:"render",value:function(){var e=this.props,t=(Object(H.a)(e.colors,pe),Object(Z.a)(e.size,200));return i.createElement("canvas",{ref:this.canvas,width:t,height:t,className:"presentation-pie"})}}]),t}(i.Component),me=(n(73),function(e){function t(){return Object(_.a)(this,t),Object(J.a)(this,Object(W.a)(t).apply(this,arguments))}return Object(V.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){var e=this.props,t=Object(C.a)(e.wide,!0),n=Object(O.a)(e.dir,"row"),a={justifyContent:Object(O.a)(e.justifyContent,"space-around"),alignItems:Object(O.a)(e.alignItems,"center"),flexWrap:Object(O.a)(e.wrap,"wrap")},r=["tfw-view-flex","dir-".concat(n)];return r.push.apply(r,Object(G.a)(Object(K.a)(e.classes))),t&&r.push("wide"),i.createElement("div",{className:r.join(" "),style:a},e.children)}}]),t}(i.Component)),ve=n(10),be=n(28),ge=function(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");a.style="display: none",a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(n)},1e3)},ye={extract:function(){var e=Object(c.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.a.exec("extract",{carecenter:t.carecenter.id,begin:je(t.dateMin),end:je(t.dateMax)});case 2:return n=e.sent,a={},Object.values(n.data).forEach(function(e){Object.keys(e).filter(function(e){return"#"===e.charAt(0)}).forEach(function(t){var n=e[t];"undefined"===typeof a[t]&&(a[t]={});var r=a[t];"undefined"===typeof r[n]?r[n]=1:r[n]++})}),e.abrupt("return",Oe(a));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function je(e){return Math.floor(.5+.001*e)}function Oe(e){var t={};return Object.keys(e).forEach(function(n){var a={sum:0,occ:[]};t[n]=a;var r=e[n];Object.keys(r).forEach(function(e){var t=r[e];a.sum+=t,a.occ.push([e,t])}),a.occ.sort(Ce)}),t}function Ce(e,t){var n=e[1];return t[1]-n}n(75);var Ee=g.a.make(n(74)),we=["#b37036","#cc7529","#e67717","#ff7700","#765"],ke=function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).state={selectedField:""},n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"componentDidUpdate",value:function(){this.state.dataFromService||(console.log("componentDidUpdate"),this.refresh())}},{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.refresh()}},{key:"refresh",value:function(){var e=Object(c.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye.extract(this.props.stat);case 2:t=e.sent,console.info("data=",t),this.setState({dataFromService:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=this.state.dataFromService;if(e){var t=xe(e,this.props.structure),n=t.keys,a=t.values,r=["Code du champ\tNom du champ\tValeur\tOccurences"];n.forEach(function(t,n){var c=a[n];e[t].occ.forEach(function(e){var n=Object(de.a)(e,2),a=n[0],i=n[1];r.push("".concat(t,"\t").concat(c,"\t").concat(a,"\t").concat(i))})});ge(new Blob([r.join("\n")],{type:"text/csv"}),"statistics.xls")}}},{key:"render",value:function(){var e=this,t=this.state.dataFromService,n=null;if(t){var a=xe(t,this.props.structure),r=a.keys,c=a.values,o=this.state.selectedField;-1===r.indexOf(o)&&(o=r[0]);var s=t[o];n=i.createElement("div",null,i.createElement(be.a,{keys:r,onChange:function(t){console.info("[onChange] selectedField=",t),e.setState({selectedField:t})},value:o},c.map(function(e,t){var n=r[t];return i.createElement("div",{key:n},i.createElement("b",null,"".concat(e," ")),i.createElement("small",{className:"grey"},n))})),i.createElement("br",null),i.createElement("center",null,i.createElement(fe,{colors:we,values:Me(s)})),i.createElement("div",null,s.occ.map(function(e,t){var n=Object(de.a)(e,2),a=n[0],r=n[1],c=Math.min(we.length-1,t),o=we[c];return i.createElement(me,{key:t,justifyContent:"space-between",alignItems:"center",dir:"row",classes:t%2?"thm-bg1":"thm-bg2"},i.createElement(me,{justifyContent:"space-between",wide:!1,dir:"row",alignItems:"center"},i.createElement("div",{className:"bullet",style:{background:o}}),i.createElement("span",null,a)),i.createElement("div",null,i.createElement("b",null,r)))})),i.createElement(q.a,{wide:!0,icon:"export",label:Ee("export"),onClick:function(){return e.export()}}))}else n=i.createElement(me,null,i.createElement(ve.a,{content:"wait",animate:!0}),i.createElement("div",null,"Chargement en cours..."));var u=this.props.stat;return i.createElement("div",{className:"presentational-stat thm-ele-card thm-bg1"},i.createElement("div",{className:"thm-bgPD"},"".concat(u.carecenter.name,", du ").concat(Se(u.dateMin)," au ").concat(Se(u.dateMax))),i.createElement("div",null,n))}}]),t}(i.Component);function xe(e,t){var n=Object.keys(e),a=n.map(function(e){return y.getFieldCaption(e,t)}),r=n.map(function(e,t){return[e,a[t]]});return r.sort(function(e,t){var n=e[1],a=t[1];return n<a?-1:n>a?1:0}),{keys:r.map(function(e){return e[0]}),values:r.map(function(e){return e[1]})}}function Se(e){var t=new Date(e);return"".concat(t.getDate(),"-").concat(1+t.getMonth(),"-").concat(t.getFullYear())}function Me(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.sum,a=e.occ,r=[],c=0,i=0;i<Math.min(t,a.length);i++){var o=Object(de.a)(a[i],2)[1];r.push(o),c+=o}return n>c&&r.push(n-c),r}var De=n(16),Te=(n(76),function(e){function t(e){var n;return Object(_.a)(this,t),(n=Object(J.a)(this,Object(W.a)(t).call(this,e))).refMenu=o.a.createRef(),n.handleShowChange=n.handleShowChange.bind(Object(Y.a)(Object(Y.a)(n))),n}return Object(V.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.refMenu.current;t&&Object(De.a)(t).on({swipeleft:function(){var t=e.props.onShowChange;"function"===typeof t&&t(!1)}})}},{key:"handleShowChange",value:function(){var e=this.props.onShowChange;"function"===typeof e&&e(!Object(C.a)(this.props.show,window.innerWidth>480))}},{key:"render",value:function(){var e=Object(C.a)(this.props.show,window.innerWidth>480),t=Object(O.a)(this.props.head,""),n=["tfw-layout-sidemenu thm-bg0"].concat(Object(H.a)(this.props.classes));return e&&n.push("show"),o.a.createElement("div",{className:n.join(" ")},o.a.createElement("div",{className:"body thm-bg0"},this.props.body),o.a.createElement("div",{className:"menu thm-ele-nav thm-bg1",ref:this.refMenu},o.a.createElement("header",{className:"thm-ele-nav thm-bgPD"},t),o.a.createElement("menu",null," ",this.props.menu," ")),o.a.createElement("div",{className:"icon thm-bgPD"},o.a.createElement(q.a,{icon:"menu",flat:!0,onClick:this.handleShowChange})))}}]),t}(o.a.Component));var Ne=Object(l.b)(function(e){var t=e.stats.map(function(t){var n=t.carecenter,a=n.id,r=e.structures.find(function(e){return e.id===a});return r?i.createElement(ke,{key:JSON.stringify(t),stat:t,structure:r}):(console.error("There is no Structure with id=".concat(a,' in carecenter "').concat(n.name,'"!')),null)});return{head:e.user.nickname,menu:i.createElement("div",null,i.createElement("ul",null,e.organizations.map(function(t){return i.createElement("li",{key:t.id},t.name,i.createElement("ul",null,e.carecenters.filter(function(e){return e.organizationId===t.id}).map(function(t){return i.createElement(he,{key:t.id,carecenter:t,structures:e.structures})})))})),i.createElement("br",null),i.createElement("hr",null),i.createElement("br",null),i.createElement(q.a,{label:$("logout"),icon:"logout",wide:!0,onClick:function(){return window.location.reload()}})),body:t.length>0?t:i.createElement("div",null,"Toutes vos statistiques s'afficheront ici...")}},function(e){return{onLanguageClick:function(){e(m.setLanguage("jp"))},onLogoutClick:function(){window.location.reload()}}})(Te),Ie=(n(77),function(e){function t(){return Object(_.a)(this,t),Object(J.a)(this,Object(W.a)(t).apply(this,arguments))}return Object(V.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){return i.createElement(Ne,{classes:"App"})}}]),t}(i.Component));t.default={start:function(){var e=Object(c.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById("root"),u.a.render(o.a.createElement(l.a,{store:M.store},o.a.createElement(Ie,{user:t})),n),M.dispatch(M.User.setLanguage(g.a.lang)),M.dispatch(M.User.setNickname(t.nickname)),e.next=6,T.list();case 6:a=e.sent,M.dispatch(M.Organizations.setOrganizations(a)),M.dispatch(M.Carecenters.setCarecenters([])),a.forEach(function(){var e=Object(c.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.list(t.id);case 2:return e.sent.forEach(function(e){M.dispatch(M.Structures.addStructure(e))}),e.next=6,N.list(t.id);case 6:e.sent.forEach(function(e){M.dispatch(M.Carecenters.addCarecenter(e))});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}}}]);
//# sourceMappingURL=2.80a0c5da.chunk.js.map