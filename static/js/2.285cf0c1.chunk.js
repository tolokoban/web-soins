(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{73:function(e,t){e.exports={fr:{"err-1":"Une ligne non vide et non comment\xe9e doit toujours commencer par au moins une ast\xe9risque pour indiquer le niveau hi\xe9rarchique.","err-2":"<html>Vous avez saut\xe9 au moins un niveau hi\xe9rarchique:<br/><code>$1</code> !<br/><br/>Vous \xe9tiez au niveau <b>$2</b> et vous d\xe9finissez maintenant le niveau <b>$3</b>.","err-3":"<html>Vous avez d\xe9j\xe0 d\xe9clar\xe9 cet identifiant : <b>$1</b> !"}}},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t){e.exports={en:{invalid:"Invalid date!","month-0":"Jan","month-1":"Feb","month-2":"Mar","month-3":"Apr","month-4":"May","month-5":"Jun","month-6":"Jul","month-7":"Aug","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"Dec"},fr:{invalid:"Date invalide !","month-0":"Jan","month-1":"F\xe9v","month-2":"Mar","month-3":"Avr","month-4":"Mai","month-5":"Jun","month-6":"Jul","month-7":"Aou","month-8":"Sep","month-9":"Oct","month-10":"Nov","month-11":"D\xe9c"}}},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t){e.exports={en:{cancel:"Cancel",close:"Close",code:"Code:",consultations:"Consultations","consultations-count":"Consultations:","create-stat":"Create Statistics","create-stat-consultation":"Consult. Statistics","create-stat-patient":"Patients Statistics","date-min":"Start Date","date-max":"End Date","execute-query":"Execute Query",filter:"Filter","generating-report":"Generating report...","hint-report-templates":"Report templates are spreadsheet saved as <b>Flat XML Spreadsheet</b> with placeholders like the following ones:",loading:"Loading in progress...","loading-report":"Loading report template...",logout:"Logout",patients:"Patients","patients-count":"Patients:","query-in-progress":"Query in progress...",report:"To add an annual report, clic on the left pane's button bearing the following icon:","stat-type":"Statistic Type",struct:"Structure:",welcome:"To add new statistics, clic on the left pane's button bearing the following icon:"},fr:{cancel:"Annuler",close:"Fermer",code:"Code :",consultations:"Consultations","consultations-count":"Consultations :","create-stat":"Cr\xe9er des statistiques","create-stat-consultation":"Stats consultations","create-stat-patient":"Stats patients","date-min":"Date de d\xe9but","date-max":"Date de fin","execute-query":"Executer la requ\xeate",filter:"Filtre","generating-report":"Rapport en cours de r\xe9alisation...","hint-report-templates":"Les mod\xe8les de rapports sont des fichier <b>Open Office Calc Flat XML Spreadsheet</b> avec des requ\xeates int\xe9gr\xe9es comme celles-ci:",loading:"Chargement en cours...","loading-report":"Chargement du mod\xe8le de rapport...",logout:"D\xe9connexion",patients:"Patients","patients-count":"Patients :","query-in-progress":"Requ\xeate en cours...",report:"Pour \xe9diter un rapport annuel, cliquez sur le bouton avec l'ic\xf4ne suivante dans le panneau de gauche :","stat-type":"Type de statistique",struct:"Structure :",welcome:"Pour ajouter des statistiques, cliquez sur le bouton avec l'ic\xf4ne suivante dans le panneau de gauche : "}}},83:function(e,t,n){},84:function(e,t,n){e.exports=n.p+"static/media/report.261bdad3.fods"},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},89:function(e,t){e.exports={en:{close:"Close",export:"Export to Spreadsheet","no-data":"There is no data for this period!"},fr:{close:"Fermer",export:"Exporter vers un tableur","no-data":"Il n'y a aucune donn\xe9e sur cette p\xe9riode !"}}},90:function(e,t,n){},91:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n.n(a),i=n(9),c=n(0),o=n.n(c),s=n(25),u=n.n(s),l=n(60),d=n(10),f=n(62),h=n(18),p=new Set(["nickname","language"]),m={INITIAL_STATE:{email:"",nickname:"",language:"",roles:[]},reducer:function(e,t){if(!t.type.startsWith("user:"))return e;var n=t.type.substr("user:".length);if(!p.has(n))throw Error('Unknown attribute "'.concat(n,'"!'));var a=t.data;return Object.assign(e,Object(h.a)({},n,a))},setLanguage:function(e){return{type:"user:language",data:e}},setNickname:function(e){return{type:"user:nickname",data:e}}},v={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("organization:"))return e;switch(t.type.substr("organization:".length)){case"set":return t.organizations.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.organization);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?t:e})}(e,t.organization);default:throw Error('Unknown action "'.concat(n,'"!'))}},setOrganizations:function(e){return{type:"organization:set",organizations:e}},addOrganization:function(e){return{type:"organization:add",organization:e}},updateOrganization:function(e){return{type:"organization:update",organization:e}}};var b={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("carecenter:"))return e;switch(t.type.substr("carecenter:".length)){case"set":return t.carecenters.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.carecenter);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?Object.assign(e,t):e})}(e,t.carecenter);default:throw Error('Unknown action "'.concat(n,'"!'))}},setCarecenters:function(e){return{type:"carecenter:set",carecenters:e}},addCarecenter:function(e){return{type:"carecenter:add",carecenter:e}},updateCarecenter:function(e){return{type:"carecenter:update",carecenter:e}}};var g=n(13),y={createPatientsFieldsFromStructure:function(e){var t={};return e.patientFields.forEach(function(e){t[e.id]=!0}),t},createPatientsFieldsCaptionsFromStructure:function(e){var t={};return e.patientFields.forEach(function(e){t[e.id]=g.a.toText(e.caption)}),t},getFieldCaption:function(e,t){if("#"!==e.charAt(0))return e;var n=t.formFields[e];return n?g.a.toText(n.caption):e}},E={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("structure:"))return e;switch(t.type.substr("structure:".length)){case"set":return t.structures.slice();case"add":return function(e,t){var n=e.slice();return n.push(t),n}(e,t.structure);case"update":return function(e,t){return e.map(function(e){return e.id===t.id?Object.assign(e,t):e})}(e,t.structure);default:throw Error('Unknown action "'.concat(n,'"!'))}},setStructures:function(e){return{type:"structure:set",structures:e}},addStructure:function(e){return{type:"structure:add",structure:e}},updateStructure:function(e){return{type:"structure:update",structure:e}}};var O=n(5),C=n(3),k={INITIAL_STATE:{statsType:"consultations",dateMin:function(){var e=new Date;if(1!==e.getDate()){var t=new Date(e.getFullYear(),e.getMonth(),1);return t.getTime()}var n=new Date(e.getFullYear(),e.getMonth()-1,e.getDate());return n.getTime()}(),dateMax:Date.now(),patientsFields:{birthday:!0,size:!1,nationality:!0},patientsFieldsCaptions:{birthday:"Date de naissance",size:"Taille",nationality:"Nationalit\xe9"},carecenter:{id:0,organizationId:0,structureId:0,patientsCount:0,consultationsCount:0,name:"",code:""}},reducer:function(e,t){var n=t.type;if(!n.startsWith("stats-config:"))return e;switch(t.type.substr("stats-config:".length)){case"setType":return function(e,t){return Object(d.a)({},e,{statsType:t.statsType||"consultations"})}(e,t);case"setDateMin":return function(e,t){return Object(d.a)({},e,{dateMin:t.date})}(e,t);case"setDateMax":return function(e,t){return Object(d.a)({},e,{dateMax:t.date})}(e,t);case"setPatientsFields":return function(e,t){return Object(d.a)({},e,{patientsFields:t.fields||{}})}(e,t);case"setPatientField":return function(e,t){if("string"!==typeof t.fieldName)throw Error('action must have an attribute "fieldName" of type "string" but we found "'.concat(typeof t.fieldName,'"'));var n=Object(O.a)(t.fieldName,""),a=Object(C.a)(t.fieldVisibility,!1);return Object(d.a)({},e,{patientsFields:Object(d.a)({},e.patientsFields,Object(h.a)({},n,a))})}(e,t);default:throw Error('Unknown action "'.concat(n,'"!'))}},setType:function(e){return{type:"stats-config:setType",statsType:e}},setDateMin:function(e){return{type:"stats-config:setDateMin",date:e}},setDateMax:function(e){return{type:"stats-config:setDateMax",date:e}},setPatientsFields:function(e){return{type:"stats-config:setPatientsFields",fields:e}},setPatientField:function(e,t){return{type:"stats-config:setPatientField",fieldName:e,fieldVisibility:t}}};var w={INITIAL_STATE:[],reducer:function(e,t){var n=t.type;if(!n.startsWith("stats:"))return e;switch(t.type.substr("stats:".length)){case"addStat":return function(e,t){var n=e.stats.slice();return n.push(t.stat),n}(e,t);default:throw Error('Unknown action "'.concat(n,'"!'))}},addStat:function(e){return{type:"stats:addStat",stat:e}}};var x={statsConfig:function(e){return"".concat(e.statsType,"/").concat(e.dateMin,"-").concat(e.dateMax)}};var j={user:m.INITIAL_STATE,organizations:v.INITIAL_STATE,carecenters:b.INITIAL_STATE,structures:E.INITIAL_STATE,statsConfig:k.INITIAL_STATE,stats:w.INITIAL_STATE};var S=Object(f.b)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(console.log("state =",e),t.type){case"initStatsConfig":return function(e,t){var n=t.carecenterId,a=e.carecenters.find(function(e){return e.id===n});if(!a)throw Error("There is no Carecenter with id=".concat(n,"!"));var r=a.structureId;if("number"!==typeof r)throw Error('Missing attribute number "structureId"!');var i=e.structures.find(function(e){return e.id===r});if(!i)throw Error("There is no structure with id ".concat(r,"!"));return Object(d.a)({},e,{statsConfig:Object(d.a)({},e.statsConfig,{carecenter:a,patientsFields:y.createPatientsFieldsFromStructure(i),patientsFieldsCaptions:y.createPatientsFieldsCaptionsFromStructure(i)})})}(e,t);case"addStat":return function(e,t){var n=x.statsConfig(e.statsConfig),a=e.stats.filter(function(e){return x.statsConfig(e)!==n});return a.push(Object(d.a)({},e.statsConfig)),Object(d.a)({},e,{stats:a})}(e);case"removeStat":return function(e,t){var n=e.stats.filter(function(e){return x.statsConfig(e)!==t.key});return Object(d.a)({},e,{stats:n})}(e,t);default:return{user:m.reducer(e.user,t),stats:w.reducer(e.stats,t),organizations:v.reducer(e.organizations,t),carecenters:b.reducer(e.carecenters,t),structures:E.reducer(e.structures,t),statsConfig:k.reducer(e.statsConfig,t)}}});var T={store:S,dispatch:function(e){S.dispatch(e)},User:m,Organizations:v,Carecenters:b,Structures:E,StatsConfig:k,initStatsConfig:function(e){return{type:"initStatsConfig",carecenterId:e}},addStat:function(){return{type:"addStat"}},removeStat:function(e){return{type:"removeStat",key:e}}},N=n(16),M={list:function(){var e=Object(i.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("orga.list");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},I={list:function(){var e=Object(i.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("carecenter.list",t);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return{id:e.id,name:e.name,code:e.code,patientsCount:e.patientsCount,consultationsCount:e.consultationsCount,structureId:e.structure,organizationId:t}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},F=g.a.make(n(73)),D=/^(#[A-Z0-9-]+)?([^\(@]*)(\([^\)]*\)\+?)?(@[A-Z0-9,-]+)?/;var A={parse:function(e){var t={},n=[t];return"string"!==typeof e&&(e="".concat(e)),e.split("\n").forEach(function(e,t){try{if(0===(e=e.trim()).length)return;if("//"===e.substr(0,2))return;if("*"!==e.charAt(0))throw F("err-1");var a=function(e){for(var t=0;"*"==e.charAt(0);)e=e.substr(1),t++;return t}(e);if(e=e.substr(a).trim(),a>n.length)throw F("err-2",e,n.length-1,a);for(;n.length>a;)n.pop();var r=function(e){var t={children:{}},n=D.exec(e.trim());return n[2]&&(t.caption=n[2].trim()),n[1]?t.id=n[1].trim():t.id=t.caption.toUpperCase(),n[3]&&(t.type=n[3].substr(1,n[3].length-2).trim()),n[4]&&(t.tags=n[4].trim().substr(1).split(",").map(function(e){return e.trim()})),t}(e);if("undefined"!==typeof n[n.length-1][r.id])throw F("err-3",r.id);n[n.length-1][r.id]=r,n.push(r.children||{})}catch(i){throw{lineNumber:t+1,message:i}}}),t},flattenFormsFields:function(e){var t=[];return function e(t,n,a){Object.keys(t).forEach(function(r){var i=t[r];"string"===typeof i.id&&"#"===i.id.charAt(0)?n.push({id:i.id,caption:i.caption,path:a.slice()}):i.children&&(a.push(i.caption),e(i.children,n,a),a.pop())})}(e,t,[]),t.sort(function(e,t){var n=e.caption,a=t.caption;return n<a?-1:n>a?1:0}),t}},L={list:function(){var e=Object(i.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("structure.list",t);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return{id:e.id,organizationId:t,name:e.name,patientFields:z(e.patient),formFields:R(e),exams:P(e.exams),vaccins:P(e.vaccins),forms:P(e.forms),types:P(e.types),sources:{exams:e.exams,vaccins:e.vaccins,patient:e.patient,forms:e.forms,types:e.types}}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function P(e){try{return A.parse(e)}catch(t){console.error("[parsePatient] ",t),console.log(e)}return null}function z(e){try{var t=A.parse(e);return Object.keys(t).map(function(e){var n=t[e];return{id:e,type:n.type,caption:g.a.toIntl(n.caption)}})}catch(n){console.error("[parsePatient] ",n)}return[]}function R(e){for(var t={},n=[P(e.forms)];n.length>0;)for(var a=n.shift(),r=Object.keys(a),i=0;i<r.length;i++){var c=r[i],o=a[c];t[c]={caption:g.a.toIntl(o.caption)},o.type&&(t[c].type=o.type),o.children&&n.push(o.children)}return t}var q=n(2),_=n(1),U=n(7),V=n(6),Y=n(8),J=n(11),B=n(15),W=1,G=2,Q=3,$=4,H=5,X=6,Z=7,K=8,ee=["???","OBJ_OPEN","OBJ_CLOSE","ARR_OPEN","ARR_CLOSE","STRING","NUMBER","SPECIAL","COLON"],te={OBJ_OPEN:W,OBJ_CLOSE:G,ARR_OPEN:Q,ARR_CLOSE:$,STRING:H,NUMBER:X,SPECIAL:Z,COLON:K,tokenize:function(e){return(new ce).tokenize(e)},getTypeName:function(e){return ee[e]}},ne=/^-?(\.[0-9]+|[0-9]+(\.[0-9]+)?)([eE]-?[0-9]+)?$/,ae=/^-?0x[0-9a-f]+$/i,re=/^-?0o[0-7]+$/i,ie=/^-?0b[01]+$/i,ce=function(){function e(){var t=this;Object(q.a)(this,e),this.eaters=void 0,this.source="",this.index=0,this.end=0,this.tokens=[],this.eatBlanks=function(){for(;-1!==" \t\n\r".indexOf(t.peek()||"?");)t.index++},this.eatSymbol=function(){var e=null;switch(t.peek()){case"{":e=W;break;case"}":e=G;break;case"[":e=Q;break;case"]":e=$;break;case":":e=K;break;case",":return void t.index++}e&&(t.addToken(e),t.index++)},this.eatComment=function(){if("/"===t.peek()){t.index++;var e=t.next();if("/"==e){var n=t.source.indexOf("\n",t.index);t.index=-1===n?t.end:n+1}else if("*"==e){var a=t.source.indexOf("*/",t.index);t.index=-1===a?t.end:a+1}else t.fail("'/' looks like a comment, but it is not!")}},this.eatString=function(){var e=t.index,n=t.peek();if('"'===n||"'"===n){t.index++;for(var a=!1,r="";!t.eos();){var i=t.next();if(a)a=!1,"n"===i?i="\n":"r"===i?i="\r":"t"===i&&(i="\t"),r+=i;else if("\\"===i)a=!0;else{if(i===n)return void t.addToken(H,e,r);r+=i}}t.index=e,t.fail("Missing en of string")}},this.eatIdentifier=function(){var e=t.index,n=t.peek()||"?";if(-1===" \t\n\r,:[]{}/".indexOf(n)){t.index++;for(var a=n;!t.eos()&&(n=t.peek()||"?",-1===" \t\n\r,:[]{}/".indexOf(n));)a+=n,t.index++;if(ne.test(a))t.addToken(X,e,parseFloat(a));else if(ae.test(a))t.addToken(X,e,parseInt(a,16));else if(re.test(a))a="-"==a.charAt(0)?"-"+a.substr(3):a.substr(2),t.addToken(X,e,parseInt(a,8));else if(ie.test(a))a="-"==a.charAt(0)?"-"+a.substr(3):a.substr(2),t.addToken(X,e,parseInt(a,2));else{var r=Z;"null"===a?a=null:"undefined"===a?a=void 0:"true"===a?a=!0:"false"===a?a=!1:r=H,t.addToken(r,e,a)}}},this.eaters=[this.eatBlanks,this.eatSymbol,this.eatComment,this.eatString,this.eatIdentifier]}return Object(_.a)(e,[{key:"tokenize",value:function(e){for(this.source=e,this.end=e.length,this.index=0,this.tokens=[];this.index<this.end;){for(var t=this.index,n=0;n<this.eaters.length;n++){if((0,this.eaters[n])(),this.index!==t)break}this.index===t&&this.fail("Unexpected token at pos ".concat(this.index,":\n").concat(e.substr(this.index,80)))}return this.tokens}},{key:"fail",value:function(e){throw"undefined"===typeof e&&(e="Invalid char at "+this.index+"!"),{index:this.index,source:this.source,message:e}}},{key:"eos",value:function(){return this.index>=this.end}},{key:"peek",value:function(){return this.eos()?null:this.source[this.index]}},{key:"next",value:function(){return this.eos()?null:this.source[this.index++]}},{key:"back",value:function(){this.index>0&&this.index--}},{key:"addToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";-1===t&&(t=this.index),this.tokens.push({type:e,index:t,value:n})}}]),e}(),oe={parse:se,isValid:function(e){try{return se(e),!0}catch(t){return!1}}};function se(e){try{var t=te.tokenize(e);return new ue(t).parse()}catch(n){throw n.type,n}}var ue=function(){function e(t){Object(q.a)(this,e),this.tokens=t,this.index=0}return Object(_.a)(e,[{key:"peek",value:function(){return this.tokens[this.index]}},{key:"next",value:function(){return this.tokens[this.index++]}},{key:"back",value:function(){this.index=Math.max(0,this.index-1)}},{key:"parse",value:function(){var e=this.next();switch(e.type){case te.OBJ_OPEN:return this.parseObject();case te.ARR_OPEN:return this.parseArray();case te.STRING:case te.NUMBER:case te.SPECIAL:return e.value}throw this.back(),this.fail(e)}},{key:"parseArray",value:function(){for(var e,t=this.index,n=[];void 0!==(e=this.peek());){if(e.type===te.ARR_CLOSE)return this.next(),n;n.push(this.parse())}throw this.fail("Opening braket at position ".concat(t," has no corresponding closing one!"),t)}},{key:"parseObject",value:function(){for(var e,t=this.index,n={},a=0;void 0!==(e=this.peek());){if(e.type===te.OBJ_CLOSE)return this.next(),n;var r=this.parse();if((e=this.peek()).type===te.OBJ_CLOSE)return n[a++]=r,this.next(),n;if(e.type===te.COLON){this.next();var i=this.parse();n[r]=i}else n[a++]=r}throw this.fail("Opening brace at position "+t+" has no corresponding closing one!",t)}},{key:"fail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return t<0&&(t=this.index),"string"===typeof e?{message:e,index:t}:{index:e.index,message:"Unexpected token "+te.getTypeName(e.type)+" at position "+e.index+"!"}}}]),e}(),le={saveAs:function(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");a.style.display="none",a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(n)},5e3)}},de=n(14),fe=n(12),he={padNumber:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",a="".concat(e);a.length<t;)a=n.charAt(0)+a;return a},clamp:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e<t?t:e>n?n:e},loadTextFromFile:function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(e){var n="".concat(e.target.result);t(n)},a.onerror=function(e){n(e)},a.readAsText(e)})},loadTextFromURL:function(e){return new Promise(function(t,n){fetch(e).then(function(e){return e.ok||n("Error ".concat(e.status,": ").concat(e.statusText,"!")),e.text()}).then(t).catch(n)})},loadJsonFromURL:function(e){return new Promise(function(t,n){fetch(e).then(function(e){return e.json()}).then(t).catch(n)})}},pe=n(35),me=n(74),ve=n.n(me),be=(n(75),function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).refInput=o.a.createRef(),n.handleClick=n.handleClick.bind(Object(J.a)(Object(J.a)(n))),n.handleFileChange=n.handleFileChange.bind(Object(J.a)(Object(J.a)(n))),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"handleFileChange",value:function(e){if(e.target){var t=this.props.onClick;if("function"===typeof t)try{var n=e.target.files;if(!n)return;t(n)}catch(a){console.error("Error in handleFileChange(): "),console.error(a)}}}},{key:"handleClick",value:function(){var e=this.refInput.current;e&&e.click()}},{key:"render",value:function(){var e=this.props,t=["tfw-view-InputFile"];return!0===e.wide&&t.push("wide"),o.a.createElement("div",{className:t.join(" ")},o.a.createElement(B.a,{label:e.label,icon:e.icon,wide:e.wide,wait:e.wait,flat:e.flat,small:e.small,warning:e.warning,enabled:e.enabled,classes:e.classes,onClick:this.handleClick}),o.a.createElement("input",{ref:this.refInput,type:"file",accept:e.accept,multiple:!0===e.multiple,onChange:this.handleFileChange}))}}],[{key:"readFileAsText",value:function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(e){var n=e.target.result;t(n)},a.onerror=function(e){n(e)},a.readAsText(e)})}}]),t}(o.a.Component)),ge=n(31),ye=n(30),Ee=n(19),Oe=(n(76),function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).touchable=void 0,n.ref=c.createRef(),n.handleClick=n.handleClick.bind(Object(J.a)(Object(J.a)(n))),n.touchable=new Ee.a({onTap:n.handleClick,color:e.color}),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){var e=this.ref.current;e&&(this.touchable.element=e)}},{key:"handleClick",value:function(){var e=this.props.onClick;"function"===typeof e&&e()}},{key:"render",value:function(){var e=this.props,t=Object(C.a)(e.enabled,!0),n=["tfw-view-touchable"].concat(Object(ye.a)(e.classNames));return t&&n.push("enabled"),c.createElement("div",{ref:this.ref,tabIndex:0,className:n.join(" "),title:e.title},e.children)}}]),t}(c.Component)),Ce=(n(77),function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(U.a)(this,(e=Object(V.a)(t)).call.apply(e,[this].concat(r)))).handleValueChange=function(){n.props.onValueChange(!n.props.value)},n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=["tfw-view-Expand"];return this.props.value&&e.push("expand"),o.a.createElement("div",{className:e.join(" ")},o.a.createElement(Oe,{classNames:["head"],onClick:this.handleValueChange},o.a.createElement("div",{className:"icons"},o.a.createElement(de.a,{content:"plus-o",size:24}),o.a.createElement(de.a,{content:"minus-o",size:24})),o.a.createElement("div",null,this.props.label)),o.a.createElement("div",{className:"body"},this.props.children))}}]),t}(o.a.Component)),ke=n(33),we=(n(36),n(78),n(24)),xe=function(e,t){var n=0;return function(){for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];n&&window.clearTimeout(n),n=window.setTimeout(function(){n=0,e.apply(void 0,r)},t)}},je=g.a.make(n(79)),Se=function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).inputDay=void 0,n.inputMonth=void 0,n.inputYear=void 0,n.state={},n.handleChange=xe(n.handleChange.bind(Object(J.a)(Object(J.a)(n))),300),n.inputDay=c.createRef(),n.inputMonth=c.createRef(),n.inputYear=c.createRef(),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"handleChange",value:function(){try{var e=parseInt(this.inputDay.current.value);if(isNaN(e))throw"day is not a number!";var t=parseInt(this.inputMonth.current.value);if(isNaN(t))throw"month is not a number!";var n=parseInt(this.inputYear.current.value);if(isNaN(n))throw"year is not a number!";var a=new Date(n,t,e);if(a.getFullYear()!==n||a.getMonth()!==t||a.getDate()!==e)throw"Invalid date!";this.setState({error:""});var r=this.props.onChange;if("function"!==typeof r)return;r(a.getTime())}catch(i){this.setState({error:je("invalid")})}}},{key:"render",value:function(){var e=this.props,t=Object(O.a)(e.label,""),n=Object(we.a)(e.value,0),a=Object(C.a)(e.wide,!1),r=Object(O.a)(this.state.error,""),i=new Date(n),o="tfw-view-input-".concat(Te++),s=["tfw-view-input-date","thm-ele-button"];a&&s.push("wide");var u=r.length>0?c.createElement("div",{className:"thm-bgSD error"},r):t?c.createElement("label",{htmlFor:o,className:"thm-bgPD"},t):null;return c.createElement("div",{className:s.join(" ")},u,c.createElement("div",{className:"inputs"},c.createElement("input",{ref:this.inputDay,className:"day",type:"number",maxLength:"2",min:"1",max:"31",id:o,size:"2",onChange:this.handleChange,defaultValue:i.getDate()}),c.createElement("select",{ref:this.inputMonth,onChange:this.handleChange,defaultValue:i.getMonth()},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(e){return c.createElement("option",{key:e,value:e},je("month-".concat(e)))})),c.createElement("input",{ref:this.inputYear,className:"year",type:"number",maxLength:"4",size:"4",onChange:this.handleChange,defaultValue:i.getFullYear()})))}}]),t}(c.Component),Te=0;var Ne=n(20),Me=(n(80),function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).setValue=function(e,t){var a=Object(d.a)({},n.state.values,Object(h.a)({},e,t));Ne.a.local.set("web-soins/form-field/values",a),n.setState({values:a},function(){console.info("key, val, values=",e,t,a)})},n.renderField=function(e){var t=e.id,a=e.caption,r=e.children;return"#"===t.charAt(0)?n.renderTypedField(e,n.props.types):o.a.createElement(Ce,{key:t,label:a,value:n.state.values[t],onValueChange:function(e){return n.setValue(t,e)}},o.a.createElement("div",null,Object.values(r).map(n.renderField)))},n.state={values:Ne.a.local.get("web-soins/form-field/values",{})},n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"FormField"},this.renderField(this.props.field))}},{key:"renderTypedField",value:function(e,t){var n=this,a=e.id,r=e.caption,i=e.tags,c=t[e.type||"?"];if(!c){if(Array.isArray(i)){if(i.indexOf("@BOOL"))return o.a.createElement(ke.a,{key:a,label:"".concat(r," (").concat(a,")"),value:this.state.values[a],onChange:function(e){return n.setValue(a,e)}});if(i.indexOf("@DATE"))return o.a.createElement(Se,{key:a,label:"".concat(r," (").concat(a,")"),value:this.state.values[a],onChange:function(e){return n.setValue(a,e)}})}return o.a.createElement("pre",{key:a,className:"error"},JSON.stringify(e,null,"  ")+"\nTAGS: "+JSON.stringify(i))}return o.a.createElement(ge.a,{key:a,label:"".concat(r," (").concat(a,")"),value:this.state.values[a],onChange:function(e){return n.setValue(a,e)}},Object.values(c.children).map(function(e){return o.a.createElement("div",{key:e.id},e.caption," ",o.a.createElement("em",null,"(",e.id,")"))}))}}]),t}(o.a.Component)),Ie=n(29),Fe=(n(81),g.a.make(n(82))),De=function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).handleQueryChange=function(e){var t=e.target;if(t){var a=t.value,r=oe.isValid(a);n.setState({query:a,valid:r})}},n.handleExecuteClick=function(){var e=n.state,t=e.query,a=e.valid,r=e.dateMin,i=e.dateMax;a&&(Ne.a.local.set("web-soins/container-query/query",t),(0,n.props.onQueryClick)(oe.parse(t),r,i))},n.handleDateMinChange=function(e){n.setState({dateMin:e})},n.handleDateMaxChange=function(e){n.setState({dateMax:e})},n.state={dateMin:Ne.a.local.get("web-soins/container-query/dateMin",Ae()),dateMax:Ne.a.local.get("web-soins/container-query/dateMax",Date.now()),valid:!0,query:Ne.a.local.get("web-soins/container-query/query","[\n    OR\n    [= #VIH #POSITIVE]\n    [= #DIAGNOSIS-VIH #POSITIVE]\n]")},n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this.state,t=e.query,n=e.valid,a=e.dateMin,r=e.dateMax;return o.a.createElement("div",{className:["presentational-ConsultationQuery"].join(" ")},o.a.createElement(Ie.a,null,o.a.createElement("div",null,o.a.createElement(Se,{label:Fe("date-min"),onChange:this.handleDateMinChange,value:a})),o.a.createElement("div",null,o.a.createElement(Se,{label:Fe("date-max"),onChange:this.handleDateMaxChange,value:r}))),o.a.createElement("label",null,Fe("filter")),o.a.createElement("br",null),o.a.createElement("textarea",{className:n?"valid":"invalid",rows:15,onChange:this.handleQueryChange},t),o.a.createElement("br",null),o.a.createElement(B.a,{icon:"play",label:Fe("execute-query"),enabled:n,onClick:this.handleExecuteClick}))}}]),t}(o.a.Component);function Ae(){var e=new Date;return new Date(e.getFullYear()-1,0,1).valueOf()}var Le={getConsultationIds:function(e){return Pe.apply(this,arguments)},getConsultationsFields:function(e){return ze.apply(this,arguments)}};function Pe(){return(Pe=Object(i.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("query.consultation",t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ze(){return(ze=Object(i.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("consultation.list",t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}n(83);var Re=function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).handleFilesChange=function(e){n.props.onFilesChange(e)},n.handleQueryClick=function(){var e=Object(i.a)(r.a.mark(function e(t,a,i){var c,o;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.info("filter=",t),console.info("minDate=",a),console.info("maxDate=",i),e.next=5,fe.a.wait(Fe("query-in-progress"),n.queryConsultations(t,a,i));case 5:c=e.sent,o=new Blob([c],{type:"text/csv;charset=utf-8"}),ve()(o,"consultations.".concat(qe(a/1e3),".").concat(qe(i/1e3),".csv"));case 8:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),n.state={forms:{},types:{}},n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.carecenter,t=T.store.getState().structures.find(function(t){return t.id===e});t&&this.setState({forms:t.forms,types:t.types})}},{key:"queryConsultations",value:function(){var e=Object(i.a)(r.a.mark(function e(t,n,a){var i,c,o,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.getConsultationIds({filter:t,minDate:n,maxDate:a});case 2:return i=e.sent,e.next=5,Le.getConsultationsFields(i);case 5:return c=e.sent,o='"Patient","Consultation Date ",'.concat(c.fields.map(function(e){return'"'.concat(e,'"')}).join(",")),s=Object.keys(c.patients).map(function(e){return c.patients[e].map(function(t){return(n=JSON.stringify([e,qe(t[0])].concat(Object(pe.a)(t.slice(1))))).substr(1,n.length-2);var n}).join("\n")}).join("\n"),e.abrupt("return","".concat(o,"\n").concat(s));case 9:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.forms,n=e.types;return o.a.createElement("div",{className:"report-ReportView"},o.a.createElement("div",null,o.a.createElement(be,{wide:!0,icon:"table",label:"Load report template from disk (*.fods)",accept:"fods",multiple:!0,onClick:this.handleFilesChange}),o.a.createElement("p",{dangerouslySetInnerHTML:{__html:Fe("hint-report-templates")}}),o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("code",null,"{{newPatients [Y,1,1] [Y,4,1]}}"),": "),o.a.createElement("li",null,o.a.createElement("code",null,"{{newPatients [Y,1,1] [Y,4,1] filter:[GENDER #F]}}"),": "),o.a.createElement("li",null,o.a.createElement("code",null,"{{newPatients [Y,1,1] [Y,4,1] filter:[age 18 40]}}"),": "),o.a.createElement("li",null,o.a.createElement("code",null,"{{visits [Y,1,1] [Y,4,1]}}</code>"),": "),o.a.createElement("li",null,o.a.createElement("code",null,"{{visits [Y,1,1] [Y,4,1] filter:{MOTIF-CONSULTATION: #GENITAL-LEAK}}}"),": "),o.a.createElement("li",null,o.a.createElement("code",null,"{{visits [Y,1,1] [Y,4,1] group:day}}"),": ")),o.a.createElement("hr",null),o.a.createElement(De,{onQueryClick:this.handleQueryClick})),o.a.createElement("div",null,Object.values(t).map(function(e){return o.a.createElement(Me,{key:e.id,types:n,field:e})})))}}]),t}(o.a.Component);function qe(e){for(var t=new Date(1e3*e),n=t.getFullYear(),a="".concat(t.getMonth()+1),r="".concat(t.getDate());a.length<2;)a="0".concat(a);for(;r.length<2;)r="0".concat(r);return"".concat(n,"-").concat(a,"-").concat(r)}var _e=n(84),Ue=n.n(_e),Ve=(n(85),{generate:function(e){return Ye.apply(this,arguments)}});function Ye(){return(Ye=Object(i.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:fe.a.alert(o.a.createElement("div",{className:"report-icons-container"},o.a.createElement("div",null,o.a.createElement(de.a,{content:"report",size:96,onClick:function(){return Je(t)}}),o.a.createElement("div",null,"Rapport annuel")),o.a.createElement("div",null,o.a.createElement(de.a,{content:"file",size:96,onClick:function(){return We(t)}}),o.a.createElement("div",null,o.a.createElement("i",null,"G\xe9n\xe9rique...")))));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Je(e){return Be.apply(this,arguments)}function Be(){return(Be=Object(i.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.a.wait(Fe("loading-report"),he.loadTextFromURL(Ue.a));case 2:n=e.sent,fe.a.wait(Fe("generating-report"),Ge(n,t));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function We(e){var t=function(){var t=Object(i.a)(r.a.mark(function t(a){var i,c,o,s,u,l,d;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=!0,c=!1,o=void 0,t.prev=3,s=a[Symbol.iterator]();case 5:if(i=(u=s.next()).done){t.next=14;break}return l=u.value,t.next=9,he.loadTextFromFile(l);case 9:d=t.sent,fe.a.wait(Fe("generating-report"),Ge(d,e));case 11:i=!0,t.next=5;break;case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(3),c=!0,o=t.t0;case 20:t.prev=20,t.prev=21,i||null==s.return||s.return();case 23:if(t.prev=23,!c){t.next=26;break}throw o;case 26:return t.finish(23);case 27:return t.finish(20);case 28:n.hide();case 29:case"end":return t.stop()}},t,null,[[3,16,20,28],[21,,23,27]])}));return function(e){return t.apply(this,arguments)}}(),n=fe.a.show({content:o.a.createElement(Re,{carecenter:e.carecenter,onFilesChange:t}),footer:o.a.createElement(B.a,{label:"Close",icon:"cancel",onClick:function(){return n.hide()}})})}function Ge(e,t){return Qe.apply(this,arguments)}function Qe(){return(Qe=Object(i.a)(r.a.mark(function e(t,n){var a,i,c,o,s,u,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new DOMParser,i=a.parseFromString(t,"application/xml"),c=[],$e(i.documentElement,c),o=c.map(function(e){var t=(e.textContent||"{}").trim().substr(1);try{return Object(d.a)({},oe.parse(t.substr(0,t.length-1)),n)}catch(r){var a;return console.error(r),console.info("elem=",e),a={},Object(h.a)(a,0,"echo"),Object(h.a)(a,1,t),a}}),console.info("query=",o),e.next=8,N.a.exec("report",o);case 8:return s=e.sent,console.info("data=",s),s.forEach(function(e,t){var n=c[t],a=parseFloat(e);if(n.textContent=e,!Number.isNaN(a)){var r=n.parentElement;if(!r)return;r.setAttribute("office:value-type","float"),r.setAttribute("calcext:value-type","float"),r.setAttribute("office:value",e)}}),u=new XMLSerializer,l=u.serializeToString(i),e.next=15,le.saveAs(new Blob([l]),"report.ods");case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $e(e,t){switch(e.nodeType){case Node.ELEMENT_NODE:if("text:p"===e.nodeName){var n=(e.textContent||"").trim();n.startsWith("{{")&&n.endsWith("}}")&&t.push(e)}else{var a=!0,r=!1,i=void 0;try{for(var c,o=e.childNodes[Symbol.iterator]();!(a=(c=o.next()).done);a=!0){$e(c.value,t)}}catch(s){r=!0,i=s}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}}}}n(86);var He=function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).handleStatClick=function(){var e=n.props.onStatClick;"function"===typeof e&&e(n.props.carecenter)},n.handleStructClick=function(){var e=n.props.onStructClick;"function"===typeof e&&e(n.props.carecenter)},n.handleReportClick=function(){var e=n.props.carecenter;Ve.generate({carecenter:e.id})},n.handleStatClick=n.handleStatClick.bind(Object(J.a)(Object(J.a)(n))),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this.props.carecenter,t=this.props.structures.find(function(t){return t.id===e.structureId});return c.createElement("div",{className:"presentational-carecenter-header"},c.createElement("div",null,c.createElement("div",{className:"name"},e.name),c.createElement("div",{className:"prop"},c.createElement("div",null,Fe("code")),c.createElement("div",null,e.id,"-",e.code)),c.createElement("div",{className:"prop"},c.createElement("div",null,Fe("patients-count")),c.createElement("div",null,e.patientsCount)),c.createElement("div",{className:"prop"},c.createElement("div",null,Fe("consultations-count")),c.createElement("div",null,e.consultationsCount)),c.createElement("div",{className:"prop"},c.createElement("div",null,Fe("struct")),c.createElement("div",null,t?t.name:"..."))),c.createElement("div",{className:"buttons"},c.createElement(B.a,{icon:"stat",small:!0,onClick:this.handleStatClick}),c.createElement("br",null),c.createElement(B.a,{icon:"report",small:!0,onClick:this.handleReportClick}),c.createElement("br",null)))}}]),t}(c.Component),Xe=function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).handleTypeChange=n.handleTypeChange.bind(Object(J.a)(Object(J.a)(n))),n.handleDateMinChange=n.handleDateMinChange.bind(Object(J.a)(Object(J.a)(n))),n.handleDateMaxChange=n.handleDateMaxChange.bind(Object(J.a)(Object(J.a)(n))),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"handleTypeChange",value:function(e){var t=this.props.onTypeChange;"function"===typeof t&&t(0===e?"patients":"consultations")}},{key:"handleDateMinChange",value:function(e){var t=this.props.onDateMinChange;if("function"===typeof t)try{t(e)}catch(n){console.error("Error in handleDateMinChange(date): ",e),console.error(n)}}},{key:"handleDateMaxChange",value:function(e){var t=this.props.onDateMaxChange;if("function"===typeof t)try{t(e)}catch(n){console.error("Error in handleDateMaxChange(date): ",e),console.error(n)}}},{key:"render",value:function(){var e=this.props,t=Object(O.a)(e.statsType,"consultations"),n=Object(we.a)(e.dateMin,Date.now()),a=Object(we.a)(e.dateMax,Date.now()),r=["consultations","patients"];return o.a.createElement("div",null,o.a.createElement(ge.a,{wide:!0,label:Fe("stat-type"),keys:r,value:t},r.map(function(e){return o.a.createElement("div",{key:e},Fe(e))})),o.a.createElement(Ie.a,null,o.a.createElement("div",null,o.a.createElement(Se,{label:Fe("date-min"),onChange:this.handleDateMinChange,value:n})),o.a.createElement("div",null,o.a.createElement(Se,{label:Fe("date-max"),onChange:this.handleDateMaxChange,value:a}))))}}]),t}(o.a.Component);var Ze=Object(l.b)(function(e){return{statsType:e.statsConfig.statsType,dateMin:e.statsConfig.dateMin,dateMax:e.statsConfig.dateMax}},function(e){return{onTypeChange:function(t){e(k.setType(t))},onDateMinChange:function(t){console.info("[onDateMinChange] date=",t),e(k.setDateMin(t))},onDateMaxChange:function(t){e(k.setDateMax(t))}}})(Xe),Ke={show:function(){var e=fe.a.show({closeOnEscape:!0,icon:"stat",title:Fe("create-stat"),content:c.createElement(l.a,{store:T.store},c.createElement(Ze,null)),footer:[c.createElement(B.a,{key:"cancel",label:Fe("cancel"),flat:!0,onClick:function(){return e.hide()}}),c.createElement(B.a,{key:"ok",label:Fe("create-stat"),warning:!0,onClick:function(){e.hide(),T.dispatch(T.addStat())}})]})}};var et=Object(l.b)(function(e){return{}},function(e){return{onStatClick:function(t){console.log("carecenter=",t),e(T.initStatsConfig(t.id)),Ke.show()},onStructClick:function(e){console.log("carecenter=",e)}}})(He),tt=(n(87),function(e){function t(){return Object(q.a)(this,t),Object(U.a)(this,Object(V.a)(t).apply(this,arguments))}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"webSoins-Wait"},o.a.createElement(de.a,{content:"wait",animate:!0}),o.a.createElement("div",null,this.props.label||Fe("loading")))}}]),t}(o.a.Component)),nt=n(22),at=(n(88),["#b37036","#cc7529","#e67717","#ff7700","#765"]),rt=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(U.a)(this,(e=Object(V.a)(t)).call.apply(e,[this].concat(r)))).canvas=c.createRef(),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){this.paint()}},{key:"componentDidUpdate",value:function(){this.paint()}},{key:"paint",value:function(){if(this.canvas.current){var e=this.canvas.current,t=this.props.values,n=Object(ye.a)(this.props.colors,at).slice(),a=e.width,r=Math.floor(a/2)-3,i=2*Math.PI,c=i/a,o=this.props.values.reduce(function(e,t){return t+e}),s=e.getContext("2d");if(s){var u=0,l=0,d=function(e){return s.lineTo(r*Math.sin(e),-r*Math.cos(e))};if(s.save(),s.clearRect(0,0,a,a),o>0){s.translate(a/2,a/2),s.fillStyle="#000",s.globalAlpha=.5,s.ellipse(0,0,a/2,a/2,0,0,2*Math.PI),s.fill(),s.strokeStyle="#000",s.lineWidth=1;for(var f=0;f<n.length;f++){var h=n[f%n.length];s.fillStyle=h,s.beginPath(),s.moveTo(0,0),l=u+i*t[f]/o;do{d(u),u+=c}while(u<l);d(l),u=l,s.closePath(),s.globalAlpha=1,s.fill(),s.globalAlpha=.2,s.stroke()}}s.restore()}}}},{key:"render",value:function(){var e=this.props,t=(Object(ye.a)(e.colors,at),Object(we.a)(e.size,200));return c.createElement("canvas",{ref:this.canvas,width:t,height:t,className:"presentation-pie"})}}]),t}(c.Component),it={extract:function(){var e=Object(i.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.exec("extract",{carecenter:t.carecenter.id,begin:ct(t.dateMin),end:ct(t.dateMax)});case 2:return n=e.sent,a={},Object.values(n.data).forEach(function(e){Object.keys(e).filter(function(e){return"#"===e.charAt(0)}).forEach(function(t){var n=e[t];"undefined"===typeof a[t]&&(a[t]={});var r=a[t];"undefined"===typeof r[n]?r[n]=1:r[n]++})}),e.abrupt("return",ot(a));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function ct(e){return Math.floor(.5+.001*e)}function ot(e){var t={};return Object.keys(e).forEach(function(n){var a={sum:0,occ:[]};t[n]=a;var r=e[n];Object.keys(r).forEach(function(e){var t=r[e];a.sum+=t,a.occ.push([e,t])}),a.occ.sort(st)}),t}function st(e,t){var n=e[1];return t[1]-n}n(90);var ut=g.a.make(n(89)),lt=["#b37036","#cc7529","#e67717","#ff7700","#765"],dt=function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).state={selectedField:""},n.handleClose=n.handleClose.bind(Object(J.a)(Object(J.a)(n))),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"handleClose",value:function(){var e=this.props.onClose;if("function"===typeof e)try{e()}catch(t){console.error("Error in handleClose(): "),console.error(t)}}},{key:"componentDidUpdate",value:function(){this.state.dataFromService||(console.log("componentDidUpdate"),this.refresh())}},{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.refresh()}},{key:"refresh",value:function(){var e=Object(i.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,it.extract(this.props.stat);case 2:t=e.sent,console.info("data=",t),this.setState({dataFromService:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=this.state.dataFromService;if(e){var t=ft(e,this.props.structure),n=t.keys,a=t.values,r=["Code du champ\tNom du champ\tValeur\tOccurences"];n.forEach(function(t,n){var i=a[n];e[t].occ.forEach(function(e){var n=Object(nt.a)(e,2),a=n[0],c=n[1];r.push("".concat(t,"\t").concat(i,"\t").concat(a,"\t").concat(c))})});le.saveAs(new Blob([r.join("\n")],{type:"text/csv"}),"statistics.xls")}}},{key:"render",value:function(){var e=this,t=this.state.dataFromService,n=null;if(t){var a=ft(t,this.props.structure),r=a.keys,i=a.values,o=this.state.selectedField;-1===r.indexOf(o)&&(o=r[0]);var s=t[o];n=s?c.createElement("div",null,c.createElement(ge.a,{keys:r,onChange:function(t){console.info("[onChange] selectedField=",t),e.setState({selectedField:t})},value:o},i.map(function(e,t){var n=r[t];return c.createElement("div",{key:n},c.createElement("b",null,"".concat(e," ")),c.createElement("small",{className:"grey"},n))})),c.createElement("br",null),c.createElement("center",null,c.createElement(rt,{colors:lt,values:pt(s)})),c.createElement("div",null,s.occ.map(function(e,t){var n=Object(nt.a)(e,2),a=n[0],r=n[1],i=Math.min(lt.length-1,t),o=lt[i];return c.createElement(Ie.a,{key:t,justifyContent:"space-between",alignItems:"center",dir:"row",classes:t%2?"thm-bg1":"thm-bg2"},c.createElement(Ie.a,{justifyContent:"space-between",wide:!1,dir:"row",alignItems:"center"},c.createElement("div",{className:"bullet",style:{background:o}}),c.createElement("span",null,a)),c.createElement("div",null,c.createElement("b",null,r)))})),c.createElement(B.a,{wide:!0,icon:"export",label:ut("export"),onClick:function(){return e.export()}})):c.createElement("div",null,ut("no-data"))}else n=c.createElement(Ie.a,null,c.createElement(de.a,{content:"wait",animate:!0}),c.createElement("div",null,"Chargement en cours..."));var u=this.props.stat;return c.createElement("div",{className:"presentational-stat thm-ele-card thm-bg1"},c.createElement("div",{className:"thm-bgPD"},"".concat(u.carecenter.name,", du ").concat(ht(u.dateMin)," au ").concat(ht(u.dateMax))),c.createElement("div",null,n),c.createElement("hr",null),c.createElement(Ie.a,{dir:"row",justifyContent:"flex-end"},c.createElement(B.a,{onClick:this.handleClose,icon:"close",label:ut("close"),flat:!0})))}}]),t}(c.Component);function ft(e,t){var n=Object.keys(e),a=n.map(function(e){return y.getFieldCaption(e,t)}),r=n.map(function(e,t){return[e,a[t]]});return r.sort(function(e,t){var n=e[1],a=t[1];return n<a?-1:n>a?1:0}),{keys:r.map(function(e){return e[0]}),values:r.map(function(e){return e[1]})}}function ht(e){var t=new Date(e);return"".concat(t.getDate(),"-").concat(1+t.getMonth(),"-").concat(t.getFullYear())}function pt(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.sum,a=e.occ,r=[],i=0,c=0;c<Math.min(t,a.length);c++){var o=Object(nt.a)(a[c],2)[1];r.push(o),i+=o}return n>i&&r.push(n-i),r}var mt=n(21),vt=(n(91),function(e){function t(e){var n;return Object(q.a)(this,t),(n=Object(U.a)(this,Object(V.a)(t).call(this,e))).refMenu=o.a.createRef(),n.handleShowChange=n.handleShowChange.bind(Object(J.a)(Object(J.a)(n))),n}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.refMenu.current;t&&Object(mt.a)(t).on({swipeleft:function(){var t=e.props.onShowChange;"function"===typeof t&&t(!1)}})}},{key:"handleShowChange",value:function(){var e=this.props.onShowChange;"function"===typeof e&&e(!Object(C.a)(this.props.show,window.innerWidth>480))}},{key:"render",value:function(){var e=Object(C.a)(this.props.show,window.innerWidth>480),t=Object(O.a)(this.props.head,""),n=["tfw-layout-sidemenu thm-bg0"].concat(Object(ye.a)(this.props.classes));return e&&n.push("show"),o.a.createElement("div",{className:n.join(" ")},o.a.createElement("div",{className:"body thm-bg0"},this.props.body),o.a.createElement("div",{className:"menu thm-ele-nav thm-bg1",ref:this.refMenu},o.a.createElement("header",{className:"thm-ele-nav thm-bgPD"},t),o.a.createElement("menu",null," ",this.props.menu," ")),o.a.createElement("div",{className:"icon thm-bgPD"},o.a.createElement(B.a,{icon:"menu",flat:!0,onClick:this.handleShowChange})))}}]),t}(o.a.Component));n(92);var bt=Object(l.b)(function(e){var t=e.stats.map(function(t){var n=t.carecenter,a=n.id,r=e.structures.find(function(e){return e.id===a});if(!r)return console.error("There is no Structure with id=".concat(a,' in carecenter "').concat(n.name,'"!')),null;var i=x.statsConfig(t);return c.createElement(dt,{key:i,stat:t,onClose:function(){return T.dispatch(T.removeStat(i))},structure:r})});return{head:e.user.nickname,menu:c.createElement("div",null,c.createElement("ul",null,e.organizations.map(function(t){return c.createElement("li",{key:t.id},t.name,c.createElement("ul",null,function(e,t){var n=e.carecenters.filter(function(e){return e.organizationId===t.id});return 0===n.length?c.createElement(tt,null):n.map(function(t){return c.createElement(et,{key:t.id,carecenter:t,structures:e.structures})})}(e,t)))})),c.createElement("br",null),c.createElement("hr",null),c.createElement("br",null),c.createElement(B.a,{label:Fe("logout"),icon:"logout",wide:!0,onClick:function(){return window.location.reload()}})),body:t.length>0?t:c.createElement(Ie.a,{dir:"column",alignItems:"center",classes:["container-sidemenu","welcome"]},c.createElement("div",null,Fe("welcome")),c.createElement(de.a,{content:"stat"}),c.createElement("div",null,Fe("report")),c.createElement(de.a,{content:"report"}))}},function(e){return{onLanguageClick:function(){e(m.setLanguage("jp"))},onLogoutClick:function(){window.location.reload()}}})(vt),gt=(n(93),function(e){function t(){return Object(q.a)(this,t),Object(U.a)(this,Object(V.a)(t).apply(this,arguments))}return Object(Y.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){return c.createElement(bt,{classes:"App"})}}]),t}(c.Component));t.default={start:function(){var e=Object(i.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById("root"),u.a.render(o.a.createElement(l.a,{store:T.store},o.a.createElement(gt,{user:t})),n),T.dispatch(T.User.setLanguage(g.a.lang)),T.dispatch(T.User.setNickname(t.nickname)),e.next=6,M.list();case 6:a=e.sent,T.dispatch(T.Organizations.setOrganizations(a)),T.dispatch(T.Carecenters.setCarecenters([])),a.forEach(function(){var e=Object(i.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.list(t.id);case 2:return e.sent.forEach(function(e){T.dispatch(T.Structures.addStructure(e))}),e.next=6,I.list(t.id);case 6:e.sent.forEach(function(e){T.dispatch(T.Carecenters.addCarecenter(e))});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}}}]);
//# sourceMappingURL=2.285cf0c1.chunk.js.map