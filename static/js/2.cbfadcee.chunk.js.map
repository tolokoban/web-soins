{"version":3,"sources":["structure/parser.yaml","view/stat.yaml","intl.yaml","view/main-panel/main-panel.yaml","view/pages/patients/placeholder.jpg","tfw/view/input-date.yaml","report/report.fods","view/counting-reports/counting-reports.yaml","view/pages/reports/reports.yaml","view/pages/stats/stats.yaml","view/pages/struct/struct.yaml","view/pages/welcome/welcome.svg","state/current.ts","state/user.ts","state/organizations.ts","state/page.ts","state/carecenters.ts","structure/structure.ts","state/structures.ts","state/stats-config.ts","state/stats.ts","util/hash.ts","state/index.ts","service/organization.ts","service/carecenter.ts","structure/parser.ts","service/structure.ts","view/pie.tsx","tfw/view/combo.tsx","tfw/fileapi.ts","service/stat.ts","view/stat.tsx","tfw/layout/sidemenu.tsx","intl.ts","view/carecenter-header/carecenter-header.tsx","view/wait/wait.tsx","view/main-panel/main-panel.tsx","view/page-header/page-header.tsx","container/page-header/page-header.tsx","service/patient.ts","view/patient-button/patient-button.tsx","view/consultation-viewer/consultation-viewer.tsx","view/info/info.tsx","view/pages/patients/patients.tsx","container/pages/patients/patients.tsx","view/section/section.tsx","tfw/permissive-json/tokenizer.ts","tfw/permissive-json/index.ts","tfw/util.ts","tfw/view/input-file/index.tsx","tfw/view/touchable.tsx","tfw/view/expand/expand.tsx","tfw/debouncer.ts","tfw/view/input-date.tsx","view/form-field.tsx","view/consultation-query/consultation-query.tsx","service/query.ts","report/report-view.tsx","report/report.tsx","view/counting-reports/counting-reports.tsx","view/pages/reports/reports.tsx","container/pages/reports/reports.tsx","view/pages/stats/stats.tsx","container/pages/stats/stats.tsx","view/pages/struct/struct.tsx","container/pages/struct/struct.tsx","view/pages/welcome/welcome.tsx","view/pages/pages.tsx","container/sidemenu/sidemenu.tsx","App.tsx","main.tsx"],"names":["module","exports","fr","err-1","err-2","err-3","en","close","export","no-data","button-patient","button-reports","button-stats","button-struct","cancel","code","consultations","consultations-count","counting-reports","create-stat","create-stat-consultation","create-stat-patient","date-min","date-max","execute-query","extractions","filter","firstname","gender","gender-female","gender-male","gender-undefined","generating-report","hint-report-templates","identifier","lastname","loading","loading-report","logout","patients","patients-count","query-in-progress","report","secondname","size","stat-type","struct","welcome","ok","invalid","month-0","month-1","month-2","month-3","month-4","month-5","month-6","month-7","month-8","month-9","month-10","month-11","__webpack_require__","p","state_current","INITIAL_STATE","reducer","state","action","type","startsWith","substr","length","current","Object","objectSpread","set","Error","concat","ATTRIBUTES","Set","state_user","email","nickname","language","roles","attName","has","attValue","data","assign","defineProperty","setLanguage","setNickname","state_organizations","organizations","slice","organization","newState","push","add","map","item","id","update","setOrganizations","addOrganization","updateOrganization","page","state_carecenters","carecenters","carecenter","setCarecenters","addCarecenter","updateCarecenter","structure_structure","createPatientsFieldsFromStructure","structure","patientsFields","patientFields","forEach","patientField","createPatientsFieldsCaptionsFromStructure","patientsFieldsCaptions","Intl","toText","caption","getFieldCaption","key","charAt","formFields","getCurrentStructure","State","store","getState","structureId","structures","find","struc","state_structures","setStructures","addStructure","updateStructure","stats_config","statsType","dateMin","today","Date","getDate","firstDayOfCurrentMonth","getFullYear","getMonth","getTime","lastMonth","dateMax","now","birthday","nationality","organizationId","patientsCount","consultationsCount","name","setType","date","setDateMin","setDateMax","fields","setPatientsFields","fieldName","castString","fieldVisibility","castBoolean","setPatientField","state_stats","stats","stat","addStat","hash","statsConfig","obj","Current","Carecenters","Organizations","Page","Stats","StatsConfig","Structures","user","User","createStore","arguments","undefined","carecenterId","c","s","Structure","initStatsConfig","h","Hash","removeStat","src_state","dispatch","service_organization","list","_list","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","next","WebService","exec","abrupt","sent","stop","apply","this","service_carecenter","_x","_","make","require","RX_LINE","structure_parser","parse","types","levels","split","line","lineNumber","trim","level","computeLevel","pop","children","m","toUpperCase","tags","v","parseLine","ex","message","flattenFormsFields","forms","recursiveFlattenFormsFields","path","keys","child","sort","b","captionA","captionB","service_structure","parsePatient","patient","parseFormFields","exams","vaccins","sources","def","Parser","console","error","log","stringifiedPatientDef","raw","toIntl","result","fringe","shift","_arr","_i","value","DEFAULT_COLORS","Pie","canvas","React","paint","values","props","colors","castArray","width","radius","Math","floor","turn","PI","angleStep","total","reduce","acc","val","ctx","getContext","angle","angleTarget","lineTo","ang","sin","cos","save","clearRect","translate","fillStyle","globalAlpha","ellipse","fill","strokeStyle","lineWidth","i","color","beginPath","moveTo","closePath","stroke","restore","castInteger","react","ref","height","className","Combo","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","touchable","button","bigList","selectedKey","selectedIndex","handleClick","bind","assertThisInitialized","Touchable","onTap","expand","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","slot","onChange","err","return","_list$getBoundingClie","getBoundingClientRect","left","top","min","window","innerHeight","ceil","screen","document","createElement","innerHTML","style","appendChild","body","index","items","querySelectorAll","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","rect","scrollTop","classList","remove","event","_ensureSelectionVisible","preventDefault","stopPropagation","EscapeHandler","fire","_this2","_swapItems","_this$_computeDimensi","_computeDimensions","_this$_showList","_showList","setTimeout","handleKeyboard","_handleKeyboard","addEventListener","removeChild","removeEventListener","Gesture","on","tap","evt","y","scroll","requestAnimationFrame","element","label","wide","goodKeys","castStringArray","minimalLength","k","ensureGoodKeys","classes","indexOf","max","getIndex","join","view_label","transform","view_icon","content","fileapi","saveAs","blob","fileName","url","URL","createObjectURL","anchorElem","display","href","download","click","revokeObjectURL","service_stat","extract","_extract","extraction","begin","convertTime","end","consultation","convertIntoOccurences","milliseconds","input","occurences","sum","occ","fieldValues","sortDescBySecondElement","A","Stat","selectedField","handleClose","handler","onClose","dataFromService","refresh","StatService","info","setState","_getFieldsKeysAndValu","getFieldsKeysAndValues","output","fieldKey","idx","fieldCaption","_ref","_ref2","slicedToArray","count","FileAPI","Blob","_getFieldsKeysAndValu2","combo_Combo","pie_Pie","getValuesForPie","_ref3","_ref4","colorIndex","flex","justifyContent","alignItems","dir","background","view_button","icon","onClick","animate","formatDate","flat","array","B","d","sectors","Sidemenu","refMenu","createRef","handleShowChange","menu","swipeleft","onShowChange","show","innerWidth","head","react_default","Component","src_intl","Button","Tfw","View","CarecenterHeader","handleStatClick","setCurrent","handleStructClick","handleReportClick","handlePatientClick","_this$props","buttonStats","small","buttonReports","buttonPatient","buttonStruct","Wait","MainPanel","carecentersOfOrganization","wait_Wait","carecenter_header_CarecenterHeader","toConsumableArray","Converter","StringArray","renderCareCenterHeader","main_panel_Button","location","reload","Icon","PageHeader","connect","String","Integer","SEPARATORS","service_patient","firstName","capitalize","secondName","lastName","country","sex","castSex","p1","p2","ln1","ln2","fn1","fn2","_consultations","_callee2","patientId","currentConsultation","lastId","row","_row","time","_key","_context2","t0","finish","_x2","text","separators","trimedText","toLowerCase","nextSeparators","sep","PatientButton","patient_button_Touchable","_onClick","toString","ConsultationViewer","consultationData","structureData","StructureManager","Info","Expand","Input","List","Patients","PatientService","renderPatient","patient_button_PatientButton","renderConsulation","patients_Expand","toLocaleString","consultation_viewer_ConsultationViewer","_this$state","filteredPatients","trimedFilter","page_header_page_header","I","patients_Input","placeholder","PlaceholderImage","itemHeight","mapper","info_Info","genderValue","Storage","PrefixedLocalStorage","Boolean","Section","expanded","storage","get","default","section_Touchable","section_Icon","rotate","OBJ_OPEN","OBJ_CLOSE","ARR_OPEN","ARR_CLOSE","STRING","NUMBER","SPECIAL","COLON","TYPE_NAMES","tokenizer","tokenize","source","Context","getTypeName","RX_DECIMAL","RX_HEXA","RX_OCTAL","RX_BINARY","eaters","tokens","eatBlanks","peek","eatSymbol","tkn","addToken","eatComment","endOfSingleComment","endOfComment","fail","eatString","start","quote","escape","str","eos","eatIdentifier","test","parseFloat","parseInt","currentSourceIndex","eaterIndex","eater","msg","permissive_json","isValid","Tokenizer","parseObject","parseArray","back","arr","indexForMissingKey","util","padNumber","fillWith","clamp","loadTextFromFile","file","Promise","resolve","reject","reader","FileReader","onload","target","onerror","readAsText","loadTextFromURL","fetch","then","response","status","statusText","catch","loadJsonFromURL","json","InputFile","refInput","handleFileChange","files","wait","warning","enabled","accept","multiple","TouchableBehavior","classNames","tabIndex","title","handleValueChange","onValueChange","touchable_Touchable","debouncer","delay","timer","_len","args","Array","clearTimeout","inputDay","inputMonth","inputYear","handleChange","Debouncer","day","isNaN","month","year","globalId","header","htmlFor","maxLength","defaultValue","monthId","FormField","setValue","local","renderField","field","renderTypedField","expand_Expand","isArray","view_checkbox","input_date_Input","JSON","stringify","t","ContainerQuery","handleQueryChange","query","valid","PermissiveJSON","handleExecuteClick","onQueryClick","handleDateMinChange","handleDateMaxChange","oneYearBack","_this$state2","rows","executeQuery","valueOf","service_query","getConsultationIds","getConsultationsFields","ids","consultationIds","ReportView","handleFilesChange","onFilesChange","handleQueryClick","minDate","maxDate","csvContent","Dialog","queryConsultations","SaveAs","convertToDate","_x3","QueryService","f","patientKey","tail","input_file_InputFile","dangerouslySetInnerHTML","__html","consultation_query_ContainerQuery","form_field_FormField","secondsSinceEpoch","yy","mm","dd","src_report_report","doGenerate","generate","generateFromTemplate","generateFromUserProvidedFile","extraData","alert","_callee3","_context3","loadingReport","Util","LibreOfficeCalcTemplate","generatingReport","dialog","hide","report_view_ReportView","footer","_callee4","domParser","doc","placeholders","serializer","xml","_context4","DOMParser","parseFromString","findPlaceholders","documentElement","elem","textContent","WS","Number","parent","parentElement","setAttribute","XMLSerializer","serializeToString","nodeType","Node","ELEMENT_NODE","nodeName","endsWith","childNodes","Factory","CountingReports","Report","counting_reports_Button","counting_reports_InputFile","section_Section","hintReportTemplates","Reports","countingReports","counting_reports_CountingReports","Struct","Welcome","refDiv","loaded","Logo","svg","div","Stack","Layout","Pages","fullscreen","welcome_Welcome","pages_patients_patients","reports_reports","pages_stats_stats","struct_struct","stat_Stat","main_panel_MainPanel","pages_Pages","onLanguageClick","onLogoutClick","App","container_sidemenu_sidemenu","__webpack_exports__","_start","root","getElementById","ReactDOM","render","es","App_App","lang","ServiceOrganization","ServiceStructure","ServiceCarecenter"],"mappings":"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","file":"static/js/2.cbfadcee.chunk.js","sourcesContent":["module.exports = {\"fr\":{\"err-1\":\"Une ligne non vide et non commentée doit toujours commencer par au moins une astérisque pour indiquer le niveau hiérarchique.\",\"err-2\":\"<html>Vous avez sauté au moins un niveau hiérarchique:<br/><code>$1</code> !<br/><br/>Vous étiez au niveau <b>$2</b> et vous définissez maintenant le niveau <b>$3</b>.\",\"err-3\":\"<html>Vous avez déjà déclaré cet identifiant : <b>$1</b> !\"}}","module.exports = {\"en\":{\"close\":\"Close\",\"export\":\"Export to Spreadsheet\",\"no-data\":\"There is no data for this period!\"},\"fr\":{\"close\":\"Fermer\",\"export\":\"Exporter vers un tableur\",\"no-data\":\"Il n'y a aucune donnée sur cette période !\"}}","module.exports = {\"en\":{\"button-patient\":\"Patients\",\"button-reports\":\"Reports\",\"button-stats\":\"Stat.\",\"button-struct\":\"Struct.\",\"cancel\":\"Cancel\",\"close\":\"Close\",\"code\":\"Code:\",\"consultations\":\"Consultations\",\"consultations-count\":\"Consultations:\",\"counting-reports\":\"Counting Reports\",\"create-stat\":\"Create Statistics\",\"create-stat-consultation\":\"Consult. Statistics\",\"create-stat-patient\":\"Patients Statistics\",\"date-min\":\"Start Date\",\"date-max\":\"End Date\",\"execute-query\":\"Execute Query\",\"extractions\":\"Extractions of Patients and Consultations\",\"filter\":\"Filter\",\"firstname\":\"Firstname\",\"gender\":\"Gender\",\"gender-female\":\"Female\",\"gender-male\":\"Male\",\"gender-undefined\":\"Undefined\",\"generating-report\":\"Generating report...\",\"hint-report-templates\":\"Report templates are spreadsheet saved as <b>Flat XML Spreadsheet</b> with placeholders like the following ones:\",\"identifier\":\"ID\",\"lastname\":\"Lastname\",\"loading\":\"Loading in progress...\",\"loading-report\":\"Loading report template...\",\"logout\":\"Logout\",\"patients\":\"Patients\",\"patients-count\":\"Patients:\",\"query-in-progress\":\"Query in progress...\",\"report\":\"To add an annual report, clic on the left pane's button bearing the following icon:\",\"secondname\":\"Secondname\",\"size\":\"Size\",\"stat-type\":\"Statistic Type\",\"struct\":\"Structure:\",\"welcome\":\"To add new statistics, clic on the left pane's button bearing the following icon:\"},\"fr\":{\"button-patient\":\"Patients\",\"button-reports\":\"Rapports\",\"button-stats\":\"Stat.\",\"button-struct\":\"Struct.\",\"cancel\":\"Annuler\",\"close\":\"Fermer\",\"code\":\"Code :\",\"consultations\":\"Consultations\",\"consultations-count\":\"Consultations :\",\"counting-reports\":\"Rapports de décomptes\",\"create-stat\":\"Créer des statistiques\",\"create-stat-consultation\":\"Stats consultations\",\"create-stat-patient\":\"Stats patients\",\"date-min\":\"Date de début\",\"date-max\":\"Date de fin\",\"execute-query\":\"Executer la requête\",\"extractions\":\"Extractions de patients et de consultations\",\"filter\":\"Filtre\",\"firstname\":\"Prénom\",\"gender\":\"Genre\",\"gender-female\":\"Féminin\",\"gender-male\":\"Masculin\",\"gender-undefined\":\"Non défini\",\"generating-report\":\"Rapport en cours de réalisation...\",\"hint-report-templates\":\"Les modèles de rapports sont des fichier <b>Open Office Calc Flat XML Spreadsheet</b> avec des requêtes intégrées comme celles-ci:\",\"identifier\":\"ID\",\"lastname\":\"Nom\",\"loading\":\"Chargement en cours...\",\"loading-report\":\"Chargement du modèle de rapport...\",\"logout\":\"Déconnexion\",\"patients\":\"Patients\",\"patients-count\":\"Patients :\",\"query-in-progress\":\"Requête en cours...\",\"report\":\"Pour éditer un rapport annuel, cliquez sur le bouton avec l'icône suivante dans le panneau de gauche :\",\"secondname\":\"Second P.\",\"size\":\"Taille\",\"stat-type\":\"Type de statistique\",\"struct\":\"Structure :\",\"welcome\":\"Pour ajouter des statistiques, cliquez sur le bouton avec l'icône suivante dans le panneau de gauche : \"}}","module.exports = {\"en\":{\"ok\":\"Ok\"},\"fr\":{\"ok\":\"Valider\"}}","module.exports = \"data:image/jpeg;base64,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tkkkkkkttktktttttttttttts//EABsRAQEBAAMBAQAAAAAAAAAAAABhMRARUFEg/9oACAEDAQE/EPhRdddddddddddddddddddddddddddddddddddddddddddddddddddddddddfgpv7ebf9d+rm346dexm39vN9KJppppppppppppppppppppppppppppppppppppppppppppppppppppppppp8FP/8QAGREBAQEBAQEAAAAAAAAAAAAAAGExEVBg/9oACAECAQE/EN+9SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSZ957omHuTD7iCZ94ssssssssssssssssssssssssssssssssssssssssssssssssssssssssss3/1//8QAJBABAQACAQQCAwEBAQAAAAAAAQAR8FEhMUGxEGFAceGBkfH/2gAIAQEAAT8QPDPsM9oP+20LaFtC2hbQtoWz/wBNm/tta2tbctvW0LaFt62tbUtvW3Lb1ty29bN/bbVta2tbWtrW1ra1ty2tbWttW2rbVtq21battW2rbVtq21battW2rbVtq21battW2rbVtq21bas+PPuM97/oPcfneUjNA832TzQHzB5RJBAPMjmSeZOe8HmDysYzzY8wcd5B5sOYkdbAsEJ5kWPNhzY8yLHmB8xTJ+R6vuxfofdmIPlnPdjDCb9016s5JmOEZfk3q+bJkEh8IT806khJGPpILOSzsvhOCcnwkcTyfker7v8AMPu6zpIvaUe0PHa6/F+ky7Ss6WLCwbgX030X6yj2mHaaR8S3xZSuJee0rOliWcs3j4c4+l+s/SevtYnt8DAfker7jn/T3IfED4jgseIHFhxYcQHiwWWS2NhxI4sOIB4kNjxY8WHFhxYcQlgmNRY2NhYWMEsMGPyPV9z559jjvf8AhtrG1jaxtY2sbWNvG2jbRto2sbWNrG1jaxtY2sbWNrG1jaxtY20baNtG2jbxt420baNvG2jbRto20baNtG2jbRto20baNtG2jbRto20baNtG2jbRto20baNtG2jbRnz59zjtf//Z\"","module.exports = {\"en\":{\"invalid\":\"Invalid date!\",\"month-0\":\"Jan\",\"month-1\":\"Feb\",\"month-2\":\"Mar\",\"month-3\":\"Apr\",\"month-4\":\"May\",\"month-5\":\"Jun\",\"month-6\":\"Jul\",\"month-7\":\"Aug\",\"month-8\":\"Sep\",\"month-9\":\"Oct\",\"month-10\":\"Nov\",\"month-11\":\"Dec\"},\"fr\":{\"invalid\":\"Date invalide !\",\"month-0\":\"Jan\",\"month-1\":\"Fév\",\"month-2\":\"Mar\",\"month-3\":\"Avr\",\"month-4\":\"Mai\",\"month-5\":\"Jun\",\"month-6\":\"Jul\",\"month-7\":\"Aou\",\"month-8\":\"Sep\",\"month-9\":\"Oct\",\"month-10\":\"Nov\",\"month-11\":\"Déc\"}}","module.exports = __webpack_public_path__ + \"static/media/report.035dce20.fods\";","module.exports = {\"en\":{\"ok\":\"Ok\"},\"fr\":{\"ok\":\"Valider\"}}","module.exports = {\"en\":{\"ok\":\"Ok\"},\"fr\":{\"ok\":\"Valider\"}}","module.exports = {\"en\":{\"ok\":\"Ok\"},\"fr\":{\"ok\":\"Valider\"}}","module.exports = {\"en\":{\"ok\":\"Ok\"},\"fr\":{\"ok\":\"Valider\"}}","module.exports = __webpack_public_path__ + \"static/media/welcome.897fab41.svg\";","import { IAction, IStateCurrent } from \"../types\"\n\nconst PREFIX = \"current:\"\nconst INITIAL_STATE: IStateCurrent = {}\n\nexport default {\n    INITIAL_STATE,\n\n    reducer(state: IStateCurrent, action: IAction): IStateCurrent {\n        const { type } = action\n        if (!type.startsWith(PREFIX)) return state\n\n        const command = action.type.substr(PREFIX.length)\n        switch (command) {\n            case \"set\": return set(state, action.current)\n            default: throw Error(`Unknown action \"${type}\"!`)\n        }\n    },\n\n    set(current: IStateCurrent): IAction {\n        return { type: \"current:set\", current }\n    }\n}\n\nfunction set(state: IStateCurrent, current: IStateCurrent): IStateCurrent {\n    return {\n        ...state,\n        ...current\n    }\n}\n","import { IAction, IUser } from \"../types\"\n\nconst PREFIX = \"user:\";\nconst ATTRIBUTES = new Set(['nickname', 'language']);\n\nexport default {\n    INITIAL_STATE: { email: \"\", nickname: \"\", language: \"\", roles: [] },\n\n    reducer(state: IUser, action: IAction): IUser {\n        const { type } = action;\n        if (!type.startsWith(PREFIX)) return state;\n\n        const attName = action.type.substr(PREFIX.length);\n        if (!ATTRIBUTES.has(attName)) {\n            throw Error(`Unknown attribute \"${attName}\"!`);\n        }\n        const attValue = action.data;\n        return Object.assign(state, { [attName]: attValue });\n    },\n\n    setLanguage(language: string): IAction {\n        return { type: \"user:language\", data: language };\n    },\n\n    setNickname(nickname: string): IAction {\n        return { type: \"user:nickname\", data: nickname };\n    }\n}\n","import { IAction, IOrganization } from \"../types\"\n\nconst PREFIX = \"organization:\";\n\nexport default {\n    INITIAL_STATE: [],\n\n    reducer(state: IOrganization[], action: IAction): IOrganization[] {\n        const { type } = action;\n        if (!type.startsWith(PREFIX)) return state;\n\n        const command = action.type.substr(PREFIX.length);\n        switch (command) {\n            case \"set\": return set(state, action.organizations);\n            case \"add\": return add(state, action.organization);\n            case \"update\": return update(state, action.organization);\n            default: throw Error(`Unknown action \"${type}\"!`);\n        }\n    },\n\n    setOrganizations(organizations: IOrganization[]): IAction {\n        return { type: \"organization:set\", organizations };\n    },\n\n    addOrganization(organization: IOrganization): IAction {\n        return { type: \"organization:add\", organization };\n    },\n\n    updateOrganization(organization: IOrganization): IAction {\n        return { type: \"organization:update\", organization };\n    }\n}\n\nfunction set(state: IOrganization[], organizations: IOrganization[]): IOrganization[] {\n    return organizations.slice();\n}\n\nfunction add(state: IOrganization[], organization: IOrganization): IOrganization[] {\n    const newState = state.slice();\n    newState.push(organization);\n    return newState;\n}\n\n\nfunction update(state: IOrganization[], organization: IOrganization): IOrganization[] {\n    return state.map(item => item.id === organization.id ? organization : item);\n}\n","import { IAction } from \"../types\"\n\nconst PREFIX = \"page:\"\n\nexport default {\n    INITIAL_STATE: \"welcome\",\n\n    reducer(state: string, action: IAction): string {\n        const { type } = action\n        if (!type.startsWith(PREFIX)) return state\n\n        switch (action.type.substr(PREFIX.length)) {\n            case \"page\": return action.page\n            default: throw Error(`Unknown action \"${type}\"!`)\r\n        }\n    },\n\n    page(page: string): IAction {\n        return { type: \"page:page\", page };\n    }\n}\n","import { IAction, ICarecenter } from \"../types\"\n\nconst PREFIX = \"carecenter:\";\n\nexport default {\n    INITIAL_STATE: [],\n\n    reducer(state: ICarecenter[], action: IAction): ICarecenter[] {\n        const { type } = action;\n        if (!type.startsWith(PREFIX)) return state;\n\n        const command = action.type.substr(PREFIX.length);\n        switch (command) {\n            case \"set\": return set(state, action.carecenters);\n            case \"add\": return add(state, action.carecenter);\n            case \"update\": return update(state, action.carecenter);\n            default: throw Error(`Unknown action \"${type}\"!`);\n        }\n    },\n\n    setCarecenters(carecenters: ICarecenter[]): IAction {\n        return { type: \"carecenter:set\", carecenters };\n    },\n\n    addCarecenter(carecenter: ICarecenter): IAction {\n        return { type: \"carecenter:add\", carecenter };\n    },\n\n    updateCarecenter(carecenter: ICarecenter): IAction {\n        return { type: \"carecenter:update\", carecenter };\n    }\n}\n\nfunction set(state: ICarecenter[], carecenters: ICarecenter[]): ICarecenter[] {\n    return carecenters.slice();\n}\n\nfunction add(state: ICarecenter[], carecenter: ICarecenter): ICarecenter[] {\n    const newState = state.slice();\n    newState.push(carecenter);\n    return newState;\n}\n\nfunction update(state: ICarecenter[], carecenter: ICarecenter): ICarecenter[] {\n    return state.map(\n        item => item.id === carecenter.id ? Object.assign(item, carecenter) : item);\n}\n","import { IStructure, IPatientField } from \"../types\"\r\nimport State from '../state'\r\nimport Intl from \"../tfw/intl\"\r\n\r\nexport default {\r\n    createPatientsFieldsFromStructure,\r\n    createPatientsFieldsCaptionsFromStructure,\r\n    getFieldCaption,\r\n    getCurrentStructure\r\n}\r\n\r\nfunction createPatientsFieldsFromStructure(structure: IStructure): { [key: string]: boolean } {\r\n    const patientsFields: { [key: string]: boolean } = {};\r\n    structure.patientFields.forEach((patientField: IPatientField) => {\r\n        patientsFields[patientField.id] = true;\r\n    });\r\n    return patientsFields;\r\n}\r\n\r\nfunction createPatientsFieldsCaptionsFromStructure(structure: IStructure): { [key: string]: string } {\r\n    const patientsFieldsCaptions: { [key: string]: string } = {};\r\n    structure.patientFields.forEach((patientField: IPatientField) => {\r\n        patientsFieldsCaptions[patientField.id] = Intl.toText(patientField.caption);\r\n    });\r\n    return patientsFieldsCaptions;\r\n}\r\n\r\nfunction getFieldCaption(key: string, structure: IStructure) {\r\n    if (key.charAt(0) !== '#') return key;\r\n    const item: { caption: string, type: string } | undefined =\r\n        structure.formFields[key];\r\n    if (!item) return key;\r\n    return Intl.toText(item.caption);\r\n}\r\n\r\nfunction getCurrentStructure(): IStructure | null {\r\n    const state = State.store.getState()\r\n    const carecenter = state.current.carecenter\r\n    if (!carecenter) return null\r\n    const structureId = carecenter.structureId\r\n    const structure = state.structures.find(\r\n        struc => struc.id === structureId\r\n    )\r\n    if (!structure) return null\r\n    return structure\r\n}\r\n\r\n\r\nclass Structure {\r\n    public readonly data: IStructure\r\n\r\n    constructor(data: IStructure) {\r\n        this.data = data\r\n    }\r\n\r\n\r\n}\r\n","import { IAction, IStructure } from \"../types\"\n\nconst PREFIX = \"structure:\";\n\nexport default {\n    INITIAL_STATE: [],\n\n    reducer(state: IStructure[], action: IAction): IStructure[] {\n        const { type } = action;\n        if (!type.startsWith(PREFIX)) return state;\n\n        const command = action.type.substr(PREFIX.length);\n        switch (command) {\n            case \"set\": return set(state, action.structures);\n            case \"add\": return add(state, action.structure);\n            case \"update\": return update(state, action.structure);\n            default: throw Error(`Unknown action \"${type}\"!`);\n        }\n    },\n\n    setStructures(structures: IStructure[]): IAction {\n        return { type: \"structure:set\", structures };\n    },\n\n    addStructure(structure: IStructure): IAction {\n        return { type: \"structure:add\", structure };\n    },\n\n    updateStructure(structure: IStructure): IAction {\n        return { type: \"structure:update\", structure };\n    }\n}\n\nfunction set(state: IStructure[], structures: IStructure[]): IStructure[] {\n    return structures.slice();\n}\n\nfunction add(state: IStructure[], structure: IStructure): IStructure[] {\n    const newState = state.slice();\n    newState.push(structure);\n    return newState;\n}\n\nfunction update(state: IStructure[], structure: IStructure): IStructure[] {\n    return state.map(\n        item => item.id === structure.id ? Object.assign(item, structure) : item);\n}\n","import { IAction, IStatsConfig } from \"../types\"\nimport castString from \"../tfw/converter/string\"\nimport castBoolean from \"../tfw/converter/boolean\"\n\nconst PREFIX = \"stats-config:\";\nconst INITIAL_STATE: IStatsConfig = {\n    statsType: \"consultations\",\n    dateMin: lastMonth(),\n    dateMax: today(),\n    patientsFields: {\n        birthday: true,\n        size: false,\n        nationality: true\n    },\n    patientsFieldsCaptions: {\n        birthday: \"Date de naissance\",\n        size: \"Taille\",\n        nationality: \"Nationalité\"\n    },\n    carecenter: {\n        id: 0,\n        organizationId: 0,\n        structureId: 0,\n        patientsCount: 0,\n        consultationsCount: 0,\n        name: \"\",\n        code: \"\"\n    }\n}\n\nexport default {\n    INITIAL_STATE,\n\n    reducer(state: IStatsConfig, action: IAction): IStatsConfig {\n        const { type } = action;\n        if (!type.startsWith(PREFIX)) return state;\n\n        switch (action.type.substr(PREFIX.length)) {\n            case \"setType\": return setType(state, action);\n            case \"setDateMin\": return setDateMin(state, action);\n            case \"setDateMax\": return setDateMax(state, action);\r\n            case \"setPatientsFields\": return setPatientsFields(state, action);\r\n            case \"setPatientField\": return setPatientField(state, action);\r\n            default: throw Error(`Unknown action \"${type}\"!`);\r\n        }\n    },\n\n    setType(statsType: \"patients\" | \"consultations\"): IAction {\n        return { type: \"stats-config:setType\", statsType };\n    },\n\n    setDateMin(date: number): IAction {\n        return { type: \"stats-config:setDateMin\", date };\n    },\n\n    setDateMax(date: number): IAction {\n        return { type: \"stats-config:setDateMax\", date };\n    },\n\n    setPatientsFields(fields: { [key: string]: boolean }): IAction {\n        return { type: \"stats-config:setPatientsFields\", fields };\n    },\n\n    setPatientField(fieldName: string, fieldVisibility: boolean): IAction {\n        return { type: \"stats-config:setPatientField\", fieldName, fieldVisibility };\n    }\n}\n\nfunction setType(state: IStatsConfig, action: IAction): IStatsConfig {\n    return {\n        ...state,\n        statsType: action.statsType || \"consultations\"\n    };\n}\n\nfunction setDateMin(state: IStatsConfig, action: IAction): IStatsConfig {\n    return {\n        ...state,\n        dateMin: action.date\n    };\n}\n\nfunction setDateMax(state: IStatsConfig, action: IAction): IStatsConfig {\n    return {\n        ...state,\n        dateMax: action.date\n    };\n}\n\nfunction setPatientsFields(state: IStatsConfig, action: IAction): IStatsConfig {\n    return {\n        ...state,\n        patientsFields: action.fields || {}\n    };\n}\n\nfunction setPatientField(state: IStatsConfig, action: IAction): IStatsConfig {\n    if (typeof action.fieldName !== 'string') {\n        throw Error(`action must have an attribute \"fieldName\" of type \"string\" but we found \"${typeof action.fieldName}\"`);\n    }\n    const fieldName: string = castString(action.fieldName, \"\");\n    const fieldVisibility: boolean = castBoolean(action.fieldVisibility, false);\n    return {\n        ...state,\n        patientsFields: {\n            ...state.patientsFields,\n            [fieldName]: fieldVisibility\n        }\n    };\n}\n\n\nfunction today() {\n    return Date.now();\n}\n\nfunction lastMonth() {\n    const today = new Date();\n    if (today.getDate() !== 1) {\n        const firstDayOfCurrentMonth = new Date(today.getFullYear(), today.getMonth(), 1);\n        return firstDayOfCurrentMonth.getTime();\n    } else {\n        const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());\n        return lastMonth.getTime();\n    }\n}\n","import { IAction, IStatsConfig } from \"../types\"\nimport castString from \"../tfw/converter/string\"\nimport castBoolean from \"../tfw/converter/boolean\"\n\nconst PREFIX = \"stats:\";\n\nexport default {\n    INITIAL_STATE: [],\n\n    reducer(state: IStatsConfig[], action: IAction): IStatsConfig[] {\n        const { type } = action;\n        if (!type.startsWith(PREFIX)) return state;\n\n        switch (action.type.substr(PREFIX.length)) {\n            case \"addStat\": return addStat(state, action);\n            default: throw Error(`Unknown action \"${type}\"!`);\r\n        }\n    },\n\n    addStat(stat: IStatsConfig): IAction {\n        return { type: \"stats:addStat\", stat };\n    }\n}\n\nfunction addStat(state: IStatsConfig[], action: IAction): IStatsConfig[] {\n    const stats = state.stats.slice();\n    stats.push( action.stat );\n    return stats;\n}\n","import { IStatsConfig } from \"../types\"\r\n\r\nexport default {\r\n    statsConfig(obj: IStatsConfig): string {\r\n        return `${obj.statsType}/${obj.dateMin}-${obj.dateMax}`;\r\n    }\r\n}\r\n","/**\n * The full state of the application is stored and managed here.\n */\nimport { createStore } from 'redux'\nimport Current from './current'\nimport User from \"./user\"\nimport Organizations from \"./organizations\"\nimport Page from \"./page\"\nimport Carecenters from \"./carecenters\"\nimport Structure from \"../structure\"\nimport Structures from \"./structures\"\nimport StatsConfig from \"./stats-config\"\nimport Stats from \"./stats\"\nimport Hash from \"../util/hash\"\nimport { IState, IAction } from \"../types\"\n\nfunction dispatch(action: IAction) {\n    store.dispatch(action)\n}\n\nconst INITIAL_STATE: IState = {\n    current: Current.INITIAL_STATE,\n    carecenters: Carecenters.INITIAL_STATE,\n    organizations: Organizations.INITIAL_STATE,\n    page: Page.INITIAL_STATE,\n    stats: Stats.INITIAL_STATE,\n    statsConfig: StatsConfig.INITIAL_STATE,\n    structures: Structures.INITIAL_STATE,\n    user: User.INITIAL_STATE\n}\n\nfunction reducer(state: IState | undefined = INITIAL_STATE, action: IAction): IState {\n    switch (action.type) {\n        case \"initStatsConfig\": return initStatsConfig(state, action)\n        case \"addStat\": return addStat(state, action)\n        case \"removeStat\": return removeStat(state, action)\n        default: return {\n            current: Current.reducer(state.current, action),\n            user: User.reducer(state.user, action),\n            stats: Stats.reducer(state.stats, action),\n            organizations: Organizations.reducer(state.organizations, action),\n            page: Page.reducer(state.page, action),\n            carecenters: Carecenters.reducer(state.carecenters, action),\n            structures: Structures.reducer(state.structures, action),\n            statsConfig: StatsConfig.reducer(state.statsConfig, action)\n        }\n    }\n}\n\nconst store = createStore(reducer)\n\nfunction addStat(state: IState, action: IAction): IState {\n    const h = Hash.statsConfig(state.statsConfig)\n    const stats = state.stats.filter(s => Hash.statsConfig(s) !== h)\n    stats.push({ ...state.statsConfig })\n    return { ...state, stats }\n}\n\nfunction removeStat(state: IState, action: IAction): IState {\n    const stats = state.stats.filter(s => Hash.statsConfig(s) !== action.key)\n    return { ...state, stats }\n}\n\nfunction initStatsConfig(state: IState, action: IAction): IState {\n    const carecenterId = action.carecenterId\n    const carecenter = state.carecenters.find(c => c.id === carecenterId)\n    if (!carecenter) {\n        throw Error(`There is no Carecenter with id=${carecenterId}!`)\n    }\n    const structureId = carecenter.structureId\n    if (typeof structureId !== 'number') {\n        throw Error('Missing attribute number \"structureId\"!')\n    }\n    const structure = state.structures.find(s => s.id === structureId)\n    if (!structure) {\n        throw Error(`There is no structure with id ${structureId}!`)\n    }\n    return {\n        ...state,\n        statsConfig: {\n            ...state.statsConfig,\n            carecenter,\n            patientsFields: Structure.createPatientsFieldsFromStructure(structure),\n            patientsFieldsCaptions: Structure.createPatientsFieldsCaptionsFromStructure(structure)\n        }\n    }\n}\n\nexport default {\n    store, dispatch,\n\n    Current, Page, User, Organizations, Carecenters, Structures, StatsConfig,\n\n    initStatsConfig(carecenterId: number): IAction {\n        return { type: \"initStatsConfig\", carecenterId }\n    },\n    addStat(): IAction {\n        return { type: \"addStat\" }\n    },\n    removeStat(key: string): IAction {\n        return { type: \"removeStat\", key }\n    }\n}\n","import WebService from \"../tfw/web-service\"\n\nexport default {\n    async list() {\n        return await WebService.exec(\"orga.list\");\n    }\n}\n","import WebService from \"../tfw/web-service\"\nimport { ICarecenter } from \"../types\"\n\ninterface IServiceCarecenter {\n    id: number;\n    name: string;\n    code: string;\n    patientsCount: number;\n    consultationsCount: number;\n    structure: number;\n}\n\nexport default {\n    async list( organizationId: number) : Promise<ICarecenter[]> {\n        const carecenters = await WebService.exec(\"carecenter.list\", organizationId);\n        return carecenters.map( (carecenter: IServiceCarecenter) => ({\n            id: carecenter.id,\n            name: carecenter.name,\n            code: carecenter.code,\n            patientsCount: carecenter.patientsCount,\n            consultationsCount: carecenter.consultationsCount,\n            structureId: carecenter.structure,\n            organizationId\n        }));\n    }\n}\n","import Intl from \"../tfw/intl\";\r\nconst _ = Intl.make(require(\"./parser.yaml\"));\r\n\r\n\r\n/**\r\n * Le fichier `types.org` définit tous  les types de données complexe.\r\n * Il  n'y a  pas  de type  très contraignant,  tous  les textes  sont\r\n * libres, mais on propose des listes pour faciliter la saisie. Chaque\r\n * élément  de cette  liste est  muni d'un  identifiant (précédé  d'un\r\n * dièse `#`).\r\n * Un type peut être hiérarchique. Par exemple, une adresse propose un\r\n * pays, une région,  un district, ... Les  propositions dépendent des\r\n * choix  précédents. Ainsi,  la liste  des propositions  de districts\r\n * dépend de la région sélectionnée.\r\n *\r\n * Le  parsing du  fichier `types.org`  se  fait ligne  par ligne.  On\r\n * ignore tous  les espaces/tabulations en  début de ligne.  Le nombre\r\n * d'astérisques  `*`  qui  commencent  une ligne  indique  le  niveau\r\n * hiérarchique.\r\n * Au  niveau 1,  on trouve  l'identifiant du  type qui  doit toujours\r\n * commencer par un dièse `#`.\r\n *\r\n * Voici un  exemple de  fichier en  entrée et de  comment on  doit le\r\n * traduire.\r\n * ```\r\n * #GENDER\r\n * * #H Homme\r\n * * #F Femme\r\n *\r\n * #LOCALIZATION\r\n * * Cameroun\r\n * ** Littoral\r\n * *** District 9\r\n * **** Village 1\r\n * **** Village 2\r\n * **** Village 3\r\n * *** Un peu plus loin\r\n * **** Village A\r\n * **** Village B\r\n * ** Centre\r\n * *** Pas tout près\r\n * **** Village Toto\r\n * *** Au fin fond du...\r\n * **** Village Alpha\r\n * **** Village Beta\r\n * **** Village Gama\r\n * ```\r\n *\r\n * ```\r\n * {\r\n *   \"#GENDER\": {\r\n *     \"#H\": { \"caption\": \"Homme\" },\r\n *     \"#F\": { \"caption\": \"Femme\" }\r\n *   },\r\n *   \"#LOCALIZATION\": {\r\n *     \"Cameroun\": { \"caption\": \"Cameroun\", \"children\": {\r\n *       \"Littoral\": { \"caption\": \"Littoral\", \"children\": {\r\n *         ...\r\n *       }},\r\n *       \"Centre\": { \"caption\": \"Centre\", \"children\": {\r\n *         ...\r\n *       }},\r\n *       ...\r\n *     }}\r\n *   }\r\n * }\r\n * ```\r\n */\r\n\r\n\r\nconst RX_LINE = /^(#[A-Z0-9-]+)?([^\\(@]*)(\\([^\\)]*\\)\\+?)?(@[A-Z0-9,-]+)?/;\r\n\r\n\r\nfunction parse(code: string) {\r\n    const types = {};\r\n    const levels = [types];\r\n    if (typeof code !== 'string') code = `${code}`;\r\n    code.split('\\n').forEach(function(line, lineNumber) {\r\n        try {\r\n            line = line.trim();\r\n            // Ignorer les lignes vides.\r\n            if (line.length === 0) return;\r\n            // Ignorer les commentaires.\r\n            if (line.substr(0, 2) === '//') return;\r\n            if (line.charAt(0) !== '*') throw _('err-1');\r\n\r\n            // Calculer le niveau hiérarchique `level`.\r\n            const level = computeLevel(line);\r\n            line = line.substr(level).trim();\r\n\r\n            if (level > levels.length) {\r\n                throw _('err-2', line, levels.length - 1, level);\r\n            }\r\n            while (levels.length > level) {\r\n                levels.pop();\r\n            }\r\n            const item = parseLine(line);\r\n            if (typeof levels[levels.length - 1][item.id] !== 'undefined') {\r\n                throw _('err-3', item.id);\r\n            }\r\n            levels[levels.length - 1][item.id] = item;\r\n            levels.push(item.children || {});\r\n        }\r\n        catch (ex) {\r\n            throw { lineNumber: lineNumber + 1, message: ex };\r\n        }\r\n    });\r\n    return types;\r\n};\r\n\r\n\r\n/**\r\n * @param   {string} line - Line to parse.\r\n * @returns {number} Number of leading '*' in the line.\r\n */\r\nfunction computeLevel(line: string): number {\r\n    let level = 0;\r\n    while (line.charAt(0) == '*') {\r\n        line = line.substr(1);\r\n        level++;\r\n    }\r\n    return level;\r\n}\r\n\r\n\r\nfunction parseLine(line: string) {\r\n    const item = { children: {} };\r\n    const m = RX_LINE.exec(line.trim());\r\n    if (m[2]) {\r\n        item.caption = m[2].trim();\r\n    }\r\n    if (m[1]) {\r\n        item.id = m[1].trim();\r\n    } else {\r\n        item.id = item.caption.toUpperCase();\r\n    }\r\n    if (m[3]) {\r\n        item.type = m[3].substr(1, m[3].length - 2).trim();\r\n    }\r\n    if (m[4]) {\r\n        item.tags = m[4].trim().substr(1).split(',').map(function(v) { return v.trim(); });\r\n    }\r\n    return item;\r\n}\r\n\r\n\r\n/**\r\n * @param {object} forms\r\n * {\r\n *   CONCLUSION: {\r\n *     caption: \"Conclusion\",\r\n *     children: {\r\n *       \"#SURGERY-GYN\": {\r\n *         caption: \"Chirurgie\",\r\n *         id: \"#SURGERY-GYN\",\r\n *         type: \"#SURGERY-GYN\"\r\n *       }\r\n *     }\r\n *   },\r\n *   ...\r\n * }\r\n * @return `[{ id:\"#SURGERY-GYN\", caption:\"Chirurgie\", path:[\"Conclusion\", \"Chirurgie\"] }, ...]`\r\n */\r\nfunction flattenFormsFields(forms) {\r\n    var list = [];\r\n    recursiveFlattenFormsFields(forms, list, []);\r\n    list.sort(function(a, b) {\r\n        var captionA = a.caption;\r\n        var captionB = b.caption;\r\n        if (captionA < captionB) return -1;\r\n        if (captionA > captionB) return +1;\r\n        return 0;\r\n    });\r\n    return list;\r\n}\r\n\r\n\r\nfunction recursiveFlattenFormsFields(children, list, path) {\r\n    Object.keys(children).forEach(function(key) {\r\n        var child = children[key];\r\n        if (typeof child.id === 'string' && child.id.charAt(0) === '#') {\r\n            // Leave.\r\n            list.push({\r\n                id: child.id,\r\n                caption: child.caption,\r\n                path: path.slice()\r\n            });\r\n        }\r\n        else if (child.children) {\r\n            // Node.\r\n            path.push(child.caption);\r\n            recursiveFlattenFormsFields(child.children, list, path);\r\n            path.pop();\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport default { parse, flattenFormsFields }\r\n","import WebService from \"../tfw/web-service\"\nimport Parser from \"../structure/parser\"\nimport Intl from \"../tfw/intl\"\nimport castString from \"../tfw/converter/string\"\nimport { IStructure, IPatientField } from \"../types\"\n\nexport interface IStructureService {\n    id: number;\n    name: string;\n    exams: string;\n    vaccins: string;\n    patient: string;\n    forms: string;\n    types: string;\n}\n\n\nexport default {\n    async list(organizationId: number) {\n        const structures: IStructureService[] =\n            await WebService.exec(\"structure.list\", organizationId);\n        return structures.map((structure: IStructureService) => (\r\n            {\n                id: structure.id,\n                organizationId,\n                name: structure.name,\n                patientFields: parsePatient(structure.patient),\n                formFields: parseFormFields(structure),\n                exams: parse(structure.exams),\n                vaccins: parse(structure.vaccins),\n                forms: parse(structure.forms),\n                types: parse(structure.types),\n                sources: {\n                    exams: structure.exams,\n                    vaccins: structure.vaccins,\n                    patient: structure.patient,\n                    forms: structure.forms,\n                    types: structure.types\n                }\n            }\r\n        ));\n    }\n}\n\n\nfunction parse(def: string) {\n    try {\n        return Parser.parse(def);\n    }\n    catch (ex) {\n        console.error(\"[parsePatient] \", ex);\n        console.log(def);\n    }\n    return null;\n}\n\nfunction parsePatient(stringifiedPatientDef: string): IPatientField[] {\n    try {\n        const raw = Parser.parse(stringifiedPatientDef);\n        const patients: IPatientField[] = Object.keys(raw).map((id: string) => {\n            const patient = raw[id];\n            return {\n                id,\n                type: patient.type,\n                caption: Intl.toIntl(patient.caption)\n            }\n        });\n        return patients;\n    }\n    catch (ex) {\n        console.error(\"[parsePatient] \", ex);\n    }\n    return [];\n}\n\ninterface IFlatField {\n    type: string;\n    caption: { [key: string]: string };\n}\n\nfunction parseFormFields(structure: IStructureService): { [key: string]: IFlatField } {\n    const result: { [key: string]: IFlatField } = {};\n    const fringe = [parse(structure.forms)];\n    while (fringe.length > 0) {\n        const item = fringe.shift();\n        for (const name of Object.keys(item)) {\n            const value = item[name];\n            result[name] = { caption: Intl.toIntl(value.caption) };\n            if (value.type) result[name].type = value.type;\n            if (value.children) {\n                fringe.push(value.children);\n            }\n        }\n    }\n    return result;\n}\n","import * as React from \"react\"\r\nimport castArray from \"../tfw/converter/array\"\r\nimport castInteger from \"../tfw/converter/integer\"\r\nimport \"./pie.css\"\r\n\r\ninterface IPieProps {\r\n    values: number[];\r\n    colors?: string[];\r\n    size?: number;\r\n}\r\ninterface IPieState { }\r\n\r\nconst DEFAULT_COLORS = [\"#b37036\", \"#cc7529\", \"#e67717\", \"#ff7700\", \"#765\"];\r\n\r\nexport default class Pie extends React.Component<IPieProps, IPieState> {\r\n    private readonly canvas: React.RefObject<HTMLCanvasElement> = React.createRef();\r\n\r\n    componentDidMount() {\r\n        this.paint();\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.paint();\r\n    }\r\n\r\n    paint() {\r\n        if (!this.canvas.current) return;\r\n        const\r\n            canvas: HTMLCanvasElement = this.canvas.current,\r\n            values = this.props.values,\r\n            colors = castArray(this.props.colors, DEFAULT_COLORS).slice(),\r\n            size = canvas.width,\r\n            lineWidth = 1,\r\n            radius = Math.floor(size / 2) - 3,\r\n            turn = 2 * Math.PI,\r\n            angleStep = turn / size,\r\n            total = this.props.values.reduce((acc, val) => val + acc),\r\n            ctx = canvas.getContext(\"2d\");\r\n        if (!ctx) return;\r\n        let\r\n            angle = 0,\r\n            angleTarget = 0;\r\n\r\n        const lineTo = (ang: number) => ctx.lineTo(radius * Math.sin(ang), -radius * Math.cos(ang));\r\n\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, size, size);\r\n        if (total > 0) {\r\n            ctx.translate(size / 2, size / 2);\r\n            ctx.fillStyle = \"#000\";\r\n            ctx.globalAlpha = 0.5;\r\n            ctx.ellipse(0, 0, size / 2, size / 2, 0, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            ctx.strokeStyle = \"#000\";\r\n            ctx.lineWidth = lineWidth;\r\n            for (let i = 0; i < colors.length; i++) {\r\n                const color = colors[i % colors.length];\r\n                ctx.fillStyle = color;\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, 0);\r\n                angleTarget = angle + turn * values[i] / total;\r\n                do {\r\n                    lineTo(angle);\r\n                    angle += angleStep;\r\n                } while (angle < angleTarget)\r\n                lineTo(angleTarget);\r\n                angle = angleTarget;\r\n                ctx.closePath();\r\n                ctx.globalAlpha = 1;\r\n                ctx.fill();\r\n                ctx.globalAlpha = 0.2;\r\n                ctx.stroke();\r\n            }\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    render() {\r\n        const p = this.props;\r\n        const colors = castArray(p.colors, DEFAULT_COLORS);\r\n        const size = castInteger(p.size, 200);\r\n\r\n        return (\r\n            <canvas\r\n                ref={this.canvas}\r\n                width={size} height={size}\r\n                className=\"presentation-pie\">\r\n            </canvas>\r\n        );\r\n    }\r\n}\r\n","import * as React from \"react\"\r\nimport \"./combo.css\"\r\nimport castString from \"../converter/string\"\r\nimport castBoolean from \"../converter/boolean\"\r\nimport castStringArray from \"../converter/string-array\"\r\nimport Touchable from \"../behavior/touchable\"\r\nimport Icon from \"./icon\"\r\nimport Label from \"./label\"\r\nimport Gesture from \"../gesture\"\r\nimport EscapeHandler from \"../escape-handler\"\r\n\r\ninterface IComboProps {\r\n    label?: string;\r\n    value?: string;\r\n    keys?: string[];\r\n    wide?: boolean;\r\n    onChange?: (value: string) => void;\r\n    children: React.ReactElement<any>[];\r\n}\r\n\r\nexport default class Combo extends React.Component<IComboProps, {}> {\r\n    readonly touchable: Touchable;\r\n\r\n    ref = React.createRef<HTMLButtonElement>()\r\n    list = React.createRef<HTMLDivElement>()\r\n    button = React.createRef<HTMLDivElement>()\r\n\r\n    bigList: HTMLElement | undefined;\r\n\r\n    keys: string[] = []\r\n    selectedKey: string = \"\"\r\n    selectedIndex: number = -1\r\n\r\n    constructor(props: IComboProps) {\r\n        super(props);\r\n        this.handleClick = this.handleClick.bind(this);\r\n        this.touchable = new Touchable({ onTap: this.handleClick });\r\n    }\r\n\r\n    handleClick() {\r\n        this.expand();\r\n    }\r\n\r\n    /**\r\n     * If there are only two items, we don't open the list: we just swap them.\r\n     */\r\n    _swapItems() {\r\n        // With two items, clicking will immediatly switch to the next one.\r\n        for (const key of this.keys) {\r\n            if (this.props.value !== key) {\r\n                const slot = this.props.onChange;\r\n                if (typeof slot === 'function') {\r\n                    slot(key);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    _computeDimensions(list: HTMLElement, button: HTMLElement): { left: number, top: number, width: number, height: number } {\r\n        let { left, top, height } = list.getBoundingClientRect();\r\n        const { width } = button.getBoundingClientRect();\r\n        height = Math.min(height, window.innerHeight - 32);\r\n        if (top + height > window.innerHeight) {\r\n            top -= 32 * Math.ceil(window.innerHeight - top - height / 32);\r\n        }\r\n        if (top < 0) {\r\n            top += 32 * Math.ceil(-top / 32);\r\n        }\r\n        return { left, top, width, height };\r\n    }\r\n\r\n    _showList(list: HTMLElement, button: HTMLElement, left: number, top: number, width: number, height: number): { screen: HTMLElement, bigList: HTMLElement } {\r\n        const screen = document.createElement(\"div\");\r\n        screen.className = \"tfw-view-combo-screen\";\r\n        const bigList = document.createElement(\"div\");\r\n        bigList.className = \"thm-ele-nav thm-bg3\";\r\n        bigList.innerHTML = list.innerHTML;\r\n\r\n        bigList.style.top = `${top}px`;\r\n        bigList.style.left = `${left}px`;\r\n        bigList.style.width = `${width}px`;\r\n        bigList.style.height = `${height}px`;\r\n        screen.appendChild(bigList);\r\n        document.body.appendChild(screen);\r\n\r\n        this.bigList = bigList;\r\n        return { screen, bigList };\r\n    }\r\n\r\n    _ensureSelectionVisible() {\r\n        let index = 0;\r\n        const bigList: HTMLElement | undefined = this.bigList;\r\n        if (!bigList) return;\r\n        const items = bigList.querySelectorAll(\"div.item\");\r\n        for (const key of this.keys) {\r\n            const item = items[index];\r\n            if (key === this.selectedKey) {\r\n                const rect = bigList.getBoundingClientRect();\r\n                bigList.scrollTop = (32 * index) - rect.height / 2;\r\n                this.selectedIndex = index;\r\n                item.classList.add(\"thm-bgSL\");\r\n            } else {\r\n                item.classList.remove(\"thm-bgSL\");\r\n            }\r\n            index++;\r\n        }\r\n    }\r\n\r\n    _handleKeyboard(event: React.KeyboardEvent) {\r\n        switch (event.key) {\r\n            case \"ArrowDown\":\r\n                this.selectedIndex++;\r\n                this.selectedKey = this.keys[this.selectedIndex % this.keys.length];\r\n                this._ensureSelectionVisible();\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                return;\r\n            case \"ArrowUp\":\r\n                this.selectedIndex = (this.selectedIndex + this.keys.length - 1) % this.keys.length;\r\n                this.selectedKey = this.keys[this.selectedIndex];\r\n                this._ensureSelectionVisible();\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                return;\r\n            case \"Enter\":\r\n            case \" \":\r\n                const slot = this.props.onChange;\r\n                if (typeof slot === 'function') {\r\n                    slot(this.selectedKey);\r\n                }\r\n                EscapeHandler.fire();\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                return;\r\n        }\r\n    }\r\n\r\n    expand() {\r\n        if (this.keys.length < 3) {\r\n            this._swapItems();\r\n            return;\r\n        }\r\n\r\n        const list = this.list.current;\r\n        const button = this.button.current;\r\n        if (!list || !button) return;\r\n\r\n        const { left, top, width, height } = this._computeDimensions(list, button);\r\n        const { screen, bigList } = this._showList(list, button, left, top, width, height);\r\n        this.selectedKey = this.props.value || \"\";\r\n        window.setTimeout(() => this._ensureSelectionVisible(bigList), 10);\r\n\r\n        const handleKeyboard = this._handleKeyboard.bind(this);\r\n        document.addEventListener(\"keydown\", handleKeyboard, true);\r\n        EscapeHandler.add(() => {\r\n            document.body.removeChild(screen)\r\n            document.removeEventListener(\"keydown\", handleKeyboard, true);\r\n        });\r\n        Gesture(screen).on({ tap: () => {\r\n            EscapeHandler.fire()\r\n        }});\r\n        Gesture(bigList).on({\r\n            tap: evt => {\r\n                if (!evt || typeof evt.y === 'undefined') return;\r\n                const scroll = bigList.scrollTop;\r\n                const index = Math.floor((evt.y + scroll) / 32);\r\n                const value = this.keys[index];\r\n                EscapeHandler.fire()\r\n                requestAnimationFrame(() => {\r\n                    if (typeof this.props.onChange === 'function') {\r\n                        this.props.onChange(value)\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    componentDidMount() {\r\n        const element = this.ref.current;\r\n        if (!element) return;\r\n        this.touchable.element = element;\r\n    }\r\n\r\n    render() {\r\n        const p = this.props;\r\n        const children = p.children;\r\n        const label = castString(p.label, \"\").trim();\r\n        const wide = castBoolean(p.wide, false);\r\n        const keys = ensureGoodKeys(p.keys, children);\r\n        const value = castString(p.value, keys[0]);\r\n        const classes = [\"tfw-view-combo\"];\r\n        const items = children.map(item => {\r\n            const key = item.key;\r\n            return (<div className=\"item\" key={key} > {item} </div>);\r\n        });\r\n\r\n        if (wide) classes.push(\"wide\");\r\n\r\n        this.keys = keys;\r\n\r\n        const index = getIndex(keys, value);\r\n\r\n        return (\r\n            <button ref={this.ref} className={classes.join(\" \")}>\r\n                {label.length > 0 ? <Label label={label}/> : null}\r\n                <div ref={this.button} className=\"button thm-bg3 thm-ele-button\">\r\n                    <div className=\"list-container\"\r\n                        style={{\r\n                            transform: `translateY(-${32 * index}px)`\r\n                        }}>\r\n                        <div ref={this.list} className=\"tfw-view-combo-list\" >{items}</div>\r\n                    </div>\r\n                    <div className=\"icon\" >\r\n                        <Icon size=\"24px\" content=\"down\" />\r\n                    </div>\r\n                </div>\r\n            </button>\r\n        );\r\n    }\r\n}\r\n\r\nfunction getIndex(keys: string[], value: string) {\r\n    const index = keys.indexOf(value);\r\n    return Math.max(0, index);\r\n}\r\n\r\n/**\r\n * Keys must be non empty strings. If a key is not defined, it will take its index (stringified) as value.\r\n * And if a \"key\" its defined on a child, it will take precedence on anything else.\r\n *\r\n* @param  {string[]} keys\r\n* @param  {ReactElement[]} children\r\n          *\r\n* @return {string[]}\r\n*/\r\nfunction ensureGoodKeys(keys: string[] | undefined, children: React.ReactElement<any>[]): string[] {\r\n    const goodKeys: string[] = castStringArray(keys, []);\r\n    const minimalLength: number = children.length;\r\n\r\n    while (goodKeys.length < minimalLength) {\r\n        goodKeys.push(`${goodKeys.length}`);\r\n    }\r\n    for (let k = 0; k < goodKeys.length; k++) {\r\n        if (goodKeys[k].trim().length === 0) {\r\n            goodKeys[k] = `${k}`;\r\n        }\r\n    }\r\n    children.forEach((child, index) => {\r\n        const key = child.key;\r\n        if (typeof key === \"string\") {\r\n            goodKeys[index] = key;\r\n        } else {\r\n            child.key = goodKeys[index];\r\n        }\r\n    });\r\n\r\n    return goodKeys;\r\n}\r\n\r\n\r\nfunction onTap(elem: HTMLElement, handler: () => void) {\r\n    const slot = (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        elem.removeEventListener(\"mousedown\", slot);\r\n        elem.removeEventListener(\"touchdown\", slot);\r\n        handler();\r\n    };\r\n    elem.addEventListener(\"mousedown\", slot, false);\r\n    elem.addEventListener(\"touchdown\", slot, false);\r\n}\r\n","export default {\n    saveAs(blob: Blob, fileName: string) {\n        const url = window.URL.createObjectURL(blob);\n        const anchorElem = document.createElement(\"a\");\n\n        anchorElem.style.display = \"none\";\n        anchorElem.href = url;\n        anchorElem.download = fileName;\n\n        document.body.appendChild(anchorElem);\n        anchorElem.click();\n\n        document.body.removeChild(anchorElem);\n\n        // On Edge, revokeObjectURL should be called only after\n        // a.click() has completed, atleast on EdgeHTML 15.15048\n        setTimeout(function() {\n            window.URL.revokeObjectURL(url);\n        }, 5000);\n    }\n}\n","import WebService from \"../tfw/web-service\"\r\nimport { IStatsConfig, IOccurences, IOccurence } from \"../types\"\r\n\r\ninterface IServiceExtract {\r\n    patients: {};\r\n    data: {};\r\n}\r\n\r\ninterface IOccurencesDictionary {\r\n    [key: string]: { [key: string]: number }\r\n}\r\n\r\nexport default {\r\n    async extract(statsConfig: IStatsConfig): Promise<{}> {\r\n        const extraction = await WebService.exec(\"extract\", {\r\n            carecenter: statsConfig.carecenter.id,\r\n            begin: convertTime(statsConfig.dateMin),\r\n            end: convertTime(statsConfig.dateMax)\r\n        });\r\n        const result = {};\r\n        Object.values(extraction.data).forEach(consultation => {\r\n            Object.keys(consultation)\r\n                .filter(key => key.charAt(0) === '#')\r\n                .forEach(key => {\r\n                    const val = consultation[key];\r\n                    if (typeof result[key] === 'undefined') {\r\n                        result[key] = {};\r\n                    }\r\n                    const item = result[key];\r\n                    const occurences = item[val];\r\n                    if (typeof occurences === 'undefined') {\r\n                        item[val] = 1;\r\n                    } else {\r\n                        item[val]++;\r\n                    }\r\n                })\r\n        })\r\n        return convertIntoOccurences(result);\r\n    }\r\n}\r\n\r\n/**\r\n * Convert a number of milliseconds into a number of seconds.\r\n */\r\nfunction convertTime(milliseconds: number): number {\r\n    return Math.floor(.5 + milliseconds * 0.001);\r\n}\r\n\r\n\r\nfunction convertIntoOccurences(input: IOccurencesDictionary): { [key: string]: IOccurences } {\r\n    const result: { [key: string]: IOccurences } = {};\r\n    Object.keys(input).forEach(fieldName => {\r\n        const occurences = { sum: 0, occ: [] };\r\n        result[fieldName] = occurences;\r\n        const fieldValues = input[fieldName];\r\n        Object.keys(fieldValues).forEach(value => {\r\n            const occ = fieldValues[value];\r\n            occurences.sum += occ;\r\n            occurences.occ.push([value, occ]);\r\n        })\r\n        occurences.occ.sort(sortDescBySecondElement);\r\n    })\r\n    return result;\r\n}\r\n\r\n\r\nfunction sortDescBySecondElement(a: IOccurence, b: IOccurence): number {\r\n    const\r\n        A = a[1],\r\n        B = b[1];\r\n    return B - A;\r\n}\r\n","import * as React from \"react\"\r\nimport { IStatsConfig, IStructure, IOccurences } from \"../types\"\r\nimport Pie from \"./pie\"\r\nimport Flex from \"../tfw/layout/flex\"\r\nimport Icon from \"../tfw/view/icon\"\r\nimport Combo from \"../tfw/view/combo\"\r\nimport Button from \"../tfw/view/button\"\r\nimport FileAPI from \"../tfw/fileapi\"\r\nimport Structure from \"../structure\"\r\nimport StatService from \"../service/stat\"\r\n\r\nimport Intl from \"../tfw/intl\"\r\nconst _ = Intl.make(require(\"./stat.yaml\"));\r\n\r\nimport \"./stat.css\"\r\n\r\nconst DEFAULT_COLORS = [\"#b37036\", \"#cc7529\", \"#e67717\", \"#ff7700\", \"#765\"];\r\n\r\ntype TDataFromService = { [key: string]: IOccurences };\r\n\r\ninterface IStatProps {\r\n    stat: IStatsConfig;\r\n    structure: IStructure;\r\n    onClose?: () => void;\r\n}\r\n\r\ninterface IStatState {\r\n    dataFromService?: TDataFromService;\r\n    selectedField: string;\r\n}\r\n\r\nexport default class Stat extends React.Component<IStatProps, IStatState> {\r\n    constructor(props: IStatProps) {\r\n        super(props);\r\n        this.state = { selectedField: \"\" };\r\n        this.handleClose = this.handleClose.bind(this);\r\n    }\r\n\r\n    handleClose() {\r\n        const handler = this.props.onClose;\r\n        if (typeof handler !== 'function') return;\r\n        try {\r\n            handler();\r\n        } catch (ex) {\r\n            console.error(\"Error in handleClose(): \", );\r\n            console.error(ex);\r\n        }\r\n    }\r\n    componentDidUpdate() {\r\n        if (this.state.dataFromService) return;\r\n        console.log(\"componentDidUpdate\");\r\n        this.refresh();\r\n    }\r\n\r\n    componentDidMount() {\r\n        console.log(\"componentDidMount\");\r\n        this.refresh();\r\n    }\r\n\r\n    async refresh() {\r\n        const dataFromService = await StatService.extract(this.props.stat);\r\n        console.info(\"data=\", dataFromService);\r\n        this.setState({ dataFromService });\r\n    }\r\n\r\n    private export() {\r\n        const data: TDataFromService | undefined = this.state.dataFromService;\r\n        if (!data) return;\r\n        const { keys, values } = getFieldsKeysAndValues(data, this.props.structure);\r\n        const output: string[] = [\"Code du champ\\tNom du champ\\tValeur\\tOccurences\"];\r\n        keys.forEach((fieldKey: string, idx: number) => {\r\n            const fieldCaption = values[idx];\r\n            const occurences = data[fieldKey].occ;\r\n            occurences.forEach(([caption, count]: [string, number]) => {\r\n                output.push(`${fieldKey}\\t${fieldCaption}\\t${caption}\\t${count}`);\r\n            })\r\n        });\r\n\r\n        const filename = \"statistics.xls\";\r\n        FileAPI.saveAs(new Blob([output.join(\"\\n\")], { type: \"text/csv\" }), filename);\r\n    }\r\n\r\n    render() {\r\n        const data: TDataFromService | undefined = this.state.dataFromService;\r\n        let content = null;\r\n        if (!data) {\r\n            content = (<Flex>\r\n                <Icon content=\"wait\" animate={true} /><div>{\"Chargement en cours...\"}</div>\r\n            </Flex>);\r\n        } else {\r\n            const { keys, values } = getFieldsKeysAndValues(data, this.props.structure);\r\n            let value = this.state.selectedField;\r\n            if (keys.indexOf(value) === -1) value = keys[0];\r\n            const occurences = data[value];\r\n            if (!occurences) {\r\n                content = <div>{_(\"no-data\")}</div>;\r\n            } else {\r\n                content = (<div>\r\n                    <Combo\r\n                        keys={keys}\r\n                        onChange={selectedField => {\r\n                            console.info(\"[onChange] selectedField=\", selectedField);\r\n                            this.setState({ selectedField });\r\n                        }}\r\n                        value={value}>{\r\n                            values.map((val, idx) => {\r\n                                const key = keys[idx];\r\n                                return <div key={key}><b>{`${val} `}</b><small className='grey'>{key}</small></div>\r\n                            })\r\n                        }</Combo>\r\n                    <br />\r\n                    <center>\r\n                        <Pie colors={DEFAULT_COLORS}\r\n                            values={getValuesForPie(occurences)} />\r\n                    </center>\r\n                    <div>{\r\n                        occurences.occ.map(([caption, count], index) => {\r\n                            const colorIndex = Math.min(DEFAULT_COLORS.length - 1, index);\r\n                            const color = DEFAULT_COLORS[colorIndex];\r\n                            return (\r\n                                <Flex key={index}\r\n                                    justifyContent=\"space-between\"\r\n                                    alignItems=\"center\"\r\n                                    dir=\"row\"\r\n                                    classes={index % 2 ? \"thm-bg1\" : \"thm-bg2\"}>\r\n                                    <Flex\r\n                                        justifyContent=\"space-between\"\r\n                                        wide={false}\r\n                                        dir=\"row\"\r\n                                        alignItems=\"center\">\r\n                                        <div className=\"bullet\" style={{\r\n                                            background: color\r\n                                        }}></div>\r\n                                        <span>{caption}</span>\r\n                                    </Flex>\r\n                                    <div><b>{count}</b></div>\r\n                                </Flex>\r\n                            )\r\n                        })\r\n                    }</div>\r\n                    <Button\r\n                        wide={true}\r\n                        icon=\"export\"\r\n                        label={_(\"export\")}\r\n                        onClick={() => this.export()} />\r\n                </div >);\r\n            }\r\n        }\r\n\r\n        const stat: IStatsConfig = this.props.stat;\r\n        return (\r\n            <div className=\"presentational-stat thm-ele-card thm-bg1\">\r\n                <div className=\"thm-bgPD\">{`${stat.carecenter.name}, du ${formatDate(stat.dateMin)} au ${formatDate(stat.dateMax)}`}</div>\r\n                <div>{content}</div>\r\n                <hr />\r\n                <Flex dir=\"row\" justifyContent=\"flex-end\">\r\n                    <Button\r\n                        onClick={this.handleClose}\r\n                        icon=\"close\"\r\n                        label={_(\"close\")}\r\n                        flat={true} />\r\n                </Flex>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nfunction getFieldsKeysAndValues(data: TDataFromService, structure: IStructure): { keys: string[], values: string[] } {\r\n    const keys = Object.keys(data);\r\n    const values = keys.map(key => Structure.getFieldCaption(key, structure));\r\n    const array = keys.map((key, index) => [key, values[index]]);\r\n    array.sort((a, b) => {\r\n        const A = a[1];\r\n        const B = b[1];\r\n        if (A < B) return -1;\r\n        if (A > B) return +1;\r\n        return 0;\r\n    });\r\n\r\n    return {\r\n        keys: array.map(item => item[0]),\r\n        values: array.map(item => item[1])\r\n    };\r\n}\r\n\r\nfunction formatDate(date: number): string {\r\n    const d = new Date(date);\r\n    return `${d.getDate()}-${1 + d.getMonth()}-${d.getFullYear()}`;\r\n}\r\n\r\n\r\nfunction getValuesForPie(occurences: IOccurences, sectors: number = 4): number[] {\r\n    const { sum, occ } = occurences;\r\n    const values: number[] = [];\r\n    let total = 0;\r\n    for (let i = 0; i < Math.min(sectors, occ.length); i++) {\r\n        const [, count] = occ[i];\r\n        values.push(count);\r\n        total += count;\r\n    }\r\n    if (sum > total) values.push(sum - total);\r\n    return values;\r\n}\r\n","import React from \"react\"\nimport castArray from \"../converter/array\"\nimport castString from \"../converter/string\"\nimport castBoolean from \"../converter/boolean\"\nimport Button from \"../view/button\"\nimport Gesture from \"../gesture\"\nimport \"./sidemenu.css\"\n\ninterface ISidemenuProps {\n    show?: boolean;\n    head?: string;\n    menu?: React.ReactElement<HTMLDivElement>;\n    body?: React.ReactElement<HTMLDivElement>;\n    classes?: string[] | string;\n    onShowChange?: (isMenuVisible: boolean) => void;\n}\n\nexport default class Sidemenu extends React.Component<ISidemenuProps, {}> {\n    refMenu = React.createRef<HTMLDivElement>();\n\n    constructor(props: ISidemenuProps) {\n        super(props);\n        this.handleShowChange = this.handleShowChange.bind(this);\n    }\n\n    componentDidMount() {\n        const menu = this.refMenu.current;\n        if (!menu) return;\n        Gesture(menu).on({\n            swipeleft: () => {\n                const handler = this.props.onShowChange;\n                if (typeof handler === 'function') handler(false);\n            }\n        });\n    }\n    handleShowChange() {\n        const handler = this.props.onShowChange;\n        if (typeof handler !== 'function') return;\n        handler(!castBoolean(this.props.show, window.innerWidth > 480));\n    }\n\n    render() {\n        const show = castBoolean(this.props.show, window.innerWidth > 480);\n        const head = castString(this.props.head, \"\");\n        const classes = [\"tfw-layout-sidemenu thm-bg0\"].concat(castArray(this.props.classes));\n        if (show) classes.push(\"show\");\n\n        return (\n            <div className={classes.join(\" \")} >\n                <div className=\"body thm-bg0\" >{this.props.body}</div>\n                <div className=\"menu thm-ele-nav thm-bg1\" ref={this.refMenu}>\n                    <header className=\"thm-ele-nav thm-bgPD\" >{head}</header>\n                    <menu> {this.props.menu} </menu>\n                </div>\n                <div className=\"icon thm-bgPD\" >\n                    <Button icon=\"menu\" flat={true} onClick={this.handleShowChange} />\n                </div>\n            </div>\n        );\n    }\n}\n","import Intl from \"./tfw/intl\"\nconst _ = Intl.make(require(\"./intl.yaml\"))\n\nclass Dict {\n    get buttonPatient() { return _('button-patient') }\n    get buttonReports() { return _('button-reports') }\n    get buttonStats() { return _('button-stats') }\n    get buttonStruct() { return _('button-struct') }\n    get cancel() { return _('cancel') }\n    get close() { return _('close') }\n    get code() { return _('code') }\n    get consultations() { return _('consultations') }\n    get consultationsCount() { return _('consultations-count') }\n    get countingReports() { return _('counting-reports') }\n    get createStat() { return _('create-stat') }\n    get createStatConsultation() { return _('create-stat-consultation') }\n    get createStatPatient() { return _('create-stat-patient') }\n    get dateMin() { return _('date-min') }\n    get dateMax() { return _('date-max') }\n    get executeQuery() { return _('execute-query') }\n    get extractions() { return _('extractions') }\n    get filter() { return _('filter') }\n    get firstName() { return _('firstname') }\n    get gender() { return _('gender') }\n    genderValue(type: string) {\n        switch (type.trim().toUpperCase()) {\n            case 'M': return _('gender-male')\n            case 'F': return _('gender-female')\n            default: return _('gender-undefined')\n        }\n    }\n    get generatingReport() { return _('generating-report') }\n    get hintReportTemplates() { return _('hint-report-templates') }\n    get identifier() { return _('identifier') }\n    get lastName() { return _('lastname') }\n    get loading() { return _('loading') }\n    get loadingReport() { return _('loading-report') }\n    get logout() { return _('logout') }\n    get patients() { return _('patients') }\n    get patientsCount() { return _('patients-count') }\n    get queryInProgress() { return _('query-in-progress') }\n    get report() { return _('report') }\n    get secondName() { return _('secondname') }\n    get size() { return _('size') }\n    get statType() { return _('stat-type') }\n    get struct() { return _('struct') }\n    get welcome() { return _('welcome') }\n}\n\nexport default new Dict()\n","import Tfw from 'tfw'\nimport * as React from \"react\"\nimport { ICarecenter, IOrganization, IStructure } from \"../../types\"\nimport State from '../../state'\nimport Intl from \"../../intl\"\nimport \"./carecenter-header.css\"\n\nconst Button = Tfw.View.Button\n\ninterface ICarecenterHeaderProps {\n    carecenter: ICarecenter\n    organization: IOrganization\n    structures: IStructure[]\n}\n\nexport default class CarecenterHeader extends React.Component<ICarecenterHeaderProps, {}> {\n    constructor(props: ICarecenterHeaderProps) {\n        super(props);\n        this.handleStatClick = this.handleStatClick.bind(this);\n    }\n\n    setCurrent() {\n        const { carecenter, organization } = this.props\n        State.dispatch(State.Current.set({ carecenter, organization }))\n    }\n\n    handleStatClick = () => {\n        this.setCurrent()\n        State.dispatch(State.Page.page(\"stats\"))\n    }\n\n    handleStructClick = () => {\n        this.setCurrent()\n        State.dispatch(State.Page.page(\"struct\"))\n    }\n\n    handleReportClick = () => {\n        this.setCurrent()\n        State.dispatch(State.Page.page(\"reports\"))\n    }\n\n    handlePatientClick = () => {\n        this.setCurrent()\n        State.dispatch(State.Page.page(\"patients\"))\n    }\n\n    render() {\n        const carecenter: ICarecenter = this.props.carecenter;\n        const structure: IStructure | undefined = this.props.structures\n            .find(s => s.id === carecenter.structureId);\n\n        return (<div className=\"presentational-carecenter-header\">\n            <div>\n                <div className=\"name\">{carecenter.name}</div>\n                <div className=\"prop\">\n                    <div>{Intl.code}</div>\n                    <div>{carecenter.id}-{carecenter.code}</div>\n                </div>\n                <div className=\"prop\">\n                    <div>{Intl.patientsCount}</div>\n                    <div>{carecenter.patientsCount}</div>\n                </div>\n                <div className=\"prop\">\n                    <div>{Intl.consultationsCount}</div>\n                    <div>{carecenter.consultationsCount}</div>\n                </div>\n                <div className=\"prop\">\n                    <div>{Intl.struct}</div>\n                    <div>{structure ? structure.name : '...'}</div>\n                </div>\n            </div>\n            <div className=\"buttons\">\n                <Button\n                    icon=\"stat\"\n                    label={Intl.buttonStats}\n                    small={true}\n                    onClick={this.handleStatClick} />\n                <Button\n                    icon=\"report\"\n                    label={Intl.buttonReports}\n                    small={true}\n                    onClick={this.handleReportClick} /><br />\n                <Button\n                    icon=\"user\"\n                    label={Intl.buttonPatient}\n                    small={true}\n                    onClick={this.handlePatientClick} /><br />\n                <Button\n                    icon=\"sitemap\"\n                    label={Intl.buttonStruct}\n                    small={true}\n                    onClick={this.handleStructClick} /><br />\n            </div>\n        </div>);\n    }\n}\n","import React from \"react\"\nimport Icon from '../../tfw/view/icon'\nimport Intl from '../../intl'\n\nimport \"./wait.css\"\n\ninterface IWaitProps {\n    label?: string\n}\n\nexport default class Wait extends React.Component<IWaitProps, {}> {\n    render() {\n        return (<div className=\"webSoins-Wait\">\n            <Icon content=\"wait\" animate={true} />\n            <div>{this.props.label || Intl.loading}</div>\n        </div>)\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport { IOrganization, ICarecenter, IStructure } from '../../types'\nimport Intl from '../../intl'\nimport CarecenterHeader from \"../carecenter-header\"\nimport Wait from \"../../view/wait\"\n\nimport \"./main-panel.css\"\n\nconst Button = Tfw.View.Button\nconst _ = Tfw.Intl.make(require(\"./main-panel.yaml\"))\n\ninterface IMainPanelProps {\n    className?: string[]\n    carecenters: ICarecenter[]\n    organizations: IOrganization[]\n    structures: IStructure[]\n}\ninterface IMainPanelState { }\n\nexport default class MainPanel extends React.Component<IMainPanelProps, IMainPanelState> {\n    state = {}\n\n    renderCareCenterHeader(organization: IOrganization) {\n        const { carecenters, structures } = this.props\n        const carecentersOfOrganization = carecenters.filter((carecenter: ICarecenter) =>\n            carecenter.organizationId === organization.id)\n        if (carecentersOfOrganization.length === 0) return <Wait />\n\n        return carecentersOfOrganization.map((carecenter: ICarecenter) => (\n            <CarecenterHeader\n                key={carecenter.id}\n                carecenter={carecenter}\n                organization={organization}\n                structures={structures}\n            />))\r\n    }\n\n    render() {\n        const { organizations } = this.props\n        const classes = [\n            'view-MainPanel',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n        return (<div className={classes.join(' ')}>\n            <ul>{organizations.map((organization: IOrganization) => (\n                <li key={organization.id}>{organization.name}<ul>{\n                    this.renderCareCenterHeader(organization)\n                }</ul></li>\n            ))\n            }</ul>\n            <br /><hr /><br />\n            <Button label={Intl.logout} icon=\"logout\" wide={true}\n                onClick={() => window.location.reload()} />\n        </div>)\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\n\nimport { ICarecenter, IOrganization } from \"../../types\"\n\nimport \"./page-header.css\"\n\nconst Icon = Tfw.View.Icon\n\nexport interface IPageHeaderProps {\n    className?: string[]\n    organization: IOrganization\n    carecenter: ICarecenter\n    label: string\n    icon?: string\n    children: JSX.Element | JSX.Element[]\n}\ninterface IPageHeaderState { }\n\nexport default class PageHeader extends React.Component<IPageHeaderProps, IPageHeaderState> {\n    state = {}\n\n    render() {\n        const { organization, carecenter, label, icon, children } = this.props\n        const classes = [\n            'view-PageHeader', 'thm-bg0', 'thm-ele-nav',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n\n        return (<div className={classes.join(' ')}>\n            <header className=\"thm-bgPD\">\n                <div className=\"thm-bgPL\">\n                    {icon && <Icon content={icon} />}\n                    <div className=\"label\">{label}</div>\n                </div>\n                <div>{organization.name} / {carecenter.name}</div>\n            </header>\n            <section>{children}</section>\n        </div>)\n    }\n}\n","import { connect } from 'react-redux'\nimport { IState } from \"../../types\"\nimport State from '../../state'\nimport View from \"../../view/page-header\"\nimport { IPageHeaderProps } from \"../../view/page-header\"\n\nfunction mapStateToProps(state: IState) {\n    const props: Partial<IPageHeaderProps> = {\n        organization: state.current.organization,\n        carecenter: state.current.carecenter\n    }\n    return props\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        // onClick: ...\n    };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(View)\n","import Tfw from 'tfw'\nimport { IPatient } from \"../types\"\n\nconst WebService = Tfw.WebService\nconst castString = Tfw.Converter.String\nconst castInteger = Tfw.Converter.Integer\n\nconst SEPARATORS = [\" \", \"-\", \"'\"]\n\ninterface IServiceResult {\n    name: string\n    list: Array<{ [key: string]: string }>\n}\n\n// [id, time, key, value]\ntype IConsultationsServiceReturn = Array<[number, number, string, string]>\n\nexport interface IConsultation {\n    id: number\n    date: Date\n    fields: { [key: string]: string }\n}\n\nexport default {\n    async list(carecenterId: number): Promise<IPatient[]> {\n        const result: IServiceResult = await WebService.exec(\n            \"carecenter.listPatients\", carecenterId)\n        const patients: IPatient[] = result.list.map(p => ({\n            id: castInteger(p.id),\n            key: castString(p.key, \"\"),\n            firstName: capitalize(castString(p['#PATIENT-FIRSTNAME'], \"\").trim(), SEPARATORS),\n            secondName: capitalize(castString(p['#PATIENT-SECONDNAME'], \"\").trim(), SEPARATORS),\n            lastName: castString(p['#PATIENT-LASTNAME'], \"\").trim().toUpperCase(),\n            country: castString(p['#PATIENT-COUNTRY'], \"\"),\n            sex: castSex(p['#PATIENT-GENDER']),\n            size: castInteger(p['#PATIENT-SIZE'])\n        }))\n        patients.sort((p1: IPatient, p2: IPatient) => {\n            const ln1 = p1.lastName.trim().toUpperCase()\n            const ln2 = p2.lastName.trim().toUpperCase()\n            if (ln1 < ln2) return -1\n            if (ln1 > ln2) return +1\n            const fn1 = `${p1.firstName} / ${p1.secondName}`.trim().toUpperCase()\n            const fn2 = `${p2.firstName} / ${p1.secondName}`.trim().toUpperCase()\n            if (fn1 < fn2) return -1\n            if (fn1 > fn2) return +1\n            return 0\n        })\n        return patients\n    },\n\n    async consultations(patientId: number): Promise<IConsultation[]> {\n        const result: IConsultationsServiceReturn = await WebService.exec(\n            \"patient.listConsultations\", patientId)\n\n        const consultations: IConsultation[] = []\n        let currentConsultation: IConsultation = {\n            id: 0,\n            date: new Date(),\n            fields: {}\n        }\n        let lastId = 0\n        for (const row of result) {\n            const [id, time, key, value] = row\n            if (lastId !== id) {\n                currentConsultation = {\n                    id,\n                    date: new Date(time * 1000),\n                    fields: {}\n                }\n                consultations.push(currentConsultation)\n                lastId = id\n            }\n            currentConsultation.fields[key] = value\n        }\n        return consultations\n    }\n}\n\n\nfunction castSex(sex: any) {\n    switch (castString(sex, \"\")) {\n        case '#H': return \"M\"\n        case '#F': return \"F\"\n        default: return \"?\"\n    }\n}\n\n\nfunction capitalize(text: string, separators: string[] = []): string {\n    if (separators.length === 0) {\n        const trimedText = text.trim().toLowerCase()\n        return `${trimedText.charAt(0).toUpperCase()}${trimedText.substr(1)}`\n    }\n    const nextSeparators = separators.slice(1)\n    const sep = separators[0]\n    return text.trim()\n        .split(sep)\n        .map(child => capitalize(child, nextSeparators))\n        .join(sep)\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\n\nimport { IPatient } from '../../types'\n\nimport \"./patient-button.css\"\n\nconst Touchable = Tfw.View.Touchable\n//const _ = Tfw.Intl.make(require(\"./patient-button.yaml\"))\n\ninterface IPatientButtonProps {\n    className?: string[]\n    patient: IPatient\n    onClick(patient: IPatient): void\n}\ninterface IPatientButtonState { }\n\nexport default class PatientButton extends React.Component<IPatientButtonProps, IPatientButtonState> {\n    state = {}\n\n    render() {\n        const { patient, onClick } = this.props\n        const classes = [\n            'view-PatientButton', 'thm-bg2',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n\n        return (<Touchable className={classes.join(' ')} onClick={() => onClick(patient)}>\n            <div className=\"lastName\">{patient.lastName}</div>\n            <div className=\"firstName\">{patient.firstName}</div>\n            <div className=\"secondName\">{patient.secondName}</div>\n        </Touchable>)\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport StructureManager from '../../structure'\nimport { IStructure, IConsultation } from \"../../types\"\n\nimport \"./consultation-viewer.css\"\n\ninterface IConsultationViewerProps {\n    className?: string\n    structureData: IStructure,\n    consultationData: IConsultation\n}\ninterface IConsultationViewerState { }\n\nexport default class ConsultationViewer extends React.Component<IConsultationViewerProps, IConsultationViewerState> {\n    state = {}\n\n    render() {\n        const classes = [\n            'view-ConsultationViewer',\n            Tfw.Converter.String(this.props.className, '')\n        ]\n        const { consultationData, structureData } = this.props\n        console.info(\"consultationData=\", consultationData)\n\n        return (<div className={classes.join(' ')}>\n            <ul>\n                {\n                    Object.keys(consultationData.fields).map(\n                        key => {\n                            const val = consultationData.fields[key]\n                            const caption = StructureManager.getFieldCaption(\n                                key, structureData\n                            )\n                            return <li key={`field-${key}`}>\n                                <span className=\"key\">{caption}</span>\n                                <span>: </span>\n                                <span className=\"val\">{val}</span>\n                            </li>\n                        }\n                    )\n                }\n            </ul>\n        </div>)\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\n\nimport \"./info.css\"\n\ninterface IInfoProps {\n    className?: string\n    label: string\n    children: JSX.Element | string\n}\ninterface IInfoState { }\n\nexport default class Info extends React.Component<IInfoProps, IInfoState> {\n    state = {}\n\n    render() {\n        const { children } = this.props\n        if (!children) return null\n        if (typeof children === 'string' && children.trim().length === 0) return null\n\n        const classes = [\n            'view-Info',\n            Tfw.Converter.String(this.props.className, \"\")\n        ]\n\n        return (<div className={classes.join(' ')}>\n            <div className=\"label\">{this.props.label}</div>\n            <div>{children}</div>\n        </div>)\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport PageHeader from '../../../container/page-header'\nimport I from '../../../intl'\nimport { IPatient, ICarecenter } from '../../../types'\nimport PatientService, { IConsultation as IConsultationHeader } from '../../../service/patient'\nimport ConsultationService from '../../../service/consultation'\nimport StructureManager from '../../../structure'\nimport PatientButton from '../../patient-button'\nimport ConsultationViewer from '../../consultation-viewer'\nimport Info from '../../info'\n\nimport PlaceholderImage from './placeholder.jpg'\nimport \"./patients.css\"\n\nconst Button = Tfw.View.Button\nconst Expand = Tfw.View.Expand\nconst Input = Tfw.View.Input\nconst List = Tfw.View.List\n\ninterface IPatientsProps {\n    className?: string[]\n    carecenter: ICarecenter\n}\ninterface IPatientsState {\n    patients: IPatient[]\n    filter: string\n    page: string\n    patient?: IPatient\n    consultations: IConsultationHeader[]\n}\n\nexport default class Patients extends React.Component<IPatientsProps, IPatientsState> {\n    state: IPatientsState = {\n        patients: [],\n        filter: \"daline\",\n        page: \"list\",\n        consultations: []\n    }\n\n    async componentDidMount() {\n        const patients = await PatientService.list(this.props.carecenter.id)\n        this.setState({ patients })\n    }\n\n    private handlePatientClick = async (patient: IPatient) => {\n        this.setState({ patient, consultations: [] })\n        const consultations = await PatientService.consultations(patient.id)\n        this.setState({ consultations })\n    }\n\n    renderPatient = (patient: IPatient) => <PatientButton\n        patient={patient}\n        onClick={this.handlePatientClick}\n    />\n\n    renderConsulation = (consultationData: IConsultationHeader, index: number) => {\n        const structureData = StructureManager.getCurrentStructure()\n        if (!structureData) return null\n        return (\n            <Expand\n                key={`consultation-${consultationData.id}`}\n                value={index === 0}\n                label={consultationData.date.toLocaleString()}\n            >\n                <ConsultationViewer\n                    consultationData={consultationData}\n                    structureData={structureData}\n                />\n            </Expand>\n        )\n    }\n\n    render() {\n        const { patients, patient, filter, consultations } = this.state\n        const classes = [\n            'view-pages-Patients',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n        const filteredPatients = patients\n            .filter((patient: IPatient) => {\n                const trimedFilter = filter.trim().toLowerCase()\n                if (trimedFilter.length === 0) return true\n                const name = `${patient.lastName.toLowerCase()} ${patient.firstName.toLowerCase()} ${patient.secondName.toLowerCase()}`\n                return name.indexOf(trimedFilter) !== -1\n            })\n\n        return (<div className={classes.join(' ')}>\n            <PageHeader key=\"list\" label={I.buttonPatient} icon=\"user\">\n                <div className=\"view-pages-Patients-list\">\n                    <div className=\"list\">\n                        <Input\n                            wide={true}\n                            label={\n                                `${I.filter} ${\n                                filteredPatients.length\n                                } / ${\n                                patients.length\n                                }`}\n                            value={filter}\n                            onChange={filter => this.setState({ filter })} />\n                        <List\n                            className=\"patients-list\"\n                            placeholder={PlaceholderImage}\n                            itemHeight={48}\n                            items={filteredPatients}\n                            mapper={this.renderPatient}\n                        />\n                    </div>\n                    {\n                        patient &&\n                        <div className=\"detail thm-bg1\">\n                            <header className=\"thm-bgPD\">\n                                <Info label={I.lastName}>{patient.lastName}</Info>\n                                <Info label={I.firstName}>{patient.firstName}</Info>\n                                <Info label={I.secondName}>{patient.secondName}</Info>\n                                <Info label={I.gender}>{I.genderValue(patient.sex)}</Info>\n                                <Info label={I.size}>{`${patient.size} cm`}</Info>\n                                <Info label={I.identifier}>{patient.key}</Info>\n                            </header>\n                            <section>\n                                {\n                                    consultations.map(this.renderConsulation)\n                                }\n                            </section>\n                        </div>\n                    }\n                </div>\n            </PageHeader>\n        </div>)\n    }\n}\n","import { connect } from 'react-redux'\nimport { IState } from \"../../../types\"\nimport State from '../../../state'\nimport View from \"../../../view/pages/patients\"\n\nfunction mapStateToProps(state: IState) {\n    return {\n        carecenter: state.current.carecenter\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        // onClick: ...\n    };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(View)\n","import React from \"react\"\nimport Tfw from 'tfw'\n\nimport \"./section.css\"\n\nconst Icon = Tfw.View.Icon\nconst Touchable = Tfw.View.Touchable\nconst Storage = new Tfw.Storage.PrefixedLocalStorage('web-soins/view/section')\nconst castString = Tfw.Converter.String\nconst castBoolean = Tfw.Converter.Boolean\n\ninterface ISectionProps {\n    className?: string[]\n    label: string\n    // Default expand value.\n    default?: boolean\n    // Default to \"thm-bg1\"\n    background?: string\n    // If defined string, expanded state will be stored in local storage\n    // with this key.\n    storage?: string\n    children: JSX.Element\n}\ninterface ISectionState {\n    expanded: boolean\n}\n\nexport default class Section extends React.Component<ISectionProps, ISectionState> {\n    state = {\n        expanded: this.props.storage ?\n            Storage.get(this.props.storage, castBoolean(this.props.default, true)) : \n            castBoolean(this.props.default, true)\n    }\n\n    handleClick = () => {\n        const expanded = !this.state.expanded\n        const { storage } = this.props\n        if (storage) {\n            Storage.set(storage, expanded)\n        }\n        this.setState({ expanded })\n    }\n\n    render() {\n        const { label, children, background } = this.props\n        const classes = [\n            'view-Section', castString(background, 'thm-bg1'),\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n        const { expanded } = this.state\n        if (expanded) classes.push(\"expanded\")\n\n        return (<div className={classes.join(' ')}>\n            <Touchable className=\"header thm-bgPL thm-ele-button\" onClick={this.handleClick}>\n                <Icon content=\"tri-right\" rotate={expanded ? 90 : 0}/>\n                <div>{label}</div>\n            </Touchable>\n            <div className=\"body\">{children}</div>\n        </div>)\n    }\n}\n","/**\n * @export {function} .tokenize\n * @param {string} source - Stringification of a permissive JSON object.\n * @return {array} Array of tokens. A token is an object like this: `{}`.\n */\nconst OBJ_OPEN = 1;\nconst OBJ_CLOSE = 2;\nconst ARR_OPEN = 3;\nconst ARR_CLOSE = 4;\nconst STRING = 5;\nconst NUMBER = 6;\nconst SPECIAL = 7;  // true, false, null or undefined.\nconst COLON = 8;\n\nconst TYPE_NAMES = [\n    \"???\",\n    \"OBJ_OPEN\", \"OBJ_CLOSE\", \"ARR_OPEN\", \"ARR_CLOSE\",\n    \"STRING\", \"NUMBER\", \"SPECIAL\", \"COLON\"\n];\n\nexport default {\n    OBJ_OPEN,\n    OBJ_CLOSE,\n    ARR_OPEN,\n    ARR_CLOSE,\n    STRING,\n    NUMBER,\n    SPECIAL,  // true, false, null or undefined.\n    COLON,\n    tokenize(source: string) {\n        const ctx = new Context();\n        return ctx.tokenize(source);\n    },\n    getTypeName: function(type: string) { return TYPE_NAMES[type]; }\n};\n\nconst RX_DECIMAL = /^-?(\\.[0-9]+|[0-9]+(\\.[0-9]+)?)([eE]-?[0-9]+)?$/;\nconst RX_HEXA = /^-?0x[0-9a-f]+$/i;\nconst RX_OCTAL = /^-?0o[0-7]+$/i;\nconst RX_BINARY = /^-?0b[01]+$/i;\n\ninterface IToken {\n    type: number,\n    index: number,\n    value: string | number\n}\n\n\nclass Context {\n    private readonly eaters: (() => void)[]\n    private source: string = ''\n    private index: number = 0\n    private end: number = 0\n    private tokens: IToken[] = []\n\n    constructor() {\n        this.eaters = [\n            this.eatBlanks,\n            this.eatSymbol,\n            this.eatComment,\n            this.eatString,\n            this.eatIdentifier\n        ];\n    }\n\n    tokenize(source: string) {\n        this.source = source;\n        this.end = source.length;\n        this.index = 0;\n        this.tokens = [];\n\n        while (this.index < this.end) {\n            const currentSourceIndex = this.index;\n            for (let eaterIndex = 0; eaterIndex < this.eaters.length; eaterIndex++) {\n                const eater = this.eaters[eaterIndex];\n                eater();\n                if (this.index !== currentSourceIndex) break;\n            }\n            if (this.index === currentSourceIndex) {\n                // No eater has been pleased with this char.\n                this.fail(`Unexpected token at pos ${this.index}:\\n${source.substr(this.index, 80)}`);\n            }\n        }\n\n        return this.tokens;\n    }\n\n    fail(msg: string) {\n        if (typeof msg === 'undefined') msg = \"Invalid char at \" + this.index + \"!\"\n\n        throw { index: this.index, source: this.source, message: msg }\n    }\n\n    eos() {\n        return this.index >= this.end\n    }\n\n    peek() {\n        return this.eos() ? null : this.source[this.index];\n    }\n\n    next() {\n        return this.eos() ? null : this.source[this.index++];\n    }\n\n    back() { if (this.index > 0) this.index--; };\n\n    addToken(type: number, index: number = -1, value: any = '') {\n        if (index === -1) index = this.index;\n        this.tokens.push({ type, index, value })\n    }\n\n    eatBlanks = () => {\n        while (\" \\t\\n\\r\".indexOf(this.peek() || '?') !== -1) this.index++;\n    }\n\n    eatSymbol = () => {\n        let tkn = null;\n        const c = this.peek();\n        switch (c) {\n            case '{': tkn = OBJ_OPEN; break;\n            case '}': tkn = OBJ_CLOSE; break;\n            case '[': tkn = ARR_OPEN; break;\n            case ']': tkn = ARR_CLOSE; break;\n            case ':': tkn = COLON; break;\n            case ',':\n            // The comma is not mandatory.\n            this.index++;\n            return;\n        }\n        if (tkn) {\n            this.addToken(tkn);\n            this.index++;\n        }\n    }\n\n    eatComment = () => {\n        if (this.peek() !== '/') return;\n        this.index++;\n        const c = this.next();\n        if (c == '/') {\n            // Single line comment.\n            const endOfSingleComment = this.source.indexOf('\\n', this.index);\n            if (endOfSingleComment === -1) {\n                this.index = this.end;\n            } else {\n                this.index = endOfSingleComment + 1;\n            }\n        }\n        else if (c == '*') {\n            // Multi line comment.\n            const endOfComment = this.source.indexOf('*/', this.index);\n            if (endOfComment === -1) {\n                this.index = this.end;\n            } else {\n                this.index = endOfComment + 1;\n            }\n        }\n        else {\n            this.fail(\"'/' looks like a comment, but it is not!\");\n        }\n    }\n\n    eatString = () => {\n        const start = this.index;\n        const quote = this.peek();\n        if (quote !== '\"' && quote !== \"'\") return;\n        this.index++;\n        let escape = false;\n        let str = '';\n        while (!this.eos()) {\n            let c = this.next();\n            if (escape) {\n                escape = false;\n                if (c === 'n') c = '\\n';\n                else if (c === 'r') c = '\\r';\n                else if (c === 't') c = '\\t';\n                str += c;\n            }\n            else if (c === \"\\\\\") {\n                escape = true;\n            }\n            else if (c === quote) {\n                this.addToken(STRING, start, str);\n                return;\n            }\n            else {\n                str += c;\n            }\n        }\n        this.index = start;\n        this.fail(\"Missing en of string\");\n    }\n\n    eatIdentifier = () => {\n        const start = this.index;\n        let c = this.peek() || '?';\n        if (\" \\t\\n\\r,:[]{}/\".indexOf(c) !== -1) return;\n        this.index++;\n        let str: string | null | undefined | boolean = c;\n        while (!this.eos()) {\n            c = this.peek() || '?';\n            if (\" \\t\\n\\r,:[]{}/\".indexOf(c) !== -1) break;\n            str += c;\n            this.index++;\n        }\n        if (RX_DECIMAL.test(str)) {\n            this.addToken(NUMBER, start, parseFloat(str));\n        }\n        else if (RX_HEXA.test(str)) {\n            this.addToken(NUMBER, start, parseInt(str, 16));\n        }\n        else if (RX_OCTAL.test(str)) {\n            if (str.charAt(0) == '-') {\n                str = \"-\" + str.substr(3);\n            } else {\n                str = str.substr(2);\n            }\n            this.addToken(NUMBER, start, parseInt(str, 8));\n        }\n        else if (RX_BINARY.test(str)) {\n            if (str.charAt(0) == '-') {\n                str = \"-\" + str.substr(3);\n            } else {\n                str = str.substr(2);\n            }\n            this.addToken(NUMBER, start, parseInt(str, 2));\n        }\n        else {\n            let type = SPECIAL;\n            if (str === 'null') str = null;\n            else if (str === 'undefined') str = undefined;\n            else if (str === 'true') str = true;\n            else if (str === 'false') str = false;\n            else type = STRING;\n            this.addToken(type, start, str);\n        }\n    }\n}\n","import Tokenizer from \"./tokenizer\"\n\nexport default { parse, isValid }\n\nfunction isValid(text: string) {\n    try {\n        parse(text)\n        return true\n    }\n    catch(ex) {\n        return false\n    }\n}\n\nfunction parse(text: string) {\n    try {\n        const tokens = Tokenizer.tokenize(text);\n        const parser = new Parser(tokens);\n        const result = parser.parse();\n        return result;\n    }\n    catch (ex) {\n        if (typeof ex.type === 'number') {\n            throw ex;\n        } else {\n            throw ex;\n        }\n    }\n};\n\n\ninterface IToken {\n    index: number,\n    type: number,\n    value: any\n}\n\n\nclass Parser {\n    private index = 0\n\n    constructor(private tokens: IToken[]) {}\n\n    peek() {\n        return this.tokens[this.index];\n    }\n\n    next() {\n        return this.tokens[this.index++];\n    }\n\n    back() {\n        this.index = Math.max(0, this.index - 1);\n    }\n\n    parse(): any {\n        var tkn = this.next();\n\n        switch (tkn.type) {\n            case Tokenizer.OBJ_OPEN:\n                return this.parseObject();\n            case Tokenizer.ARR_OPEN:\n                return this.parseArray();\n            case Tokenizer.STRING:\n            case Tokenizer.NUMBER:\n            case Tokenizer.SPECIAL:\n                return tkn.value;\n        }\n        this.back();\n        throw this.fail(tkn);\n    }\n\n    parseArray() {\n        var start = this.index;\n        var arr = [];\n        var tkn;\n        while (undefined !== (tkn = this.peek())) {\n            if (tkn.type === Tokenizer.ARR_CLOSE) {\n                this.next();\n                return arr;\n            }\n            arr.push(this.parse());\n        }\n        throw this.fail(`Opening braket at position ${start} has no corresponding closing one!`, start);\n    }\n\n    parseObject() {\n        let start = this.index;\n        const obj: any = {};\n        let tkn;\n        let indexForMissingKey = 0;\n        while (undefined !== (tkn = this.peek())) {\n            if (tkn.type === Tokenizer.OBJ_CLOSE) {\n                this.next();\n                return obj;\n            }\n            const key = this.parse();\n            tkn = this.peek();\n            if (tkn.type === Tokenizer.OBJ_CLOSE) {\n                obj[indexForMissingKey++] = key;\n                this.next();\n                return obj;\n            }\n            else if (tkn.type === Tokenizer.COLON) {\n                this.next();\n                const val = this.parse();\n                obj[key] = val;\n            }\n            else {\n                // Missing key.\n                obj[indexForMissingKey++] = key;\n            }\n        }\n        throw this.fail(\"Opening brace at position \" + start + \" has no corresponding closing one!\", start);\n    }\n\n    fail(tkn: IToken | string, index: number = -1) {\n        if (index < 0) index = this.index\n        if (typeof tkn === 'string') {\n            return { message: tkn, index: index };\n        }\n        return {\n            index: tkn.index,\n            message: \"Unexpected token \" + Tokenizer.getTypeName(tkn.type) + \" at position \" + tkn.index + \"!\"\n        };\n    }\n}\n","export default {\n    padNumber(value: number, size: number = 6, fillWith: string = '0'): string {\n        let text = `${value}`;\n        while (text.length < size) {\n            text = fillWith.charAt(0) + text;\n        }\n        return text;\n    },\n\n    clamp(value: number, min: number = 0, max: number = 1) {\n        if (value < min) return min;\n        if (value > max) return max;\n        return value;\n    },\n\n    loadTextFromFile(file: File): Promise<string> {\n        return new Promise((resolve, reject) => {\n            const reader: FileReader = new FileReader();\n            reader.onload = (data) => {\n                const content = `${data.target.result}`;\n                resolve(content);\n            };\n            reader.onerror = (err) => {\n                reject(err);\n            };\n            reader.readAsText(file);\n        })\n    },\n\n    loadTextFromURL(url: string): Promise<string> {\n        return new Promise((resolve, reject) => {\n            fetch(url)\n                .then((response: Response) => {\n                    if (!response.ok) {\n                        reject(`Error ${response.status}: ${response.statusText}!`);\n                    }\n                    return response.text();\n                })\n                .then(resolve)\n                .catch(reject);\n        });\n    },\n\n    loadJsonFromURL(url: string): Promise<any> {\n        return new Promise((resolve, reject) => {\n            fetch(url)\n                .then((response: Response) => {\n                    return response.json();\n                })\n                .then(resolve)\n                .catch(reject);\n        });\n    }\n}\n","import React from \"react\"\r\nimport Button from \"../button\"\r\n\r\nimport \"./input-file.css\"\r\n\r\ninterface IInputFileProps {\r\n    label?: string;\r\n    icon?: string;\r\n    wide?: boolean;\r\n    wait?: boolean;\r\n    flat?: boolean;\r\n    small?: boolean;\r\n    warning?: boolean;\r\n    enabled?: boolean;\r\n    multiple?: boolean;\r\n    accept?: string;  // Ex.: \"image/png,image/jpeg\", \".png,.jpg\", \"image/*\", ... See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#Unique_file_type_specifiers\r\n    classes?: string[] | string;\r\n    onClick?: (files: FileList) => void;\r\n}\r\n\r\nexport default class InputFile extends React.Component<IInputFileProps, {}> {\r\n    private readonly refInput: React.RefObject<HTMLInputElement> = React.createRef();\r\n\r\n    constructor( props: IInputFileProps ) {\r\n        super( props );\r\n        this.handleClick = this.handleClick.bind( this );\r\n        this.handleFileChange = this.handleFileChange.bind( this );\r\n    }\r\n\r\n    static readFileAsText(file: File): Promise<string> {\r\n        return new Promise((resolve, reject) => {\r\n            const reader: FileReader = new FileReader();\r\n            reader.onload = (data) => {\r\n                const content = data.target.result;\r\n                resolve(content);\r\n            };\r\n            reader.onerror = (err) => {\r\n                reject(err);\r\n            };\r\n            reader.readAsText(file);\r\n        })\r\n    }\r\n\r\n    handleFileChange(evt: React.ChangeEvent<HTMLInputElement>) {\r\n        if( !evt.target ) return;\r\n\r\n        const handler = this.props.onClick;\r\n        if (typeof handler !== 'function') return;\r\n\r\n        try {\r\n            const input = evt.target as HTMLInputElement;\r\n            const files = input.files;\r\n            if( !files ) return;\r\n            handler(files);\r\n        } catch(ex) {\r\n            console.error(\"Error in handleFileChange(): \", );\r\n            console.error(ex);\r\n        }\r\n    }\r\n\r\n    handleClick() {\r\n        const input = this.refInput.current;\r\n        if( !input ) return;\r\n        input.click();\r\n    }\r\n\r\n    render() {\r\n        const p = this.props;\r\n        const classes = [\"tfw-view-InputFile\"];\r\n        if( p.wide === true ) classes.push(\"wide\");\r\n\r\n        return (<div className={classes.join(\" \")}>\r\n            <Button\r\n                label={p.label}\r\n                icon={p.icon}\r\n                wide={p.wide}\r\n                wait={p.wait}\r\n                flat={p.flat}\r\n                small={p.small}\r\n                warning={p.warning}\r\n                enabled={p.enabled}\r\n                classes={p.classes}\r\n                onClick={this.handleClick}/>\r\n            <input\r\n                ref={this.refInput}\r\n                type=\"file\"\r\n                accept={p.accept}\r\n                multiple={p.multiple === true}\r\n                onChange={this.handleFileChange} />\r\n        </div>)\r\n    }\r\n}\r\n","import * as React from \"react\"\nimport castArray from \"../converter/array\"\nimport castBoolean from \"../converter/boolean\"\nimport TouchableBehavior from \"../behavior/touchable\"\nimport \"./touchable.css\"\n\ninterface ITouchableProps {\n    enabled?: boolean;\n    onClick?: ()=>void;\n    title?: string;\n    classNames?: string[];\n    color?: string;\n    children?: React.ReactElement<any>|React.ReactElement<any>[];\n}\n\nexport default class Touchable extends React.Component<ITouchableProps, {}> {\n    readonly touchable: TouchableBehavior;\n    private ref = React.createRef();\n\n    constructor(props: ITouchableProps) {\n        super(props);\n        this.handleClick = this.handleClick.bind(this);\n        this.touchable = new TouchableBehavior({onTap: this.handleClick, color: props.color});\n    }\n\n    componentDidMount() {\n        const element = this.ref.current;\n        if (!element) return;\n        this.touchable.element = element;\n    }\n\n    handleClick() {\n        const handler = this.props.onClick;\n        if( typeof handler === 'function') {\n            handler();\n        }\n    }\n\n    render() {\n        const p = this.props;\n        const enabled = castBoolean(p.enabled, true);\n        const classes = [\"tfw-view-touchable\"].concat(castArray(p.classNames));\n        if( enabled ) classes.push(\"enabled\");\n        return <div ref={this.ref}\n                tabIndex={0}\n                className={classes.join(\" \")}\n                title={p.title}>{\n            p.children\n        }</div>\n    }\n}\n","import React from \"react\"\nimport Icon from '../icon'\nimport Touchable from '../touchable'\n\nimport \"./expand.css\"\n\ninterface IExpandProps {\n    label: string,\n    value: boolean,\n    onValueChange: (value: boolean) => void\n}\n\nexport default class Expand extends React.Component<IExpandProps, {}> {\n    handleValueChange = () => {\n        this.props.onValueChange(!this.props.value)\n    }\n\n    render() {\n        const classes = [\"tfw-view-Expand\"]\n        if (this.props.value) {\n            classes.push(\"expand\")\n        }\n\n        return (<div className={classes.join(' ')}>\n            <Touchable classNames={[\"head\"]} onClick={this.handleValueChange}>\n                <div className=\"icons\">\n                    <Icon content=\"plus-o\" size={24}/>\n                    <Icon content=\"minus-o\" size={24}/>\n                </div>\n                <div>{this.props.label}</div>\n            </Touchable>\n            <div className=\"body\">{\n                this.props.children\n            }</div>\n        </div>)\n    }\n}\n","type Action = (...args: any[]) => void;\r\n\r\n/**\r\n * The function to call as much as you want. It will perform the debouce for you.\r\n * Put in the same args as the `action` function.\r\n *\r\n * * action -  Action to call. Two consecutive actions cannot be  called if there is\r\n * less than `delay` ms between them.\r\n * * delay - Number of milliseconds.\r\n */\r\nexport default function (action: Action, delay: number): Action {\r\n    let timer: number = 0;\r\n\r\n    return function(this: { delay: number }, ...args: any[]) {\r\n        if (timer) window.clearTimeout(timer);\r\n        timer = window.setTimeout(() => {\r\n            timer = 0;\r\n            action(...args);\r\n        }, delay) as number;\r\n    }\r\n}\r\n","import * as React from \"react\"\nimport \"../theme.css\"\nimport \"./input-date.css\"\nimport castInteger from \"../converter/integer\"\nimport castBoolean from \"../converter/boolean\"\nimport castString from \"../converter/string\"\nimport Debouncer from \"../debouncer\"\n\nimport Intl from \"../intl\"\nconst _ = Intl.make(require(\"./input-date.yaml\"));\n\ninterface INumberSlot {\n    (value: number): void;\n}\n\ninterface IInputProps {\n    label?: string;\n    value?: number;\n    wide?: boolean;\n    focus?: boolean;\n    onChange?: INumberSlot\n}\n\ninterface IInputState {\n    error?: string;\n}\n\nexport default class Input extends React.Component<IInputProps, IInputState> {\n    readonly inputDay: React.RefObject<HTMLInputElement>;\n    readonly inputMonth: React.RefObject<HTMLSelectElement>;\n    readonly inputYear: React.RefObject<HTMLInputElement>;\n\n    constructor(props: IInputProps) {\n        super(props);\n        this.state = {};\n        this.handleChange = Debouncer(this.handleChange.bind(this), 300);\n        this.inputDay = React.createRef();\n        this.inputMonth = React.createRef();\n        this.inputYear = React.createRef();\n    }\n\n    handleChange(): void {\n        try {\n            const day = parseInt(this.inputDay.current.value);\n            if (isNaN(day)) throw \"day is not a number!\";\n            const month = parseInt(this.inputMonth.current.value);\n            if (isNaN(month)) throw \"month is not a number!\";\n            const year = parseInt(this.inputYear.current.value);\n            if (isNaN(year)) throw \"year is not a number!\";\n\n            const date = new Date(year, month, day);\n            if (date.getFullYear() !== year || date.getMonth() !== month || date.getDate() !== day) {\n                throw \"Invalid date!\";\n            }\n            this.setState({ error: \"\" });\n\n            const handler = this.props.onChange;\n            if (typeof handler !== 'function') return;\n            handler(date.getTime());\n        }\n        catch (ex) {\n            this.setState({ error: _(\"invalid\") });\n        }\n    }\n\n    render() {\n        const\n            p = this.props,\n            label = castString(p.label, \"\"),\n            value = castInteger(p.value, 0),\n            wide = castBoolean(p.wide, false),\n            error = castString(this.state.error, \"\"),\n            date = new Date(value),\n            id = nextId();\n        const classes = [\"tfw-view-input-date\", \"thm-ele-button\"];\n        if (wide) classes.push(\"wide\");\n        const header = (error.length > 0 ? <div className=\"thm-bgSD error\">{error}</div> :\n            (label ? (<label htmlFor={id} className=\"thm-bgPD\">{label}</label>) : null));\n        return (<div className={classes.join(\" \")} >\n            {header}\n            <div className=\"inputs\">\n                <input\n                    ref={this.inputDay}\n                    className=\"day\"\n                    type=\"number\"\n                    maxLength=\"2\"\n                    min=\"1\"\n                    max=\"31\"\n                    id={id}\n                    size=\"2\"\n                    onChange={this.handleChange}\n                    defaultValue={date.getDate()} />\n                <select ref={this.inputMonth}\n                    onChange={this.handleChange}\n                    defaultValue={date.getMonth()}>{\n                        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map(monthId => (\n                            <option key={monthId} value={monthId}>{_(`month-${monthId}`)}</option>\n                        ))\n                    }</select>\n                <input\n                    ref={this.inputYear}\n                    className=\"year\"\n                    type=\"number\"\n                    maxLength=\"4\"\n                    size=\"4\"\n                    onChange={this.handleChange}\n                    defaultValue={date.getFullYear()} />\n            </div>\n        </div>);\n    }\n}\n\n\nlet globalId = 0;\nfunction nextId() {\n    return `tfw-view-input-${globalId++}`;\n}\n\n\nconst NUMBER_VALIDATOR = (value: string) => isNaN(parseFloat(value)) ? _('nan') : true;\n","import React from \"react\"\nimport { IFormField, ITypes, IType } from '../types'\nimport Combo from '../tfw/view/combo'\nimport Expand from '../tfw/view/expand'\nimport Checkbox from '../tfw/view/checkbox'\nimport InputDate from '../tfw/view/input-date'\nimport Storage from '../tfw/storage'\n\nimport \"./form-field.css\"\n\ninterface IFormFieldProps {\n    field: IFormField,\n    types: ITypes\n}\n\ninterface IFormFieldState {\n    values: { [key: string]: any }\n}\n\nexport default class FormField extends React.Component<IFormFieldProps, IFormFieldState> {\n    constructor( props: IFormFieldProps ) {\n        super( props );\n        this.state = { values: Storage.local.get(\"web-soins/form-field/values\", {}) }\n    }\n\n    setValue = (key: string, val: any) => {\n        const values = {\n            ...this.state.values,\n            [key]: val\n        }\n\n        Storage.local.set(\"web-soins/form-field/values\", values)\n        this.setState({ values }, () => {\n            console.info(\"key, val, values=\", key, val, values);\n        })\n    }\n\n    render() {\n        return (<div className=\"FormField\">{\n            this.renderField(this.props.field)\n        }</div>)\n    }\n\n    renderField = (field: IFormField): React.ReactNode => {\n        const { id, caption, children } = field\n        if (id.charAt(0) === '#') {\n            return this.renderTypedField(field, this.props.types)\n        }\n        return <Expand  key={id}\n                        label={caption}\n                        value={this.state.values[id]}\n                        onValueChange={(value: boolean) => this.setValue(id, value)}>\n                    <div>{\n                        Object.values(children).map(this.renderField)\n                    }</div>\n                </Expand>\n    }\n\n    renderTypedField(field: IFormField, types: ITypes): React.ReactNode {\n        const { id, caption, tags } = field\n        const typeId = field.type || '?'\n        const type = types[typeId]\n\n        if (!type) {\n            if (Array.isArray(tags)) {\n                if (tags.indexOf(\"@BOOL\")) {\n                    return <Checkbox key={id}\n                                label={`${caption} (${id})`}\n                                value={this.state.values[id]}\n                                onChange={(v: boolean) => this.setValue(id, v)}/>\n                }\n                if (tags.indexOf(\"@DATE\")) {\n                    return <InputDate key={id}\n                                label={`${caption} (${id})`}\n                                value={this.state.values[id]}\n                                onChange={(v: number) => this.setValue(id, v)}/>\n                }\n            }\n            return <pre key={id} className=\"error\">{\n                JSON.stringify(field, null, '  ')\n                + \"\\nTAGS: \" + JSON.stringify(tags)\n            }</pre>\n        }\n\n        return <Combo key={id}\n                    label={`${caption} (${id})`}\n                    value={this.state.values[id]}\n                    onChange={(v: string) => this.setValue(id, v)}>{\n            Object.values(type.children).map((t: IType) => (\n                <div key={t.id}>{t.caption} <em>({t.id})</em></div>\n            ))\n        }</Combo>\n    }\n}\n","import React from \"react\"\n\nimport { IFilter } from \"../../types\"\nimport Button from \"../../tfw/view/button\"\nimport Flex from \"../../tfw/layout/flex\"\nimport InputDate from \"../../tfw/view/input-date\"\nimport PermissiveJSON from '../../tfw/permissive-json'\nimport Storage from \"../../tfw/storage\"\n\nimport \"./consultation-query.css\"\n\nimport Intl from \"../../intl\"\n\ninterface TContainerQueryProps {\n    onQueryClick: (filter: IFilter, dateMin: number, dateMax: number) => void\n}\n\ninterface TContainerQueryState {\n    query: string,\n    valid: boolean,\n    dateMin: number,\n    dateMax: number\n}\n\nexport default class ContainerQuery extends React.Component<TContainerQueryProps, TContainerQueryState> {\n    constructor( props: TContainerQueryProps ) {\n        super(props)\n        this.state = {\n            dateMin: Storage.local.get('web-soins/container-query/dateMin', oneYearBack()),\n            dateMax: Storage.local.get('web-soins/container-query/dateMax', Date.now()),\n            valid: true,\n            query: Storage.local.get('web-soins/container-query/query', `[\n    OR\n    [= #VIH #POSITIVE]\n    [= #DIAGNOSIS-VIH #POSITIVE]\n]`)\n        }\n    }\n\n    private handleQueryChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\n        const target = evt.target\n        if (!target) return\n        const query = target.value as string\n        const valid = PermissiveJSON.isValid(query)\n        this.setState({ query, valid })\n    }\n\n    private handleExecuteClick = () => {\n        const { query, valid, dateMin, dateMax } = this.state\n        if (valid) {\n            Storage.local.set('web-soins/container-query/query', query)\n            const { onQueryClick } = this.props\n            onQueryClick(PermissiveJSON.parse(query), dateMin, dateMax)\n        }\n    }\n\n    private handleDateMinChange = (dateMin: number) => {\n        this.setState({ dateMin })\n    }\n\n    private handleDateMaxChange = (dateMax: number) => {\n        this.setState({ dateMax })\n    }\n\n    render() {\n        const { query, valid, dateMin, dateMax } = this.state\n        const classes = ['presentational-ConsultationQuery']\n\n        return (<div className={classes.join(' ')}>\n            <Flex>\n                <div><InputDate\n                    label={Intl.dateMin()}\n                    onChange={this.handleDateMinChange}\n                    value={dateMin} /></div>\n                <div><InputDate\n                    label={Intl.dateMax()}\n                    onChange={this.handleDateMaxChange}\n                    value={dateMax} /></div>\n            </Flex>\n            <label>{Intl.filter()}</label><br/>\n            <textarea className={valid ? 'valid' : 'invalid'}\n                      rows={15}\n                      onChange={this.handleQueryChange}>{\n                query\n            }</textarea><br/>\n            <Button icon=\"play\" label={Intl.executeQuery()} enabled={valid} onClick={this.handleExecuteClick}/>\n        </div>)\n    }\n}\n\n/**\n * Return a date that is between one and two years old.\n * Then fix the month to January and the day to 1st.\n */\nfunction oneYearBack() {\n    const now = new Date()\n    const date = new Date(\n        now.getFullYear() - 1,\n        0,  // January\n        1\n    )\n    return date.valueOf()\n}\n","import WebService from \"../tfw/web-service\"\nimport { IFilter } from \"../types\"\n\n\nexport default { getConsultationIds, getConsultationsFields }\n\ninterface IConsultationIdsInput {\n    filter: IFilter,\n    minDate: number,\n    maxDate: number\n}\n\nasync function getConsultationIds(args: IConsultationIdsInput) {\n    const ids = await WebService.exec(\"query.consultation\", args)\n    return ids\n}\n\ninterface IConsultationsFieldsOutput {\n    fields: string[],\n    patients: {\n        [key: string /* Patient's key */]: Array<[number, ...string[]]>\n    }\n}\n\nasync function getConsultationsFields(\n    consultationIds: number[]\n): Promise<IConsultationsFieldsOutput> {\n    const output = await WebService.exec(\"consultation.list\", consultationIds)\n    return output\n}\n","import React from \"react\"\nimport SaveAs from 'save-as'\nimport InputFile from '../tfw/view/input-file'\nimport State from '../state'\nimport { IFilter } from '../types'\nimport FormFieldView from '../view/form-field'\nimport ConsultationQuery from '../view/consultation-query'\nimport { IStructure, IFormField, ITypes } from '../types'\nimport QueryService from '../service/query'\nimport Dialog from '../tfw/factory/dialog'\nimport _ from \"../intl\";\n\nimport \"./report-view.css\"\n\ninterface IReportViewProps {\n    carecenter: number,\n    onFilesChange: (files: FileList) => void\n}\n\ninterface IReportViewState {\n    forms: { [key: string]: IFormField },\n    types: ITypes\n}\n\nexport default class ReportView extends React.Component<IReportViewProps, IReportViewState> {\n    constructor( props: IReportViewProps ) {\n        super( props );\n        this.state = { forms: {}, types: {} }\n    }\n\n    componentDidMount() {\n        const { carecenter } = this.props\n        const state = State.store.getState()\n        const structure = state.structures.find((s: IStructure) => s.id === carecenter);\n        if (!structure) return\n        this.setState({\n            forms: structure.forms,\n            types: structure.types\n        })\n    }\n\n    handleFilesChange = (files: FileList) => {\n        this.props.onFilesChange(files)\n    }\n\n    private async queryConsultations(filter: IFilter, minDate: number, maxDate: number) {\n      const ids = await QueryService.getConsultationIds({\n        filter, minDate, maxDate\n      })\n      const result = await QueryService.getConsultationsFields(ids)\n      const header = `\"Patient\",\"Consultation Date \",${result.fields.map(f => `\"${f}\"`).join(',')}`\n      const body = Object.keys(result.patients).map(\n        patientKey => result.patients[patientKey].map(\n          tail => removeSquareBrakets(JSON.stringify([patientKey, convertToDate(tail[0]), ...tail.slice(1)]))\n        ).join(\"\\n\")\n      ).join(\"\\n\")\n      return `${header}\\n${body}`\n    }\n\n    private handleQueryClick = async (filter: IFilter, minDate: number, maxDate: number) => {\n        console.info(\"filter=\", filter);\n        console.info(\"minDate=\", minDate);\n        console.info(\"maxDate=\", maxDate);\n        const csvContent = await Dialog.wait(\n          _('query-in-progress'),\n          this.queryConsultations(filter, minDate, maxDate)\n        )\n        const file = new Blob(\n          [csvContent],\n          { type: 'text/csv;charset=utf-8' }\n        )\n        SaveAs(file, `consultations.${\n          convertToDate(minDate / 1000)\n        }.${\n          convertToDate(maxDate / 1000)\n        }.csv`)\n    }\n\n    render() {\n        const { forms, types } = this.state\n\n        return (<div className=\"report-ReportView\">\n            <div>\n                <InputFile\n                    wide={true}\n                    icon=\"table\"\n                    label=\"Load report template from disk (*.fods)\"\n                    accept=\"fods\"\n                    multiple={true}\n                    onClick={this.handleFilesChange}/>\n                <p dangerouslySetInnerHTML={{\n                    __html: _('hint-report-templates')\n                }}></p>\n                <ul>\n                    <li><code>{'{{newPatients [Y,1,1] [Y,4,1]}}'}</code>: </li>\n                    <li><code>{'{{newPatients [Y,1,1] [Y,4,1] filter:[GENDER #F]}}'}</code>: </li>\n                    <li><code>{'{{newPatients [Y,1,1] [Y,4,1] filter:[age 18 40]}}'}</code>: </li>\n                    <li><code>{'{{visits [Y,1,1] [Y,4,1]}}</code>'}</code>: </li>\n                    <li><code>{'{{visits [Y,1,1] [Y,4,1] filter:{MOTIF-CONSULTATION: #GENITAL-LEAK}}}'}</code>: </li>\n                    <li><code>{'{{visits [Y,1,1] [Y,4,1] group:day}}'}</code>: </li>\n                </ul>\n                <hr/>\n                <ConsultationQuery onQueryClick={this.handleQueryClick} />\n            </div>\n            <div>{\n                Object.values(forms).map((field: IFormField) => (\n                    <FormFieldView key={field.id} types={types} field={field}/>\n                ))\n            }</div>\n        </div>)\n    }\n}\n\n\nfunction removeSquareBrakets(text: string): string {\n  return text.substr(1, text.length - 2)\n}\n\n\nfunction convertToDate(secondsSinceEpoch: number): string {\n  const date = new Date(secondsSinceEpoch * 1000)\n  const yy = date.getFullYear()\n  let mm = `${date.getMonth() + 1}`\n  let dd = `${date.getDate()}`\n  while (mm.length < 2) mm = `0${mm}`\n  while (dd.length < 2) dd = `0${dd}`\n\n  return `${yy}-${mm}-${dd}`\n}\n","import React from \"react\"\n\nimport PermissiveJSON from '../tfw/permissive-json'\nimport FileAPI from '../tfw/fileapi'\nimport Icon from '../tfw/view/icon'\nimport Button from '../tfw/view/button'\nimport Dialog from '../tfw/factory/dialog'\nimport Util from '../tfw/util'\nimport ReportView from './report-view'\nimport WS from '../tfw/web-service'\nimport Intl from \"../intl\";\n\nimport LibreOfficeCalcTemplate from './report.fods'\n\nimport \"./report.css\"\n\nexport default { doGenerate , generate, generateFromTemplate, generateFromUserProvidedFile }\n\n\nasync function generate(extraData: {}) {\n    Dialog.alert(<div className=\"report-icons-container\">\n        <div>\n            <Icon content=\"report\" size={96} onClick={() => generateFromTemplate(extraData)}/>\n            <div>Rapport annuel</div>\n        </div>\n        <div>\n            <Icon content=\"file\" size={96} onClick={() => generateFromUserProvidedFile(extraData)}/>\n            <div><i>Générique...</i></div>\n        </div>\n    </div>)\n}\n\nasync function generateFromTemplate(extraData: {}) {\n    const content = await Dialog.wait(\n        Intl.loadingReport(),\n        Util.loadTextFromURL(LibreOfficeCalcTemplate)\n    )\n    Dialog.wait(Intl.generatingReport(), doGenerate(content, extraData))\n}\n\nfunction generateFromUserProvidedFile(extraData: {}) {\n    const onFilesChange = async (files: FileList) => {\n        for(const file of files) {\n            const content = await Util.loadTextFromFile(file)\n            Dialog.wait(Intl.generatingReport(), doGenerate(content, extraData))\n        }\n        dialog.hide()\n    }\n\n    const dialog = Dialog.show({\n        content: <ReportView\n                    carecenter={extraData.carecenter}\n                    onFilesChange={onFilesChange}/>,\n        footer: <Button label=\"Close\" icon=\"cancel\" onClick={() => dialog.hide()}/>\n    })\n}\n\n\nasync function doGenerate(content: string, extraData: {}) {\n    //const content = await Util.loadTextFromURL(LibreOfficeCalcTemplate)\n    const domParser = new DOMParser();\n    const doc = domParser.parseFromString(content, \"application/xml\");\n    const placeholders: HTMLElement[] = []\n    findPlaceholders(doc.documentElement, placeholders)\n\n    const query = placeholders\n        .map((elem: HTMLElement) => {\n            const content = (elem.textContent || '{}').trim().substr(1)\n            try {\n                return {\n                    ...PermissiveJSON.parse(content.substr(0, content.length - 1)),\n                    ...extraData\n                }\n            }\n            catch (ex) {\n                console.error(ex)\n                console.info(\"elem=\", elem);\n                return { [0]: 'echo', [1]: content }\n            }\n        })\n    console.info(\"query=\", query);\n    const data = await WS.exec(\"report\", query)\n    console.info(\"data=\", data);\n\n    data.forEach((text: string, index: number) => {\n        const elem = placeholders[index]\n        const value = parseFloat(text)\n        elem.textContent = text\n        if (!Number.isNaN(value)) {\n            // We must tell Calc that this content is a number.\n            const parent = elem.parentElement\n            if (!parent) return\n            parent.setAttribute(\"office:value-type\", \"float\")\n            parent.setAttribute(\"calcext:value-type\", \"float\")\n            parent.setAttribute(\"office:value\", text)\n        }\n    })\n\n    const serializer = new XMLSerializer();\n    const xml = serializer.serializeToString(doc);\n\n    await FileAPI.saveAs(new Blob([xml]), \"report.ods\")\n}\n\n\nfunction findPlaceholders(element: HTMLElement, placeholders: HTMLElement[]) {\n    switch (element.nodeType) {\n        case Node.ELEMENT_NODE:\n            if (element.nodeName === 'text:p') {\n                const content = (element.textContent || '').trim()\n                if (content.startsWith('{{') && content.endsWith('}}')) {\n                    placeholders.push(element)\n                }\n            } else {\n                for (const child of element.childNodes) {\n                    findPlaceholders(child, placeholders)\n                }\n            }\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport Report from '../../report'\nimport Intl from '../../intl'\nimport Section from '../section'\nimport \"./counting-reports.css\"\n\nconst Button = Tfw.View.Button\nconst Dialog = Tfw.Factory.Dialog\nconst InputFile = Tfw.View.InputFile\nconst _ = Tfw.Intl.make(require(\"./counting-reports.yaml\"))\n\ninterface ICountingReportsProps {\n    className?: string[]\n}\ninterface ICountingReportsState { }\n\nexport default class CountingReports extends React.Component<ICountingReportsProps, ICountingReportsState> {\n    state = {}\n\n    handleFilesChange = async (files: FileList) => {\n        for (const file of files) {\n            const content = await Tfw.Util.loadTextFromFile(file)\n            Dialog.wait(Intl.generatingReport(), Report.doGenerate(content, {}))\n        }\n    }\n\n    render() {\n        const classes = [\n            'view-CountingReports',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n\n        return (<div className={classes.join(' ')}>\n            <Button\n                label=\"Rapport annuel\"\n                icon=\"report\"\n                onClick={() => Report.generateFromTemplate({})}\n            />\n            <Button\n                label=\"Ajouter un nouveau rapport\"\n                enabled={false}\n                icon=\"add\"\n                warning={true}\n                onClick={() => Report.generateFromUserProvidedFile({})}\n            />\n            <InputFile\n                icon=\"import\"\n                label=\"Importer un fichier\"\n                accept=\"fods\"\n                flat={true}\n                multiple={true}\n                onClick={this.handleFilesChange}\n            />\n            <Section label=\"Documentation\" default={false} background=\"thm-bg2\">\n                <div>\n                    <p dangerouslySetInnerHTML={{\n                        __html: Intl.hintReportTemplates()\n                    }}></p>\n                    <ul>\n                        <li>\n                            <code>{'{{newPatients [Y,1,1] [Y,4,1]}}'}</code>:<br />\n                            <span className=\"hint\">\n                                Nombre de nouveaux patients entre le 1<sup>er</sup> janvier de cette année et le 1<sup>er</sup> avril.\n                    </span>\n                        </li>\n                        <li>\n                            <code>{'{{newPatients [Y,1,1] [Y,4,1] filter:[GENDER #F]}}'}</code>:<br />\n                            <span className=\"hint\">\n                                Nombre de nouveaux patients entre le 1<sup>er</sup> janvier de cette année et le 1<sup>er</sup> avril de sexe féminin.\n                    </span>\n                        </li>\n                        <li>\n                            <code>{'{{newPatients [Y,1,1] [Y,4,1] filter:[age 18 40]}}'}</code>:<br />\n                            <span className=\"hint\">\n                                Nombre de nouveaux patients entre le 1<sup>er</sup> janvier de cette année et le 1<sup>er</sup> avril agée de 18 à 40 ans.\n                    </span>\n                        </li>\n                        <li>\n                            <code>{'{{visits [Y,1,1] [Y,4,1]}}</code>'}</code>:<br />\n                            <span className=\"hint\">\n                                Nombre de consultations entre le 1<sup>er</sup> janvier de cette année et le 1<sup>er</sup> avril.\n                    </span>\n                        </li>\n                        <li>\n                            <code>{'{{visits [Y,1,1] [Y,4,1] filter:{MOTIF-CONSULTATION: #GENITAL-LEAK}}}'}</code>:<br />\n                            <span className=\"hint\">\n                                Nombre de consultations entre le 1<sup>er</sup> janvier de cette année et le 1<sup>er</sup> avril dont le motif de consultation est <b>genital leak</b>.\n                    </span>\n                        </li>\n                        <li>\n                            <code>{'{{visits [Y,1,1] [Y,4,1] group:day}}'}</code>:<br />\n                            <span className=\"hint\">\n                                Nombre de jours de consultations entre le 1<sup>er</sup> janvier de cette année et le 1<sup>er</sup> avril.\n                    </span>\n                        </li>\n                    </ul>\n                </div>\n            </Section>\n        </div>)\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport PageHeader from '../../../container/page-header'\nimport Section from '../../section'\nimport Intl from '../../../intl'\nimport CountingReports from '../../counting-reports'\nimport ConsultationQuery from '../../consultation-query'\n\nimport \"./reports.css\"\n\nconst _ = Tfw.Intl.make(require(\"./reports.yaml\"))\n\ninterface IReportsProps {\n    className?: string[]\n}\ninterface IReportsState {\n}\n\nexport default class Reports extends React.Component<IReportsProps, IReportsState> {\n    state = {}\n\n    private handleQueryClick = () => {\n\n    }\n\n    render() {\n        const classes = [\n            'view-pages-Reports',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n\n        return (<div className={classes.join(' ')}>\n            <PageHeader label={Intl.buttonReports()} icon=\"report\">\n                <Section label={Intl.countingReports()} storage=\"counting-reports\">\n                    <CountingReports />\n                </Section>\n                <Section label={Intl.extractions()} storage=\"extractions\">\n                    <ConsultationQuery onQueryClick={this.handleQueryClick} />\n                </Section>\n            </PageHeader>\n        </div>)\n    }\n}\n","import { connect } from 'react-redux'\nimport { IState } from \"../../../types\"\nimport State from '../../../state'\nimport View from \"../../../view/pages/reports\"\n\nfunction mapStateToProps(state: IState) {\n    return {\n        carecenter: state.current.carecenter\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        // onClick: ...\n    };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(View)\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport PageHeader from '../../../container/page-header'\nimport Intl from '../../../intl'\n\nimport \"./stats.css\"\n\nconst Button = Tfw.View.Button\nconst _ = Tfw.Intl.make(require(\"./stats.yaml\"))\n\ninterface IStatsProps {\n    className?: string[]\n}\ninterface IStatsState { }\n\nexport default class Stats extends React.Component<IStatsProps, IStatsState> {\n    state = {}\n\n    render() {\n        const classes = [\n            'view-pages-Stats',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n\n        return (<div className={classes.join(' ')}>\n            <PageHeader label={Intl.buttonStats()} icon=\"stat\" />\n        </div>)\n    }\n}\n","import { connect } from 'react-redux'\nimport { IState } from \"../../../types\"\nimport State from '../../../state'\nimport View from \"../../../view/pages/stats\"\n\nfunction mapStateToProps(state: IState) {\n    return {\n        carecenter: state.current.carecenter\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        // onClick: ...\n    };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(View)\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport PageHeader from '../../../container/page-header'\nimport Intl from '../../../intl'\n\nimport \"./struct.css\"\n\nconst Button = Tfw.View.Button\nconst _ = Tfw.Intl.make(require(\"./struct.yaml\"))\n\ninterface IStructProps {\n    className?: string[]\n}\ninterface IStructState {}\n\nexport default class Struct extends React.Component<IStructProps, IStructState> {\n    state = {}\n\n    render() {\n        const classes = [\n            'view-pages-Struct',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n\n        return (<div className={classes.join(' ')}>\n            <PageHeader label={Intl.buttonStruct()} icon=\"sitemap\" />\n        </div>)\n    }\n}\n","import { connect } from 'react-redux'\nimport { IState } from \"../../../types\"\nimport State from '../../../state'\nimport View from \"../../../view/pages/struct\"\n\nfunction mapStateToProps(state: IState) {\n    return {\n        carecenter: state.current.carecenter\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        // onClick: ...\n    };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(View)\n","import React from \"react\"\nimport Tfw from 'tfw'\n\nimport Logo from \"./welcome.svg\"\n\nimport \"./welcome.css\"\n\ninterface IWelcomeProps {\n    className?: string[]\n}\ninterface IWelcomeState {\n    loaded: boolean\n}\n\nexport default class Welcome extends React.Component<IWelcomeProps, IWelcomeState> {\n    private refDiv = React.createRef<HTMLDivElement>()\n\n    state = {\n        loaded: false\n    }\n\n    async componentDidMount() {\n        const svg = await Tfw.Util.loadTextFromURL(Logo)\n        const div = this.refDiv.current\n        if (!div) return\n        div.innerHTML = svg\n        this.setState({ loaded: true })\n    }\n\n    render() {\n        const classes = [\n            'view-pages-Welcome',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n        if (this.state.loaded) classes.push(\"loaded\")\n\n        return <div ref={this.refDiv} className={classes.join(' ')}></div>\n    }\n}\n","import React from \"react\"\nimport Tfw from 'tfw'\nimport PagePatients from '../../container/pages/patients'\nimport PageReports from '../../container/pages/reports'\nimport PageStats from '../../container/pages/stats'\nimport PageStruct from '../../container/pages/struct'\nimport PageWelcome from './welcome'\n\nimport \"./pages.css\"\n\nconst Stack = Tfw.Layout.Stack\n\ninterface IPagesProps {\n    className?: string[]\n    page: string\n}\ninterface IPagesState { }\n\nexport default class Pages extends React.Component<IPagesProps, IPagesState> {\n    state = {}\n\n    render() {\n        const classes = [\n            'view-Pages',\n            ...Tfw.Converter.StringArray(this.props.className, [])\n        ]\n\n        return (\n            <Stack\n                className={classes.join(' ')}\n                fullscreen={true}\n                value={this.props.page}\n            >\n                <PageWelcome key=\"welcome\" />\n                <PagePatients key=\"patients\" />\n                <PageReports key=\"reports\" />\n                <PageStats key=\"stats\" />\n                <PageStruct key=\"struct\" />\n            </Stack>\n        )\n    }\n}\n","import * as React from \"react\"\nimport { connect } from 'react-redux'\nimport Stat from \"../../view/stat\"\nimport Sidemenu from \"../../tfw/layout/sidemenu\"\nimport Icon from \"../../tfw/view/icon\"\nimport Flex from \"../../tfw/layout/flex\"\nimport User from \"../../state/user\"\nimport State from \"../../state\"\nimport Hash from \"../../util/hash\"\nimport MainPanel from '../../view/main-panel'\nimport Pages from '../../view/pages'\n\nimport { IState, IDispatchFunction, IOrganization, ICarecenter } from \"../../types\"\nimport Intl from \"../../intl\"\n\nimport \"./sidemenu.css\"\n\nfunction mapStateToProps(state: IState) {\n    const stats = state.stats.map(stat => {\n        const carecenter = stat.carecenter;\n        const structureId = carecenter.id;\n        const structure = state.structures.find(s => s.id === structureId);\n        if (!structure) {\n            console.error(`There is no Structure with id=${structureId} in carecenter \"${carecenter.name}\"!`);\n            return null;\n        }\n        const key = Hash.statsConfig(stat);\n        return (<Stat key={key}\n            stat={stat}\n            onClose={() => State.dispatch(State.removeStat(key))}\n            structure={structure} />);\n    });\n    return {\n        head: state.user.nickname,\n        menu: <MainPanel\n                    carecenters={state.carecenters}\n                    organizations={state.organizations}\n                    structures={state.structures}/>,\n        body: <Pages page={state.page} />\n    }\n}\n\nfunction mapDispatchToProps(dispatch: IDispatchFunction) {\n    return {\n        onLanguageClick() {\n            dispatch(User.setLanguage(\"jp\"));\n        },\n\n        onLogoutClick() {\n            window.location.reload();\n        }\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Sidemenu);\n","import * as React from \"react\"\n\nimport { IUser } from \"./types\"\nimport Sidemenu from \"./container/sidemenu\"\n\nimport \"./App.css\"\n\ninterface IAppProps {\n    user: IUser\n}\n\nexport default class App extends React.Component<IAppProps, {}> {\n    render() {\n        return <Sidemenu classes=\"App\" />\n    }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { Provider } from 'react-redux'\nimport State from \"./state\"\nimport Intl from \"./tfw/intl\";\nimport { IUser, IOrganization, ICarecenter, IStructure } from \"./types\"\nimport ServiceOrganization from \"./service/organization\"\nimport ServiceCarecenter from \"./service/carecenter\"\nimport ServiceStructure from \"./service/structure\"\n\nimport App from \"./App\";\n\nexport default {\n    async start(user: IUser) {\n        const root = document.getElementById(\"root\");\n        ReactDOM.render(\n            <Provider store={State.store}><App user={user} /></Provider>,\n            root);\n        State.dispatch(State.User.setLanguage(Intl.lang));\n        State.dispatch(State.User.setNickname(user.nickname));\n        const organizations = await ServiceOrganization.list();\n        State.dispatch(State.Organizations.setOrganizations(organizations));\n        State.dispatch(State.Carecenters.setCarecenters([]));\n        organizations.forEach(async (organization: IOrganization) => {\n            const structures = await ServiceStructure.list(organization.id);\n            structures.forEach((structure: IStructure) => {\n                State.dispatch(State.Structures.addStructure(structure));\n            });\n            const carecenters = await ServiceCarecenter.list(organization.id);\n            carecenters.forEach((carecenter: ICarecenter) => {\n                State.dispatch(State.Carecenters.addCarecenter(carecenter));\n            });\n        })\n    }\n}\n"],"sourceRoot":""}